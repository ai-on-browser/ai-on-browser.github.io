import{onnx as t}from"../onnx_exporter.js";export default{export(I,e,N){const a=I.getGraph(),_=Array.isArray(e.input)?e.input[0]:e.input,n=new t.NodeProto;n.setOpType("ReduceMean"),n.addInput(_),n.addOutput(e.name+"_mean");const o=new t.AttributeProto;o.setName("keepdims"),o.setType(t.AttributeProto.AttributeType.INT),o.setI(1),n.addAttribute(o);const d=new t.NodeProto;d.setOpType("Sub"),d.addInput(_),d.addInput(e.name+"_mean"),d.addOutput(e.name+"_sub");const r=new t.NodeProto;r.setOpType("Mul"),r.addInput(e.name+"_sub"),r.addInput(e.name+"_sub"),r.addOutput(e.name+"_mul");const s=new t.NodeProto;s.setOpType("ReduceMean"),s.addInput(e.name+"_mul"),s.addOutput(e.name+"_var");const x=e.keepdims??!0?1:0,m=new t.AttributeProto;m.setName("keepdims"),m.setType(t.AttributeProto.AttributeType.INT),m.setI(x),s.addAttribute(m);const c=new t.NodeProto;c.setOpType("Sqrt"),c.addInput(e.name+"_var"),c.addOutput(e.name),a.addNode(n),a.addNode(d),a.addNode(r),a.addNode(s),a.addNode(c);const y=N[_].size.concat();if(typeof e.axis=="string")throw new Error("Unsupported axis type string");if(e.axis==null||typeof e.axis=="number"&&e.axis<0)return{size:x?Array(y.length).fill(1):[]};const i=Array.isArray(e.axis)?e.axis:[e.axis],p=new t.TensorProto;if(p.setName(e.name+"_axis"),p.setDataType(t.TensorProto.DataType.INT64),p.setDimsList([i.length]),p.setInt64DataList(i),a.addInitializer(p),n.addInput(e.name+"_axis"),s.addInput(e.name+"_axis"),i.sort((u,T)=>T-u),x)for(const u of i)y[u]=1;else for(const u of i)y.splice(u,1);return{size:y}}};
