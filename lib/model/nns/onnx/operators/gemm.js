import l from"../../../../util/matrix.js";import"../onnx_importer.js";import{loadAttribute as y,loadTensor as o}from"../utils.js";export default{import(b,u){const a={alpha:1,beta:1};for(const i of u.getAttributeList())a[i.getName()]=y(i);const e=u.getInputList(),r=[];let n=e[0];a.transA&&(r.push({type:"transpose",input:[n],name:`${n}_t`,axis:[1,0]}),n+="_t");const t={};for(const i of b.getGraph().getInitializerList())if(i.getName()===e[1])t.w=l.fromArray(o(i)),a.transB&&(t.w=t.w.t),t.w.mult(a.alpha),t.w=t.w.toArray();else if(i.getName()===e[2]){const p=o(i);Array.isArray(p)?Array.isArray(p[0])?(t.b=l.fromArray(p),t.b.mult(a.beta),t.b=t.b.toArray()):t.b=[p.map(f=>f*a.beta)]:t.b=p*a.beta}let s=e[1];t.w||(a.transB&&(r.push({type:"transpose",input:[s],name:`${e[1]}_t`,axis:[1,0]}),s=`${e[1]}_t`),a.alpha!==1&&(r.push({type:"mult",input:[s,a.alpha],name:`${e[1]}_mul_a`}),s=`${e[1]}_mul_a`));let m=e[2];return m&&!t.b&&a.beta!==1&&(r.push({type:"mult",input:[m,a.beta],name:`${e[2]}_mul_b`}),m=`${e[2]}_mul_b`),r.push({type:"full",input:[n],name:u.getOutputList()[0],w:t.w||s,b:t.b||m}),r}};
