import{onnx}from"../onnx_importer.js";import{loadTensor,loadAttribute}from"../utils.js";import Tensor from"../../../../util/tensor.js";export default{import(t,r){const e={};for(const t of r.attributeList)e[t.name]=loadAttribute(t);const s={};let a=null;for(const o of t.graph.initializerList)o.name===r.inputList[1]?(s.w=Tensor.fromArray(loadTensor(o)),e.kernel_shape||(e.kernel_shape=s.w.sizes.slice(2)),a=s.w.sizes[0],s.w=s.w.transpose(1,2,3,0).toArray()):o.name===r.inputList[2]&&(s.b=loadTensor(o));if(e.group&&1!==e.group)throw new Error(`Invalid attribute 'group' value ${e.group}.`);if(e.pads&&e.pads.some((t=>t!==e.pads[0])))throw new Error(`Invalid attribute 'pads' value ${e.pads}.`);if(e.strides&&e.strides.some((t=>t!==e.strides[0])))throw new Error(`Invalid attribute 'strides' value ${e.strides}.`);if("SAME_UPPER"===e.auto_pad)e.pads=e.kernel_shape.map((t=>Math.ceil((t-1)/2)));else if(e.auto_pad&&"NOTSET"!==e.auto_pad)throw new Error(`Invalid attribute 'auto_pad' value ${e.auto_pad}.`);return[{type:"conv",input:[r.inputList[0]],name:r.outputList[0],kernel:e.kernel_shape,channel:a,padding:e.pads?e.pads[0]:null,stride:e.strides?e.strides[0]:null,w:s.w,channel_dim:1}]}};