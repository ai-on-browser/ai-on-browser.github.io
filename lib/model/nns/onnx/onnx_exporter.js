var $=Object.defineProperty;var x=(w,o)=>$(w,"name",{value:o,configurable:!0});import c from"./onnx_pb.js";export{default as onnx}from"./onnx_pb.js";import*as b from"./layer/index.js";export default class m{static{x(this,"ONNXExporter")}static createONNXModel({opset:o}={}){const r=new c.ModelProto;r.setProducerName("ai-on-browser/data-analysis-models"),r.setProducerVersion("0.24.0"),r.setIrVersion(9);const t=new c.OperatorSetIdProto;t.setDomain(""),t.setVersion(o?.version??19),r.addOpsetImport(t);const i=new c.GraphProto;return i.setName("graph"),r.setGraph(i),r}static getLayerExporter(o){return o=o.toLowerCase(),b[o]?b[o]:(console.error(`Unimplemented layer ${o}.`),null)}static dump(o){const r=m.createONNXModel(),t=[],i=new Set;for(const e of o)t.push({...e}),e.name&&i.add(e.name);const f=new Set;for(let e=0;e<t.length;e++){if(!t[e].name){const n=`_${t[e].type}`;let s=n,a=1;for(;i.has(s);)s=`${n}_${a}`,a++;t[e].name=s,i.add(s)}if(e>0&&!t[e].input&&(t[e].input=t[e-1].name),Array.isArray(t[e].input))for(let n=0;n<t[e].input.length;n++)typeof t[e].input[n]=="number"&&(f.add(t[e].input[n]),t[e].input[n]=`__const_number_${t[e].input[n]}`);else typeof t[e].input=="number"&&(f.add(t[e].input),t[e].input=`__const_number_${t[e].input}`)}for(const e of f)t.unshift({type:"const",value:e,name:`__const_number_${e}`});const u={};for(const e of t){const n=m.getLayerExporter(e.type);if(n==null)continue;const s=n.export(r,e,u),a=Array.isArray(e.input)?e.input:[e.input];if(u[e.name]={type:c.TensorProto.DataType.Float,...u[a[0]],...s},!s?.size&&a.length>1){let l=u[e.name].size;for(let d=1;d<a.length;d++){const p=u[a[d]].size;if(!p)continue;const h=Math.max(p.length,l.length);l=Array.from({length:h},(z,y)=>{const g=l[l.length-h+y],_=p[p.length-h+y];return g==null||_==null?null:Math.max(g,_)})}u[e.name].size=l}}return r.serializeBinary()}}
