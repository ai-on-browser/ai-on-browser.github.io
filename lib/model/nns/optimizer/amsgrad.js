var o=Object.defineProperty;var n=(p,t)=>o(p,"name",{value:t,configurable:!0});import c from"../../../util/matrix.js";export class AMSGradOptimizer{static{n(this,"AMSGradOptimizer")}constructor(t=.001,a=.9,s=.999){this._learningrate=t,this._beta1=a,this._beta2=s,this._a=e=>this._learningrate/Math.sqrt(e)}set learningRate(t){this._learningrate=t}manager(){const t=this;return{get lr(){return t._learningrate},params:{},delta(a,s){const e=typeof s=="number";if(e&&(s=new c(1,1,s)),!this.params[a]){const r=s.copy();r.fill(0),this.params[a]={m:r.copy(),v:r.copy(),vh:r,t:1}}this.params[a].m.broadcastOperate(s,(r,i)=>r*t._beta1+i*(1-t._beta1)),this.params[a].v.broadcastOperate(s,(r,i)=>r*t._beta2+i**2*(1-t._beta2)),this.params[a].vh.broadcastOperate(this.params[a].v,(r,i)=>Math.max(r,i));const h=this.params[a].m.copy(),m=t._a(this.params[a].t);return h.broadcastOperate(this.params[a].vh,(r,i)=>m*r/Math.sqrt(i+1e-12)),this.params[a].t++,e?h.toScaler():h}}}}
