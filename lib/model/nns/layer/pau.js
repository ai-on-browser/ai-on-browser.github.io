var d=Object.defineProperty;var o=(n,i)=>d(n,"name",{value:i,configurable:!0});import y from"./base.js";export default class u extends y{static{o(this,"PadeActivationUnitLayer")}constructor({m:i=2,n:a=2,a:r=.1,b:t=0,..._}){super(_),this._m=i,this._n=a,this._a=Array.isArray(r)?r:Array(i+1).fill(r),this._b=Array.isArray(t)?t:Array(a).fill(t),this._l2_decay=.001}calc(i){this._i=i;const a=i.copy();return a.map(r=>this._a.reduce((t,_,c)=>t+_*r**c,0)/(1+Math.abs(this._b.reduce((t,_,c)=>t+_*r**(c+1),0)))),a}grad(i){this._bo=i;const a=i.copy();return a.broadcastOperate(this._i,(r,t)=>{const _=this._a.reduce((s,h,e)=>s+h*t**e,0),c=this._b.reduce((s,h,e)=>s+h*t**(e+1),0),l=1+Math.abs(c);return r*(this._a.reduce((s,h,e)=>s+h*e*t**(e-1),0)/l-Math.sign(c)*this._b.reduce((s,h,e)=>s+h*(e+1)*t**e,0)*(_/l**2))}),a}update(i){const a=Array(this._m+1).fill(0),r=Array(this._n).fill(0);for(let t=0;t<this._i.length;t++){const _=this._a.reduce((s,h,e)=>s+h*this._i.value[t]**e,0),c=this._b.reduce((s,h,e)=>s+h*this._i.value[t]**(e+1),0),l=1+Math.abs(c);for(let s=0;s<this._m;s++)a[s]+=this._bo.value[t]*this._i.value[t]**s;for(let s=0;s<this._n;s++)r[s]+=this._bo.value[t]*(-(this._i.value[t]**(s+1))*Math.sign(c)*(_/l**2))}for(let t=0;t<this._m+1;t++)this._a[t]-=i.delta(`a${t}`,a[t]/this._i.length);for(let t=0;t<this._n;t++)this._b[t]-=i.delta(`b${t+1}`,r[t]/this._i.length)}toObject(){return{type:"pau",m:this._m,n:this._n,a:this._a,b:this._b}}}u.registLayer("pau");
