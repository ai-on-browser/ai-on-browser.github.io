import Layer from"./base.js";import Matrix from"../../../util/matrix.js";export default class DivLayer extends Layer{calc(...e){this._i=e,this._den=e[1].copy();for(let t=2;t<e.length;t++)this._den.broadcastOperate(e[t],((e,t)=>e*t));const t=e[0].copy();return t.broadcastOperate(this._den,((e,t)=>e/t)),t}grad(e){const t=this._i[0].copy();return t.map((e=>-e)),t.broadcastOperate(this._den,((e,t)=>e/t**2)),t.broadcastOperate(e,((e,t)=>e*t)),this._i.map(((r,s)=>{const a=r.sizes;let i;if(0===s)i=e.copy(),i.broadcastOperate(this._den,((e,t)=>e/t));else{i=t.copy();for(let e=1;e<this._i.length;e++)s!==e&&i.broadcastOperate(this._i[e],((e,t)=>e*t))}if(i.sizes.map(((e,t)=>e/a[t])).every((e=>1===e)))return i;const o=r.copy();o.fill(0);const c=Array(i.sizes.length).fill(0);do{const e=c.map(((e,t)=>e%a[t]));o.operateAt(e,(e=>e+i.at(c)));for(let e=0;e<c.length&&(c[e]++,!(c[e]<i.sizes[e]));e++)c[e]=0}while(c.some((e=>e>0)));return o}))}}DivLayer.registLayer();