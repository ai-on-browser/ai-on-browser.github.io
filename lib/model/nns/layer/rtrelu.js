import Layer from"./base.js";import Tensor from"../../../util/tensor.js";export default class RandomTranslationReLULayer extends Layer{constructor({...r}){super(r),this._r=null,this._training=!1}bind({training:r}){this._training=r}calc(r){this._i=r;const s=r.copy();return this._training?(this._r=Tensor.randn(r.sizes.slice(1)),s.map(((r,s)=>Math.max(0,r+this._r.at(s.slice(1)))))):(this._r=Tensor.zeros(r.sizes.slice(1)),s.map((r=>r>0?r:0))),s}grad(r){const s=r.copy();return s.map(((r,s)=>this._i.at(s)+this._r.at(s.slice(1))>0?r:0)),s}}RandomTranslationReLULayer.registLayer("rtrelu");