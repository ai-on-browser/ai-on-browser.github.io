import Layer,{NeuralnetworkLayerException}from"./base.js";import Matrix from"../../../util/matrix.js";export default class OnehotLayer extends Layer{constructor({class_size:t=null,values:e=[],...s}){super(s),this._c=t,this._values=e}calc(t){if(1!==t.cols)throw new NeuralnetworkLayerException("Invalid input.",[this,t]);const e=[...new Set(t.value)];this._c||(this._c=e.length),this._i=t;for(let t=0;t<e.length&&this._values.length<this._c;t++)this._values.includes(e[t])||this._values.push(e[t]);const s=Matrix.zeros(t.rows,this._c);for(let e=0;e<t.rows;e++)s.set(e,this._values.indexOf(t.at(e,0)),1);return s}grad(){const t=this._i.copy();return t.fill(0),t}toObject(){return{type:"onehot",class_size:this._c,values:this._values}}}OnehotLayer.registLayer();