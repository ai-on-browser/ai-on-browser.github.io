import Layer from"./base.js";export default class BendableLinearUnitLayer extends Layer{constructor({beta:t=.1,...e}){super(e),this._beta=t}calc(t){this._i=t;const e=t.copy();return e.map((t=>this._beta*(Math.sqrt(t**2+1)-1)+t)),e}grad(t){this._bo=t;const e=t.copy();return e.broadcastOperate(this._i,((t,e)=>t*(this._beta*e/Math.sqrt(e**2+1)+1))),e}update(t){const e=this._bo.reduce(((t,e,a)=>t+e*(Math.sqrt(this._i.at(a)**2+1)-1)),0)/this._bo.length;this._beta-=t.delta("beta",e),this._beta<-1?this._beta=-1:this._beta>1&&(this._beta=1)}toObject(){return{type:"blu",beta:this._beta}}}BendableLinearUnitLayer.registLayer("blu");