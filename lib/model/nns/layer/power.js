import Layer from"./base.js";export default class PowerLayer extends Layer{calc(s,e){this._i=s,this._p=e;const i=s.copy();return i.broadcastOperate(e,((s,e)=>s**e)),i}grad(s){const e=Array(s.sizes.length).fill(0),i=this._i.copy();i.fill(0);const t=this._p.copy();t.fill(0);const o=s.dimension-this._i.dimension,r=s.dimension-this._p.dimension;do{const a=e.slice(o).map(((s,e)=>s%this._i.sizes[e])),n=this._i.at(a),l=e.slice(r).map(((s,e)=>s%this._p.sizes[e])),p=this._p.at(l),c=s.at(e);i.operateAt(a,(s=>s+p*n**(p-1)*c)),t.operateAt(l,(s=>s+n**p*Math.log(n)*c));for(let i=0;i<e.length&&(e[i]++,!(e[i]<s.sizes[i]));i++)e[i]=0}while(e.some((s=>s>0)));return[i,t]}}PowerLayer.registLayer();