import Layer from"./base.js";export default class ParametricTanhLinearUnitLayer extends Layer{constructor({alpha:t=1,beta:a=1,...e}){super(e),this._alpha=t,this._beta=a}calc(t){this._i=t;const a=t.copy();return a.map((t=>t>0?t:this._alpha*Math.tanh(this._beta*t))),a}grad(t){this._bo=t;const a=t.copy();return a.broadcastOperate(this._i,((t,a)=>t*(a>0?1:this._alpha*this._beta*(1-Math.tanh(this._beta*a)**2)))),a}update(t){let a=0,e=0;for(let t=0;t<this._i.length;t++){if(this._i.value[t]>0)continue;const h=Math.tanh(this._beta*this._i.value[t]);a+=this._bo.value[t]*h,e+=this._bo.value[t]*this._alpha*(1-h**2)}this._alpha-=t.delta("alpha",a/this._i.length),this._alpha<0&&(this._alpha=0),this._beta-=t.delta("beta",e/this._i.length),this._beta<0&&(this._beta=0)}toObject(){return{type:"ptelu",alpha:this._alpha,beta:this._beta}}}ParametricTanhLinearUnitLayer.registLayer("ptelu");