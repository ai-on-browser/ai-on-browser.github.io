var _=Object.defineProperty;var h=(s,i)=>_(s,"name",{value:i,configurable:!0});import l from"./base.js";export default class r extends l{static{h(this,"ParametricDeformableELULayer")}constructor({t:i=.1,alpha:a=1,...t}){super(t),this._t=i,this._alpha=a}calc(i){this._i=i;const a=i.copy();return a.map(t=>t>0?t:this._alpha*((1+(1-this._t)*t)**(1/(1-this._t))-1)),a}grad(i){this._bo=i;const a=i.copy();return a.broadcastOperate(this._i,(t,e)=>t*(e>0?1:this._alpha*(1+(1-this._t)*e)**(this._t/(1-this._t)))),a}update(i){let a=0;for(let t=0;t<this._i.length;t++)this._i.value[t]>0||(a+=this._bo.value[t]*((1+(1-this._t)*this._i.value[t])**(1/(1-this._t))-1));this._alpha-=i.delta("alpha",a/this._i.length)}toObject(){return{type:"pdelu",t:this._t,alpha:this._alpha}}}r.registLayer("pdelu");
