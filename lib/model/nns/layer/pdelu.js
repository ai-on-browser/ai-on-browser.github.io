import Layer from"./base.js";export default class ParametricDeformableELULayer extends Layer{constructor({t:t=.1,alpha:a=1,...e}){super(e),this._t=t,this._alpha=a}calc(t){this._i=t;const a=t.copy();return a.map((t=>t>0?t:this._alpha*((1+(1-this._t)*t)**(1/(1-this._t))-1))),a}grad(t){this._bo=t;const a=t.copy();return a.broadcastOperate(this._i,((t,a)=>t*(a>0?1:this._alpha*(1+(1-this._t)*a)**(this._t/(1-this._t))))),a}update(t){let a=0;for(let t=0;t<this._i.length;t++)this._i.value[t]>0||(a+=this._bo.value[t]*((1+(1-this._t)*this._i.value[t])**(1/(1-this._t))-1));this._alpha-=t.delta("alpha",a/this._i.length)}toObject(){return{type:"pdelu",t:this._t,alpha:this._alpha}}}ParametricDeformableELULayer.registLayer("pdelu");