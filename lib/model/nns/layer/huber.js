var o=Object.defineProperty;var e=(s,t)=>o(s,"name",{value:t,configurable:!0});import c from"./base.js";import h from"../../../util/matrix.js";import n from"../../../util/tensor.js";export default class _ extends c{static{e(this,"HuberLayer")}bind({supervisor:t}){Array.isArray(t)?(this._t=n.fromArray(t),this._t.dimension===2&&(this._t=this._t.toMatrix())):(t instanceof h||t instanceof n)&&(this._t=t)}calc(t){this._i=t;const a=this._t.copy();return a.broadcastOperate(t,(i,r)=>Math.abs(i-r)),this._cond=a.copy(),this._cond.map(i=>i<1),a.map((i,r)=>this._cond.at(r)?.5*i*i:i-.5),new h(1,1,a.reduce((i,r)=>i+r))}grad(t){return t=t.toScaler(),this._bi=this._cond.copy(),this._bi.map((a,i)=>t*(a?this._i.at(i)-this._t.at(i):Math.sign(this._i.at(i)-this._t.at(i)))),this._bi}}_.registLayer();
