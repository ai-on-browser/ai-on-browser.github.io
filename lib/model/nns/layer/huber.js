import Layer from"./base.js";import Matrix from"../../../util/matrix.js";export default class HuberLayer extends Layer{bind({supervisor:t}){this._t=t}calc(t){this._i=t;const i=this._t.copy();return i.broadcastOperate(t,((t,i)=>Math.abs(t-i))),this._cond=i.copy(),this._cond.map((t=>t<1)),i.map(((t,i)=>this._cond.at(i)?.5*t*t:t-.5)),new Matrix(1,1,i.reduce(((t,i)=>t+i)))}grad(t){return t=t.toScaler(),this._bi=this._cond.copy(),this._bi.map(((i,a)=>t*(i?this._i.at(a)-this._t.at(a):Math.sign(this._i.at(a)-this._t.at(a))))),this._bi}}HuberLayer.registLayer();