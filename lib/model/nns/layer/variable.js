import Layer from"./base.js";import Matrix from"../../../util/matrix.js";export default class VariableLayer extends Layer{constructor({size:t,l2_decay:i=0,l1_decay:s=0,value:a=null,...e}){super(e),this._size=t,this._v=a?Matrix.fromArray(a):"string"!=typeof t?Matrix.randn(t[0],t[1]):null,this._l2_decay=i,this._l1_decay=s,this._n=1}bind({n:t}){this._n=t}calc(){if(!this._v){const t=this.graph.getNode(this._size).lastOutputSize;this._v=Matrix.randn(t[0],t[1])}return this._v}grad(t){this._bo=t}update(t){const i=this._bo.copyDiv(this._n);if(this._l2_decay>0||this._l1_decay>0)for(let t=0;t<this._v.rows;t++)for(let s=0;s<this._v.cols;s++){const a=this._v.at(t,s);i.addAt(t,s,a*this._l2_decay+Math.sign(a)*this._l1_decay)}this._v.sub(t.delta("v",i))}toObject(){return{type:"variable",size:this._size,l2_decay:this._l2_decay,l1_decay:this._l1_decay,value:this._v.toArray()}}}VariableLayer.registLayer();