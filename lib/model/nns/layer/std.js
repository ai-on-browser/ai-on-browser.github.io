import Layer from"./base.js";import Matrix from"../../../util/matrix.js";export default class StdLayer extends Layer{constructor({axis:t=-1,...s}){super(s),this._axis=t}calc(t){return this._i=t,this._m=t.mean(this._axis),this._axis<0?(this._o=t.std(),new Matrix(1,1,this._o)):(this._o=t.std(this._axis),this._o)}grad(t){if(this._axis<0)return Matrix.map(this._i,(s=>t.toScaler()*(s-this._m)/(this._o*this._i.length)));const s=Matrix.sub(this._i,this._m);return s.sub(this._m),s.mult(1/this._i.sizes[this._axis]),s.mult(Matrix.map(this._o,(t=>1/t))),s.mult(t),s}toObject(){return{type:"std",axis:this._axis}}}StdLayer.registLayer("std");