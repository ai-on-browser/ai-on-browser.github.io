var n=Object.defineProperty;var a=(i,r)=>n(i,"name",{value:r,configurable:!0});import p from"./base.js";export default class _ extends p{static{a(this,"DropoutLayer")}constructor({drop_rate:r=.5,...t}){super(t),this._drop_rate=r}bind({drop_rate:r}){this._drop_rate=r||this._drop_rate}_shuffle(r){const t=Array.from({length:r},(o,e)=>e);for(let o=r-1;o>0;o--){let e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t.slice(0,Math.max(1,Math.floor(r*this._drop_rate)))}calc(r){const t=r.length/r.sizes[0];this._drop_index=this._shuffle(t);const o=r.copy();for(let e=0;e<r.sizes[0];e++)for(const s of this._drop_index)o.value[e*t+s]=0;return o.map(e=>e*(t/(t-this._drop_index.length))),o}grad(r){const t=r.copy(),o=t.length/t.sizes[0];for(let e=0;e<r.sizes[0];e++)for(const s of this._drop_index)t.value[e*o+s]=0;return t.map(e=>e*(o/(o-this._drop_index.length))),t}toObject(){return{type:"dropout",drop_rate:this._drop_rate}}}_.registLayer();
