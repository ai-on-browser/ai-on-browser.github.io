import Layer from"./base.js";export default class DropoutLayer extends Layer{constructor({drop_rate:r=.5,...t}){super(t),this._drop_rate=r}bind({drop_rate:r}){this._drop_rate=r||this._drop_rate}_shuffle(r){const t=Array.from({length:r},((r,t)=>t));for(let e=r-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t.slice(0,Math.max(1,Math.floor(r*this._drop_rate)))}calc(r){const t=r.length/r.sizes[0];this._drop_index=this._shuffle(t);const e=r.copy();for(let o=0;o<r.sizes[0];o++)for(const r of this._drop_index)e.value[o*t+r]=0;return e.map((r=>r*(t/(t-this._drop_index.length)))),e}grad(r){const t=r.copy(),e=t.length/t.sizes[0];for(let o=0;o<r.sizes[0];o++)for(const r of this._drop_index)t.value[o*e+r]=0;return t.map((r=>r*(e/(e-this._drop_index.length)))),t}toObject(){return{type:"dropout",drop_rate:this._drop_rate}}}DropoutLayer.registLayer();