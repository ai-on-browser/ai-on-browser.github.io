import Layer from"./base.js";import Tensor from"../../../util/tensor.js";export default class RandomizedReLULayer extends Layer{constructor({l:t=1/8,u:i=1/3,...s}){super(s),this._l=t,this._u=i,this._r=null,this._training=!1}bind({training:t}){this._training=t}calc(t){this._training?this._r=Tensor.random(t.sizes.slice(1),this._l,this._u):this._r=new Tensor(t.sizes.slice(1),(this._l+this._u)/2),this._i=t;const i=t.copy();return i.map(((t,i)=>t>0?t:t*this._r.at(i.slice(1)))),i}grad(t){const i=t.copy();return i.map(((t,i)=>this._i.at(i)>0?t:t*this._r.at(i.slice(1)))),i}toObject(){return{type:"rrelu",l:this._l,u:this._u}}}RandomizedReLULayer.registLayer("rrelu");