import Layer from"./base.js";import Tensor from"../../../util/tensor.js";export default class RReluLayer extends Layer{constructor({l:r=1/8,u:t=1/3,r:s=null,...e}){super(e),this._l=r,this._u=t,this._r=null,s&&(this._r=Tensor.fromArray(s))}calc(r){return this._r||(this._r=Tensor.random([1,...r.sizes.slice(1)],this._l,this._u)),this._i=r,this._o=r.copy(),this._o.map(((r,t)=>r>0?r:r*this._r.at(0,...t.slice(1)))),this._o}grad(r){const t=r.copy();return t.map(((r,t)=>this._i.at(t)>0?r:r*this._r.at(0,...t.slice(1)))),t}toObject(){return{type:"rrelu",l:this._l,u:this._u,r:this._r?.toArray()}}}RReluLayer.registLayer("rrelu");