import Layer from"./base.js";export default class SubLayer extends Layer{calc(...e){this._i=e;const t=e[0].copy();for(let r=1;r<e.length;r++)t.broadcastOperate(e[r],((e,t)=>e-t));return t}grad(e){const t=e.copy();return t.map((e=>-e)),this._i.map(((r,s)=>{const a=r.sizes,o=0===s?e:t;if(o.sizes.map(((e,t)=>e/a[t])).every((e=>1===e)))return o;const i=r.copy();i.fill(0);const n=Array(o.sizes.length).fill(0);do{const e=n.map(((e,t)=>e%a[t]));i.operateAt(e,(e=>e+o.at(n)));for(let e=0;e<n.length&&(n[e]++,!(n[e]<o.sizes[e]));e++)n[e]=0}while(n.some((e=>e>0)));return i}))}}SubLayer.registLayer();