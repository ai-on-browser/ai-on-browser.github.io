import Layer from"./base.js";import Matrix from"../../../util/matrix.js";export default class SoftmaxLayer extends Layer{calc(t){return this._o=Matrix.sub(t,t.max(1)),this._o.map(Math.exp),this._o.div(this._o.sum(1)),this._o}grad(t){this._bi=new Matrix(t.rows,t.cols);for(let s=0;s<t.rows;s++)for(let r=0;r<t.cols;r++){const o=this._o.at(s,r);let a=0;for(let i=0;i<t.cols;i++){const e=r===i?1-o:-o;a+=this._o.at(s,i)*e*t.at(s,i)}this._bi.set(s,r,a)}return this._bi}}SoftmaxLayer.registLayer();