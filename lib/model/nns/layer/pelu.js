import Layer from"./base.js";export default class ParametricELULayer extends Layer{constructor({a:t=1,b:i=1,...s}){super(s),this._a=t,this._b=i}calc(t){this._i=t;const i=t.copy();return i.map((t=>this._a*(t>=0?t/this._b:Math.exp(t/this._b)-1))),i}grad(t){this._bo=t;const i=t.copy();return i.broadcastOperate(this._i,((t,i)=>t*this._a/this._b*(i>=0?1:Math.exp(i/this._b)))),i}update(t){let i=0,s=0;for(let t=0;t<this._i.length;t++)this._i.value[t]>=0?(i+=this._bo.value[t]*(this._i.value[t]/this._b),s+=this._bo.value[t]*(-this._a*this._i.value[t]/this._b**2)):(i+=this._bo.value[t]*(Math.exp(this._i.value[t]/this._b)-1),s+=this._bo.value[t]*(this._a*Math.exp(this._i.value[t]/this._b)*(-this._i.value[t]/this._b**2)));this._a-=t.delta("a",i/this._i.length),this._a<.1&&(this._a=.1),this._b-=t.delta("b",s/this._i.length),this._b<.1&&(this._b=.1)}toObject(){return{type:"pelu",a:this._a,b:this._b}}}ParametricELULayer.registLayer("pelu");