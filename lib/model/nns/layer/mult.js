import Layer from"./base.js";export default class MultLayer extends Layer{calc(...e){this._i=e;let t=e[0].copy();for(let r=1;r<e.length;r++)t.broadcastOperate(e[r],((e,t)=>e*t));return t}grad(e){return this._i.map(((t,r)=>{const s=t.sizes,a=e.copy();for(let e=0;e<this._i.length;e++)r!==e&&a.broadcastOperate(this._i[e],((e,t)=>e*t));if(a.sizes.map(((e,t)=>e/s[t])).every((e=>1===e)))return a;const i=t.copy();i.fill(0);const l=Array(a.sizes.length).fill(0);do{const e=l.map(((e,t)=>e%s[t]));i.operateAt(e,(e=>e+a.at(l)));for(let e=0;e<l.length&&(l[e]++,!(l[e]<a.sizes[e]));e++)l[e]=0}while(l.some((e=>e>0)));return i}))}}MultLayer.registLayer();