import Layer from"./base.js";import Matrix from"../../../util/matrix.js";import Tensor from"../../../util/tensor.js";export default class MSELayer extends Layer{bind({supervisor:t}){Array.isArray(t)?(this._t=Tensor.fromArray(t),2===this._t.dimension&&(this._t=this._t.toMatrix())):(t instanceof Matrix||t instanceof Tensor)&&(this._t=t)}calc(t){this._i=t;const r=t.copy();return r.broadcastOperate(this._t,((t,r)=>(t-r)**2)),new Matrix(1,1,r.reduce(((t,r)=>t+r),0)/r.length)}grad(t){t=t.toScaler();const r=this._i.copy();return r.broadcastOperate(this._t,((r,s)=>t*(r-s)/2)),r}}MSELayer.registLayer("mse");