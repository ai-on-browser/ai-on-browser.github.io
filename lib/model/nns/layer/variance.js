import Layer from"./base.js";import Matrix from"../../../util/matrix.js";export default class VarLayer extends Layer{constructor({axis:i=-1,...t}){super(t),this._axis=i}calc(i){return this._i=i,this._m=i.mean(this._axis),this._axis<0?new Matrix(1,1,i.variance()):i.variance(this._axis)}grad(i){if(this._axis<0)return Matrix.map(this._i,(t=>i.toScaler()*(2*(t-this._m))/this._i.length));const t=Matrix.sub(this._i,this._m);return t.mult(2/this._i.sizes[this._axis]),t.mult(i),t}toObject(){return{type:"variance",axis:this._axis}}}VarLayer.registLayer("variance");