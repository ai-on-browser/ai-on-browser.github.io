import Tensor from"../../../util/tensor.js";import Layer from"./base.js";export{default as Layer,LossLayer,FlowLayer}from"./base.js";const buildLayer=(r,a,t)=>{class o extends Layer{calc(r){return this._i=r,this._o=r.copy(),this._o.map(a),this._o}grad(r){const a=new Tensor(r.sizes);for(let o=0;o<a.length;o++)a.value[o]=r.value[o]*t(this._i.value[o],this._o.value[o]);return 2===a.dimension?a.toMatrix():a}}Object.defineProperty(o,"name",{value:r.split("_").reduce(((r,a)=>r+a[0].toUpperCase()+a.substring(1).toLowerCase()),"")+"Layer"}),o.registLayer(r)},simpleLayers={abs:{calc:Math.abs,grad:(r,a)=>r<0?-1:1},acos:{calc:Math.acos,grad:(r,a)=>-1/(Math.sqrt(1-r**2)+1e-4)},acosh:{calc:Math.acosh,grad:(r,a)=>1/(Math.sqrt(r**2-1)+1e-4)},asin:{calc:Math.asin,grad:(r,a)=>1/(Math.sqrt(1-r**2)+1e-4)},asinh:{calc:Math.asinh,grad:(r,a)=>1/Math.sqrt(1+r**2)},atan:{calc:Math.atan,grad:(r,a)=>1/(1+r**2)},atanh:{calc:Math.atanh,grad:(r,a)=>1/(1-r**2)},bent_identity:{calc:r=>(Math.sqrt(r**2+1)-1)/2+r,grad:(r,a)=>r/(2*Math.sqrt(r**2+1))+1},ceil:{calc:Math.ceil,grad:(r,a)=>1},cloglog:{calc:r=>1-Math.exp(-Math.exp(r)),grad:(r,a)=>Math.exp(r)*(1-a)},cloglogm:{calc:r=>1-2*Math.exp(-.7*Math.exp(r)),grad:(r,a)=>1.4*Math.exp(r-.7*Math.exp(r))},cos:{calc:Math.cos,grad:(r,a)=>-Math.sin(r)},cosh:{calc:Math.cosh,grad:(r,a)=>Math.sinh(r)},elish:{calc:r=>(r>=0?r:Math.exp(r)-1)/(1+Math.exp(-r)),grad:(r,a)=>((r>=0?1:Math.exp(r))+a*Math.exp(-r))/(1+Math.exp(-r))},elliott:{calc:r=>r/(2*(1+Math.abs(r)))+.5,grad:(r,a)=>1/(2*(1+Math.abs(r))**2)},erf:{calc:r=>{const a=r<0?-1:1,t=1/(1+.3275911*Math.abs(r));return a*(1-((((1.061405429*t-1.453152027)*t+1.421413741)*t-.284496736)*t+.254829592)*t*Math.exp(-r*r))},grad:(r,a)=>2*Math.exp(-(r**2))/Math.sqrt(Math.PI)},exp:{calc:Math.exp,grad:(r,a)=>a},floor:{calc:Math.floor,grad:(r,a)=>1},geru:{calc:r=>r*(1+(r=>{const a=r<0?-1:1,t=1/(1+.3275911*Math.abs(r));return a*(1-((((1.061405429*t-1.453152027)*t+1.421413741)*t-.284496736)*t+.254829592)*t*Math.exp(-r*r))})(r/Math.sqrt(2)))/2,grad:(r,a)=>(0===r?0:a/r)+r*Math.exp(-((r/Math.sqrt(2))**2))/Math.sqrt(2*Math.PI)},hard_elish:{calc:r=>Math.max(0,Math.min(1,(r+1)/2))*(r>=0?r:Math.exp(r)-1),grad:(r,a)=>r<=-1?0:r>=1?r>=0?1:Math.exp(r):r>=0?r:(1+r)*Math.exp(r)/2},hard_swish:{calc:r=>r<=-3?0:3<=r?r:r*(r+3)/6,grad:(r,a)=>r<=-3?0:3<=r?1:(2*r+3)/6},lisht:{calc:r=>r*Math.tanh(r),grad:(r,a)=>Math.tanh(r)+r*(1-Math.tanh(r)**2)},log:{calc:Math.log,grad:(r,a)=>1/r},loglog:{calc:r=>Math.exp(-Math.exp(-r)),grad:(r,a)=>Math.exp(-r)*a},logsigmoid:{calc:r=>Math.log(1/(1+Math.exp(-r))),grad:(r,a)=>1/(1+Math.exp(r))},mish:{calc:r=>r*Math.tanh(Math.log(1+Math.exp(r))),grad:(r,a)=>Math.exp(r)*(4*(r+1)+4*Math.exp(2*r)+Math.exp(3*r)+Math.exp(r)*(4*r+6))/(2*Math.exp(r)+Math.exp(2*r)+2)**2},negative:{calc:r=>-r,grad:(r,a)=>-1},relu:{calc:r=>r>0?r:0,grad:(r,a)=>r>0?1:0},resech:{calc:r=>r/Math.cosh(r),grad:(r,a)=>1/Math.cosh(r)-a*Math.tanh(r)},reu:{calc:r=>r>0?r:r*Math.exp(r),grad:(r,a)=>r>0?1:Math.exp(r)+a},rootsig:{calc:r=>r/(1+Math.sqrt(1+r**2)),grad:(r,a)=>1/(Math.sqrt(r**2+1)+r**2+1)},round:{calc:Math.round,grad:(r,a)=>1},sign:{calc:Math.sign,grad:(r,a)=>1},silu:{calc:r=>r/(1+Math.exp(-r)),grad:(r,a)=>1/(1+Math.exp(-r))+a*(1-a/r)},sin:{calc:Math.sin,grad:(r,a)=>Math.cos(r)},sinh:{calc:Math.sinh,grad:(r,a)=>Math.cosh(r)},softsign:{calc:r=>r/(1+Math.abs(r)),grad:(r,a)=>1/(1+Math.abs(r))**2},sqrt:{calc:Math.sqrt,grad:(r,a)=>1/(2*a)},square:{calc:r=>r**2,grad:(r,a)=>2*r},ssigmoid:{calc:r=>4/(1+Math.exp(-r))-2,grad:(r,a)=>4*Math.exp(-r)/(1+Math.exp(-r))**2},tan:{calc:Math.tan,grad:(r,a)=>1/Math.cos(r)**2},tanh:{calc:Math.tanh,grad:(r,a)=>1-a**2},tanhexp:{calc:r=>r*Math.tanh(Math.exp(r)),grad:(r,a)=>Math.tanh(Math.exp(r))-r*Math.exp(r)*(Math.tanh(Math.exp(r))**2-1)},tanhshrink:{calc:r=>r-Math.tanh(r),grad:(r,a)=>Math.tanh(r)**2}};for(const r of Object.keys(simpleLayers))buildLayer(r,simpleLayers[r].calc,simpleLayers[r].grad);export*from"./add.js";export*from"./additive_coupling.js";export*from"./apl.js";export*from"./aranda.js";export*from"./argmax.js";export*from"./averagepool.js";export*from"./batch_normalization.js";export*from"./bdaa.js";export*from"./blu.js";export*from"./brelu.js";export*from"./celu.js";export*from"./clip.js";export*from"./concat.js";export*from"./cond.js";export*from"./const.js";export*from"./conv.js";export*from"./crelu.js";export*from"./detach.js";export*from"./div.js";export*from"./dropout.js";export*from"./eelu.js";export*from"./elu.js";export*from"./erelu.js";export*from"./eswish.js";export*from"./felu.js";export*from"./flatten.js";export*from"./frelu.js";export*from"./full.js";export*from"./gaussian.js";export*from"./global_averagepool.js";export*from"./global_lppool.js";export*from"./global_maxpool.js";export*from"./gru.js";export*from"./hard_shrink.js";export*from"./hard_sigmoid.js";export*from"./hard_tanh.js";export*from"./hexpo.js";export*from"./huber.js";export*from"./include.js";export*from"./input.js";export*from"./isigmoid.js";export*from"./leaky_relu.js";export*from"./less.js";export*from"./linear.js";export*from"./lppool.js";export*from"./lrn.js";export*from"./lstm.js";export*from"./matmul.js";export*from"./maxpool.js";export*from"./mean.js";export*from"./mpelu.js";export*from"./mse.js";export*from"./mtlu.js";export*from"./mult.js";export*from"./nlrelu.js";export*from"./onehot.js";export*from"./output.js";export*from"./pau.js";export*from"./pdelu.js";export*from"./pelu.js";export*from"./plu.js";export*from"./power.js";export*from"./prelu.js";export*from"./preu.js";export*from"./psf.js";export*from"./ptanh.js";export*from"./ptelu.js";export*from"./random.js";export*from"./repu.js";export*from"./reshape.js";export*from"./reverse.js";export*from"./rnn.js";export*from"./rrelu.js";export*from"./rtrelu.js";export*from"./selu.js";export*from"./sigmoid.js";export*from"./slaf.js";export*from"./slu.js";export*from"./soft_shrink.js";export*from"./softargmax.js";export*from"./softmax.js";export*from"./softplus.js";export*from"./sparse.js";export*from"./split.js";export*from"./srelu.js";export*from"./srs.js";export*from"./stanh.js";export*from"./std.js";export*from"./sub.js";export*from"./sum.js";export*from"./supervisor.js";export*from"./swish.js";export*from"./taf.js";export*from"./thresholded_relu.js";export*from"./transpose.js";export*from"./variable.js";export*from"./variance.js";