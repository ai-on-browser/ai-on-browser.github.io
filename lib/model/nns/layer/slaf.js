var n=Object.defineProperty;var _=(h,e)=>n(h,"name",{value:e,configurable:!0});import c from"./base.js";export default class o extends c{static{_(this,"SelfLearnableAFLayer")}constructor({n:e=3,a:r=1,...t}){super(t),this._n=e,Array.isArray(r)?this._a=r:this._a=Array(e).fill(r)}calc(e){this._i=e;const r=e.copy();return r.map(t=>this._a.reduce((s,i,a)=>s+i*t**a,0)),r}grad(e){this._bo=e;const r=e.copy();return r.broadcastOperate(this._i,(t,s)=>t*this._a.reduce((i,a,l)=>i+l*a*s**(l-1),0)),r}update(e){const r=Array(this._n).fill(0);for(let t=0;t<this._i.length;t++)for(let s=0;s<this._n;s++)r[s]+=this._bo.value[t]*this._i.value[t]**s;for(let t=0;t<this._n;t++)this._a[t]-=e.delta(`a${t}`,r[t]/this._i.length)}toObject(){return{type:"slaf",n:this._n,a:this._a}}}o.registLayer("slaf");
