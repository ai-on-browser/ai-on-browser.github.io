import Layer from"./base.js";export default class AddLayer extends Layer{calc(...e){this._i=e;const r=e[0].copy();for(let t=1;t<e.length;t++)r.broadcastOperate(e[t],((e,r)=>e+r));return r}grad(e){return this._i.map((r=>{const t=r.sizes;if(e.sizes.map(((e,r)=>e/t[r])).every((e=>1===e)))return e;const s=r.copy();s.fill(0);const a=Array(e.sizes.length).fill(0);do{const r=a.map(((e,r)=>e%t[r]));s.operateAt(r,(r=>r+e.at(a)));for(let r=0;r<a.length&&(a[r]++,!(a[r]<e.sizes[r]));r++)a[r]=0}while(a.some((e=>e>0)));return s}))}}AddLayer.registLayer();