import Layer from"./base.js";export default class FastELULayer extends Layer{constructor({alpha:t=1,...a}){super(a),this._alpha=t}calc(t){this._i=t;const a=t.copy();return a.map((t=>t>0?t:this._alpha*(Math.exp(t/Math.log(2))-1))),a}grad(t){this._bo=t;const a=t.copy();return a.broadcastOperate(this._i,((t,a)=>t*(a>0?1:this._alpha/Math.log(2)*Math.exp(a/Math.log(2))))),a}update(t){let a=0;for(let t=0;t<this._i.length;t++)this._i.value[t]>0||(a+=this._bo.value[t]*(Math.exp(this._i.value[t]/Math.log(2))-1));this._alpha-=t.delta("alpha",a/this._i.length)}toObject(){return{type:"felu",alpha:this._alpha}}}FastELULayer.registLayer("felu");