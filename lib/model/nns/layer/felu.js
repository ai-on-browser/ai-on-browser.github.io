var r=Object.defineProperty;var l=(h,t)=>r(h,"name",{value:t,configurable:!0});import o from"./base.js";export default class s extends o{static{l(this,"FastELULayer")}constructor({alpha:t=1,...e}){super(e),this._alpha=t}calc(t){this._i=t;const e=t.copy();return e.map(a=>a>0?a:this._alpha*(Math.exp(a/Math.log(2))-1)),e}grad(t){this._bo=t;const e=t.copy();return e.broadcastOperate(this._i,(a,i)=>a*(i>0?1:this._alpha/Math.log(2)*Math.exp(i/Math.log(2)))),e}update(t){let e=0;for(let a=0;a<this._i.length;a++)this._i.value[a]>0||(e+=this._bo.value[a]*(Math.exp(this._i.value[a]/Math.log(2))-1));this._alpha-=t.delta("alpha",e/this._i.length)}toObject(){return{type:"felu",alpha:this._alpha}}}s.registLayer("felu");
