import{Matrix}from"../util/math.js";import{qt}from"./smirnov_grubbs.js";export default class GeneralizedESD{constructor(t,r){this._alpha=t,this._r=r}predict(t){const r=Matrix.fromArray(t),s=[],o=[],a=r.rows;for(let t=1;t<=this._r;t++){const t=r.copySub(r.mean(0));t.abs(),t.div(r.std(0));const a=t.max(1),e=a.argmax(0).value[0];o.push(a.at(e,0)),r.remove(e),s.push(e)}for(let t=s.length-1;t>=0;t--)for(let r=t+1;r<s.length;r++)s[t]<=s[r]&&s[r]++;for(let t=1;t<=this._r;t++){const r=this._alpha/(2*(a-t+1)),e=qt(a-t-1,r),i=(a-t)*e/Math.sqrt((a-t-1+e**2)*(a-t+1));if(o[t-1]<=i){s.splice(t-1,this._r);break}}const e=Array(a).fill(!1);for(let t=0;t<s.length;t++)e[s[t]]=!0;return e}}