var _=Object.defineProperty;var u=(s,t)=>_(s,"name",{value:t,configurable:!0});import b from"../util/matrix.js";const p=u(s=>{if(Number.isInteger(s)&&s>0){let t=0;for(let e=2;e<s;e++)t+=Math.log(e);return t}else if(Number.isInteger(s-.5)&&s>0){const t=s-.5;let e=Math.log(Math.sqrt(Math.PI))-Math.log(2)*t;for(let o=2*t-1;o>0;o-=2)e+=Math.log(o);return e}throw""},"logGamma"),w=u((s,t)=>Math.exp(p(s)+p(t)-p(s+t)),"beta"),v=u((s,t,e)=>{if(s>(t+1)/(t+e+1))return 1-v(1-s,e,t);let o,l=-s*(t+e)/(t+1),i,c=2,r=1+l/c,n,a=1,h=1+l/a,g=1,d=c/a*g,M=r/h*d;const q=1e-12;for(let f=1;f<1e3&&!(Math.abs(M-g)<q);f++){const m=f*2*t;o=s*f*(e-f)/(m*(m-1)),l=-s*(t+f)*(t+e+f)/(m*(m+1)),i=r,c=1+o/i,r=1+l/c,n=h,a=1+o/n,h=1+l/a,g=M,d=c/a*g,M=r/h*d}return s**t*(1-s)**e*(M-1)/(t*w(t,e))},"ibeta"),I=u((s,t)=>{if(t===1)return 1/2+Math.atan(s)/Math.PI;if(t===2)return(1+s/Math.sqrt(2+s**2))/2;const e=Math.sqrt(s**2+t),o=(s+e)/(2*e);return v(o,t/2,t/2)},"ct"),x=u((s,t)=>{if(Math.abs(t)>1)throw"absolute of 'a' need less than or equals to 1.";if(Math.abs(t)===1)return Math.sign(t)*(1/0);if(t>.5)return-x(s,1-t);t=1-t;let e=1,o=null,l=0;const i=1e-5;let c=1e4;for(;c-- >0;){const r=I(e,s);if(isNaN(r))return r;if(Math.abs(r-t)<i)return e;r<t?(l=e,o===null?e*=2:e=(e+o)/2):(o=e,e=(e+l)/2)}throw"qt not converged."},"qt");export default class y{static{u(this,"GeneralizedESD")}constructor(t,e){this._alpha=t,this._r=e}predict(t){const e=b.fromArray(t),o=[],l=[],i=e.rows;for(let r=1;r<=this._r;r++){const n=b.sub(e,e.mean(0));n.abs(),n.div(e.std(0));const a=n.max(1),h=a.argmax(0).toScaler();l.push(a.at(h,0)),e.remove(h),o.push(h)}for(let r=o.length-1;r>=0;r--)for(let n=r+1;n<o.length;n++)o[r]<=o[n]&&o[n]++;for(let r=1;r<=this._r;r++){const n=this._alpha/(2*(i-r+1)),a=x(i-r-1,n),h=(i-r)*a/Math.sqrt((i-r-1+a**2)*(i-r+1));if(l[r-1]<=h){o.splice(r-1,this._r);break}}const c=Array(i).fill(!1);for(let r=0;r<o.length;r++)c[o[r]]=!0;return c}}
