var p=Object.defineProperty;var g=(d,l)=>p(d,"name",{value:l,configurable:!0});class a{static{g(this,"KMeans")}constructor(l,n){this._x=l,this._k=n;const _=this._x.length,h=[];for(let i=0;i<this._k;i++)h.push(Math.floor(Math.random()*(_-i)));for(let i=h.length-1;i>=0;i--)for(let s=h.length-1;s>i;s--)h[i]<=h[s]&&h[s]++;this._c=h.map(i=>this._x[i]),this._d=(i,s)=>Math.sqrt(i.reduce((c,t,o)=>c+(t-s[o])**2,0))}get c(){return this._c}fit(){const l=this.predict(),n=this._c.map(i=>Array.from(i,()=>0)),_=Array(this._k).fill(0),h=this._x.length;for(let i=0;i<h;i++){for(let s=0;s<this._x[i].length;s++)n[l[i]][s]+=this._x[i][s];_[l[i]]++}for(let i=0;i<this._k;i++)this._c[i]=n[i].map(s=>s/_[i])}predict(){const l=[],n=this._x.length;for(let _=0;_<n;_++){let h=1/0;l[_]=-1;for(let i=0;i<this._k;i++){const s=this._d(this._x[_],this._c[i]);s<h&&(h=s,l[_]=i)}}return l}}export default class k{static{g(this,"YinyangKMeans")}constructor(l,n){this._k=l,this._t=Math.max(1,n??Math.floor(this._k/10)),this._c=null,this._d=(_,h)=>Math.sqrt(_.reduce((i,s,c)=>i+(s-h[c])**2,0))}get centroids(){return this._c}init(l){this._x=l;const n=new a(this._x,this._k),_=new a(n.c,this._t);for(let s=0;s<5;s++)_.fit();const h=_.predict();this._g=Array.from({length:this._t},()=>[]);for(let s=0;s<h.length;s++)this._g[h[s]].push(s);n.fit(),this._c=n.c,this._b=n.predict(),this._ub=[],this._lb=[];const i=this._x.length;for(let s=0;s<i;s++){this._ub[s]=this._d(this._x[s],this._c[this._b[s]]),this._lb[s]=[];for(let c=0;c<this._t;c++){this._lb[s][c]=1/0;for(let t=0;t<this._g[c].length;t++){if(this._g[c][t]===this._b[s])continue;const o=this._d(this._x[s],this._c[this._g[c][t]]);o<this._lb[s][c]&&(this._lb[s][c]=o)}}}}fit(){const l=this._x.length,n=this._c.map(t=>Array.from(t,()=>0)),_=Array(this._k).fill(0);for(let t=0;t<l;t++){for(let o=0;o<this._x[t].length;o++)n[this._b[t]][o]+=this._x[t][o];_[this._b[t]]++}const h=[];for(let t=0;t<this._k;t++)n[t]=n[t].map(o=>o/_[t]),h[t]=this._d(this._c[t],n[t]),this._c[t]=n[t];const i=[];for(let t=0;t<this._t;t++){i[t]=0;for(let o=0;o<this._g[t].length;o++)i[t]=Math.max(i[t],h[this._g[t][o]])}const s=[],c=[];for(let t=0;t<l;t++){this._ub[t]+=h[this._b[t]];const o=[];let r=1/0;for(let e=0;e<this._t;e++)o[e]=this._lb[t][e],this._lb[t][e]-=i[e],r=Math.min(r,this._lb[t][e]);const x=this._b[t];if(r>=this._ub[t]||(this._ub[t]=this._d(this._x[t],this._c[this._b[t]]),r>=this._ub[t]))continue;const m=[];for(let e=0;e<this._t;e++)if(!(this._lb[t][e]>=this._ub[t])){m.push(e),this._lb[t][e]=1/0;for(const f of this._g[e]){if(x===f||this._lb[t][e]<o[e]-h[f])continue;const b=this._d(this._x[t],this._c[f]);if(b<this._ub[t]){let u=0;for(;!this._g[u].includes(this._b[t]);u++);this._lb[t][u]=this._ub[t],this._ub[t]=b,this._b[t]=f}else b<this._lb[t][e]&&(this._lb[t][e]=b)}}}}predict(l){const n=[];for(let _=0;_<l.length;_++){let h=1/0;n[_]=-1;for(let i=0;i<this._c.length;i++){const s=this._d(l[_],this._c[i]);s<h&&(h=s,n[_]=i)}}return n}}
