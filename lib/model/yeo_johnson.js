export default class JeoJohnson{constructor(t=null){this._lambda=t,this._lambda_cand=[];for(let t=0;t<=200;t++)this._lambda_cand.push((t-100)/10)}_cdf(t){return 1/(1+Math.exp(-1.7*t))}_ppf(t){if(t>=1)return 1/0;if(.5===t)return 0;if(t<.5)return-this._ppf(1-t);let a=0,r=null,s=1;let l=1e4;for(;l-- >0;){const l=this._cdf(s);if(Math.abs(l-t)<1e-8)return s;t<l?(r=s,s=(s+a)/2):(a=s,s=null===r?2*s:(s+r)/2)}throw"loop converged"}_j(t,a){const r=t.length,s=t.map((t=>this._t(t,a)));s.sort(((t,a)=>t-a));const l=s.reduce(((t,a)=>t+a),0)/r,e=Math.sqrt(s.reduce(((t,a)=>t+(a-l)**2),0)/r);let h=0;for(let t=0;t<r;t++)h+=(this._ppf((t+.5)/r)-(s[t]-l)/e)**2;return h}_t(t,a){return t>=0?0===a?Math.log(t+1):((t+1)**a-1)/a:2===a?-Math.log(1-t):-((1-t)**(2-a)-1)/(2-a)}fit(t){const a=[];if(Array.isArray(t[0]))for(let r=0;r<t[0].length;r++)a[r]=t.map((t=>t[r]));else a[0]=t;this._lambda=[];for(let t=0;t<a.length;t++){let r=1/0,s=0;for(const l of this._lambda_cand){const e=this._j(a[t],l);e<r&&(r=e,s=l)}this._lambda.push(s)}}predict(t){return t.map((t=>Array.isArray(t)?Array.isArray(this._lambda)?t.map(((t,a)=>this._t(t,this._lambda[a]))):t.map((t=>this._t(t,this._lambda))):Array.isArray(this._lambda)?this._t(t,this._lambda[0]):this._t(t,this._lambda)))}}