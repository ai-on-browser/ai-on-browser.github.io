var m=Object.defineProperty;var d=(r,e)=>m(r,"name",{value:e,configurable:!0});const p={euclid:d(()=>(r,e)=>Math.sqrt(r.reduce((n,h,c)=>n+(h-e[c])**2,0)),"euclid"),manhattan:d(()=>(r,e)=>r.reduce((n,h,c)=>n+Math.abs(h-e[c]),0),"manhattan"),chebyshev:d(()=>(r,e)=>Math.max(...r.map((n,h)=>Math.abs(n-e[h]))),"chebyshev"),minkowski:d(({p:r=2}={})=>(e,n)=>Math.pow(e.reduce((h,c,_)=>h+(c-n[_])**r,0),1/r),"minkowski")};export default class x{static{d(this,"NNBCA")}constructor(e="euclid"){this._metric=e,typeof this._metric=="function"?this._d=this._metric:this._d=p[this._metric]()}fit(e,n){this._x=e,this._y=n,this._classes=[...new Set(n)];const h=this._x.length;this._distances=Array.from({length:h},()=>[]);for(let s=0;s<h;s++){this._distances[s][s]={i:s,d:0};for(let i=s+1;i<h;i++){const t=this._d(this._x[s],this._x[i]);this._distances[s][i]={i,d:t},this._distances[i][s]={i:s,d:t}}this._distances[s].sort((i,t)=>i.d-t.d)}this._g=Array.from({length:h},()=>[]),this._r=1;const c=Array.from({length:h},()=>[]);let _=[-1,0];for(;;){for(let i=0;i<h;i++){const t=this._distances[i][this._r+1].i;c[i].push(t),c[t].includes(i)&&!this._g[i][t]&&(this._g[i].push(t),this._g[t].push(i))}const s=this._g.reduce((i,t)=>i+(t.length===0?1:0),0);if(_[0]!==s?_=[s,1]:_[1]++,s===0||this._r>2&&_[1]>=Math.sqrt(this._r-_[1]))break;this._r++}this._t=[];for(let s=0;s<this._classes.length;s++){this._t[s]={s:0,c:0};const i=this._classes[s];for(let t=0;t<this._x.length;t++)this._y[t]===i&&(this._t[s].c++,this._g[t].length!==0&&(this._t[s].s+=this._g[t].reduce((l,a)=>l+this._y[a]===i?1:0,0)/this._g[t].length))}}predict(e){const n=Array(e.length).fill(null);for(let h=0;h<e.length;h++){const c=this._x.map((t,l)=>({i:l,d:this._d(t,e[h])}));c.sort((t,l)=>t.d-l.d);const _=[];for(let t=0;t<this._r;t++)c[t].d<this._distances[c[t].i][this._r+1].d&&_.push(c[t].i);if(_.length===0)continue;let s=0,i=-1;for(let t=0;t<this._classes.length;t++){const l=this._classes[t];let a=0;for(let o=0;o<this._classes.length;o++)if(t===o){const f=_.reduce((g,u)=>g+(this._y[u]===l?1:0),0)/_.length;a+=(this._t[o].s+f)/(this._t[o].c+1)}else this._t[o].c>0&&(a+=this._t[o].s/this._t[o].c);s<a&&(s=a,i=l)}n[h]=i}return n}}
