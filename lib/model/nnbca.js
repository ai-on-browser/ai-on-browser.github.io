export default class NNBCA{constructor(t="euclid"){switch(this._metric=t,this._metric){case"euclid":this._d=(t,s)=>Math.sqrt(t.reduce(((t,h,i)=>t+(h-s[i])**2),0));break;case"manhattan":this._d=(t,s)=>t.reduce(((t,h,i)=>t+Math.abs(h-s[i])),0);break;case"chebyshev":this._d=(t,s)=>Math.max(...t.map(((t,h)=>Math.abs(t-s[h]))));break;case"minkowski":this._dp=2,this._d=(t,s)=>Math.pow(t.reduce(((t,h,i)=>t+(h-s[i])**this._dp),0),1/this._dp)}}fit(t,s){this._x=t,this._y=s,this._classes=[...new Set(s)];const h=this._x.length;this._distances=Array.from({length:h},(()=>[]));for(let t=0;t<h;t++){this._distances[t][t]={i:t,d:0};for(let s=t+1;s<h;s++){const h=this._d(this._x[t],this._x[s]);this._distances[t][s]={i:s,d:h},this._distances[s][t]={i:t,d:h}}this._distances[t].sort(((t,s)=>t.d-s.d))}this._g=Array.from({length:h},(()=>[])),this._r=1;const i=Array.from({length:h},(()=>[]));let e=[-1,0];for(;;){for(let t=0;t<h;t++){const s=this._distances[t][this._r+1].i;i[t].push(s),i[s].includes(t)&&!this._g[t][s]&&(this._g[t].push(s),this._g[s].push(t))}const t=this._g.reduce(((t,s)=>t+(0===s.length?1:0)),0);if(e[0]!==t?e=[t,1]:e[1]++,0===t||this._r>2&&e[1]>=Math.sqrt(this._r-e[1]))break;this._r++}this._t=[];for(let t=0;t<this._classes.length;t++){this._t[t]={s:0,c:0};const s=this._classes[t];for(let h=0;h<this._x.length;h++)this._y[h]===s&&(this._t[t].c++,0!==this._g[h].length&&(this._t[t].s+=this._g[h].reduce(((t,h)=>t+this._y[h]===s?1:0),0)/this._g[h].length))}}predict(t){const s=Array(t.length).fill(null);for(let h=0;h<t.length;h++){const i=this._x.map(((s,i)=>({i:i,d:this._d(s,t[h])})));i.sort(((t,s)=>t.d-s.d));const e=[];for(let t=0;t<this._r;t++)i[t].d<this._distances[i[t].i][this._r+1].d&&e.push(i[t].i);if(0===e.length)continue;let _=0,c=-1;for(let t=0;t<this._classes.length;t++){const s=this._classes[t];let h=0;for(let i=0;i<this._classes.length;i++)if(t===i){const t=e.reduce(((t,h)=>t+(this._y[h]===s?1:0)),0)/e.length;h+=(this._t[i].s+t)/(this._t[i].c+1)}else this._t[i].c>0&&(h+=this._t[i].s/this._t[i].c);_<h&&(_=h,c=s)}s[h]=c}return s}}