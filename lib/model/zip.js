export default class ZeroInflatedPoisson{constructor(){this._method="ml"}fit(t){"mo"===this._method?this._mo(t):this._ml(t)}_mo(t){const e=t.reduce(((t,e)=>t+e),0)/t.length,h=t.reduce(((t,h)=>t+(h-e)**2),0)/t.length;this._l=(h+e**2)/e-1,this._pi=(h-e)/(h+e**2-e)}_lambert_w(t){if(0===t)return 0;let e=0;for(let h=0;h<20;h++)e-=(e*Math.exp(e)-t)/(Math.exp(e)*(e+1)-(e+2)*(e*Math.exp(e)-t)/(2*e+2));return e}_ml(t){const e=t.length,h=t.reduce(((t,e)=>t+(0===e?1:0)),0),i=t.reduce(((t,e)=>t+e),0)/e,r=i/(1-h/e);this._l=this._lambert_w(-r*Math.exp(-r))+r,this._pi=1-i/this._l}probability(t){return t.map((t=>{if(0===t)return this._pi+(1-this._pi)*Math.exp(-this._l);{let e=1;for(let h=2;h<=t;h++)e*=h;return(1-this._pi)*this._l**t*Math.exp(-this._l)/e}}))}}