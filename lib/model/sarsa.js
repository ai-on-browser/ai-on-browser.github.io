import{QTableBase}from"./q_learning.js";class SARSATable extends QTableBase{constructor(t,s=20,a=.2,e=.99){super(t,s),this._alpha=a,this._gamma=e}update(t,s,a,e,_){t=this._action_index(t),s=this._state_index(s),a=this._action_index(a),e=this._state_index(e);const[i]=this._q(e,a),[h,n]=this._q(s,t);this._table[n]+=this._alpha*(_+this._gamma*i-h)}}export default class SARSAAgent{constructor(t,s=20){this._env=t,this._table=new SARSATable(t,s)}reset(){this._last_action=null}get_score(){return this._table.toArray()}get_action(t,s=.002){return Math.random()>s?this._table.best_action(t):this._env.sample_action(this)}update(t,s,a,e){this._last_action&&this._table.update(this._last_action,this._last_state,t,s,this._last_reward),this._last_action=t,this._last_state=s,this._last_reward=e}}