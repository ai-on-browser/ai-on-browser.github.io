var q=Object.defineProperty;var _=(o,t)=>q(o,"name",{value:t,configurable:!0});import m from"./lowpass.js";const M=_((o,t)=>{let s=0;for(let e=0;e<1e3;e++){const r=t**(e*(e+1))*Math.cos(o*(2*e+1));if(s+=r,Math.abs(r/s)<1e-15)break}return s*2*t**(1/4)},"t2"),p=_((o,t)=>{let s=0;for(let e=1;e<1e3;e++){const r=t**e**2*Math.cos(2*e*o);if(s+=r,Math.abs(r/s)<1e-15)break}return 1+s*2},"t3");export default class b extends m{static{_(this,"EllipticFilter")}constructor(t=1,s=2,e=1,r=.5){super(r),this._n=s,this._xi=e,this._e=t}_K(t){if(t===1)return 1/0;let s=Math.PI/2,e=t;for(;e>1e-15;)e=(1-Math.sqrt(1-e**2))/(1+Math.sqrt(1-e**2)),s*=1+e;return s}_nome(t){return Math.exp(-Math.PI*this._K(Math.sqrt(1-t**2))/this._K(t))}_Ln(t,s){if(t===1)return s;if(t===2)return(s+Math.sqrt(s**2-1))**2;if(t===3){const h=s**2,l=Math.sqrt(4*h+(4*h*(h-1))**(2/3)),c=2*h*Math.sqrt(l)/(Math.sqrt(8*h*(h+1)+12*l*h-l**3)-l**(3/2));return s**3*((1-c)/(s**2-c))**2}if(Number.isInteger(t/2))return this._Ln(2,this._Ln(t/2,s));if(Number.isInteger(t/3))return this._Ln(3,this._Ln(t/3,s));const e=this._nome(1/s)**t;let r=1,n=0;for(;r-n>1e-14;){const h=(r+n)/2,l=this._nome(h);if(e===l)return 1/h;e<l?r=h:n=h}return 1/r}_cd(t,s){const e=this._nome(s),r=Math.PI*t/(2*this._K(s));return p(0,e)/M(0,e)*M(r,e)/p(r,e)}_elliptic(t,s,e){if(t===1)return e;if(e===1)return 1;const r=s**2;if(t===2){const i=Math.sqrt(1-1/r);return((i+1)*e**2-1)/((i-1)*e**2+1)}else if(t===3){const i=Math.sqrt(4*r+(4*r*(r-1))**.6666666666666666),u=2*r*Math.sqrt(i)/(Math.sqrt(8*r*(r+1)+12*i*r-i**3)-i**(3/2)),f=r/u;return e*(1-u)*(e**2-f)/(1-f)/(e**2-u)}if(Number.isInteger(t/2))return this._elliptic(2,this._elliptic(t/2,s,s),this._elliptic(t/2,s,e));if(Number.isInteger(t/3))return this._elliptic(3,this._elliptic(t/3,s,s),this._elliptic(t/3,s,e));const n=this._K(1/s),h=[];for(let i=1;i<=t;i++)h.push(this._cd(n*(2*i-1)/t,1/s));const l=t%2===0?t:t-1;let c=1;for(let i=0;i<l;i++)c*=(1-h[i])/(1-s/h[i]);let a=(t%2===0?1:e)/c;for(let i=0;i<l;i++)a*=(e-h[i])/(e-s/h[i]);return a}_cutoff(t,s,e,r){const n=Math.sqrt(1+(this._e*this._elliptic(this._n,this._xi,t/s))**2);return[e/n,r/n]}}
