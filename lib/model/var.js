var v=Object.defineProperty;var d=(u,e)=>v(u,"name",{value:e,configurable:!0});import p from"../util/matrix.js";export default class a{static{d(this,"VAR")}constructor(e){this._p=e}fit(e){this._levinson(e)}_yuleWalker(e){const h=e.length;e=p.fromArray(e);const o=e.cols,r=new p(this._p*o,o),l=new p(this._p*o,this._p*o);for(let s=0;s<=this._p;s++){const t=e.slice(0,h-s).tDot(e.slice(s,h));if(t.div(h),s>0&&r.set((s-1)*o,0,t),s<this._p)for(let n=0;n<this._p-s;n++)l.set(n*o,(s+n)*o,t),l.set((s+n)*o,n*o,t)}const c=l.solve(r);this._phi=[];for(let s=0;s<this._p;s++)this._phi[s]=c.slice(s*o,(s+1)*o)}_levinson(e){const h=e.length;e=p.fromArray(e);const o=[];for(let t=0;t<=this._p;t++){const n=e.slice(0,h-t).tDot(e.slice(t,h));n.div(h),o[t]=n}const r=[],l=[];r[0]=l[0]=o[0];let c=[],s=[];for(let t=0;t<this._p;t++){const n=o[t+1].copy();for(let i=0;i<t;i++)n.sub(c[i].dot(o[t-i]));const f=[],_=[];f[t]=n.dot(l[t].inv()),_[t]=n.tDot(r[t].inv());for(let i=0;i<t;i++)f[i]=p.sub(c[i],f[t].dot(s[t-i-1])),_[i]=p.sub(s[i],_[t].dot(c[t-i-1]));r[t+1]=o[0].copy(),l[t+1]=o[0].copy();for(let i=0;i<t+1;i++)r[t+1].sub(f[i].dot(o[i+1].t)),l[t+1].sub(_[i].dot(o[i+1]));c=f,s=_}this._phi=c}predict(e,h){const o=[],r=e.slice(e.length-this._p);r.reverse();for(let l=0;l<h;l++){const c=p.zeros(e[0].length,1);for(let s=0;s<this._p;s++)c.add(this._phi[s].dot(p.fromArray(r[s])));o.push(c.value),r.unshift(c.value),r.pop()}return o}}
