export default class NCubicInterpolation{fit(t,i){this._v=t,this._grids=i,this._offset_idx=[];for(let t=0;t<4**this._grids.length;t++)this._offset_idx.push(t.toString(4).padStart(this._grids.length,"0").split(""))}predict(t){return t.map((t=>{const i=[];for(let s=0;s<t.length;s++){if(t[s]<this._grids[s][1]||this._grids[s][this._grids[s].length-2]<t[s])return null;let r=-1;for(let i=0;i<this._grids[s].length&&t[s]>=this._grids[s][i];r=i++);i[s]=r===this._grids[s].length-2?r-1:r}const s=this._offset_idx.map((t=>t.reduce(((t,s,r)=>t[i[r]-1+ +s]),this._v)));for(let r=0;r<this._grids.length;r++){const e=this._grids[r][i[r]],h=this._grids[r][i[r]+1],g=(t[r]-e)/(h-e),l=2*g**2-g**3-g,_=3*g**3-5*g**2+2,d=-3*g**3+4*g**2+g,n=g**3-g**2,o=s.length/4;for(let t=0;t<o;t++)s[t]=(l*s[t]+_*s[t+o]+d*s[t+2*o]+n*s[t+3*o])/2;s.length=o}return s[0]}))}}