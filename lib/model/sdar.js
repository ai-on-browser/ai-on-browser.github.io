const levinsonDurbin=(t,s)=>{let h=[],i=[];for(let t=0;t<s+1;t++)h.push(0),i.push(0);h[0]=1,h[1]=-t[1]/t[0],i[1]=t[0]+t[1]*h[1];let r=-t[1]/t[0];for(let e=1;e<s;e++){r=0;for(let s=0;s<e+1;s++)r-=h[s]*t[e+1-s];r/=i[e];const s=[1];for(let t=1;t<e+1;t++)s.push(h[t]);s.push(0);const _=[0];for(let t=e;t>0;t--)_.push(h[t]);_.push(1),h=[];for(let t=0;t<s.length;t++)h.push(s[t]+r*_[t]);i[e+1]=i[e]*(1-r**2)}return[h,i[i.length-1]]};export default class SDAR{constructor(t=1,s=.8){this._m=Math.random(),this._c=[];for(let s=0;s<t+1;s++)this._c.push(Math.random()/100);this._w=null,this._s=Math.random(),this._r=s,this._p=t,this._x=[]}_update(t){this._m=(1-this._r)*this._m+this._r*t;const s=this._c[this._c.length-1];this._c.unshift((1-this._r)*s+this._r*(t-this._m)**2),this._c.pop();const[h]=levinsonDurbin(this._c,this._p);let i=0;for(let t=0;t<h.length&&t<this._x.length;t++)i-=h[t]*(this._x[this._x.length-t-1]-this._m);const r=i+this._m;return this._x.push(t),this._s=(1-this._r)*this._s+this._r*(t-r)**2,[Math.exp(-.5*(t-r)**2/this._s)/Math.sqrt(2*Math.PI*this._s),r]}probability(t){return t.map((t=>{const[s]=this._update(t);return s}))}predict(t,s){for(let s=0;s<t.length-1;s++)this._update(t[s]);const h=[];let i=t[t.length-1];for(let t=0;t<s;t++){const[,t]=this._update(i);h.push(t),i=t}return h}}