var A=Object.defineProperty;var d=(k,r)=>A(k,"name",{value:r,configurable:!0});import M from"./histogram.js";export default class y{static{d(this,"AverageShiftedHistogram")}constructor(r,i){this._config=r,this._step=i}fit(r){let i=this._config.domain;if(!i){i=r[0].map(t=>[t,t]);for(let t=0;t<r.length;t++)for(let s=0;s<r[t].length;s++)i[s][0]=Math.min(r[t][s],i[s][0]),i[s][1]=Math.max(r[t][s],i[s][1])}const h=this._config.size,e=r[0].length,l=i.map(t=>t[0]),p=i.map(t=>t[1]),g=[],_=[];this._ranges=[];let w=[g];for(let t=0;t<e;t++){const s=[],n=Math.ceil((p[t]-l[t])/h);_.push(n);for(const c of w)for(let f=0;f<n;f++)t===e-1?c.push(0):s.push(c[f]=[]);this._ranges[t]=[l[t]];let o=0;for(;l[t]+ ++o*h<p[t]+h;)this._ranges[t].push(l[t]+o*h);w=s}const m=d((t,s)=>{for(let n=0;n<t.length;n++){if(t[n]++,t[n]<s[n])return!0;t[n]=0}return!1},"nextIndex"),a=Array(e).fill(0),x=Array(e).fill(this._step);do{const t=[];for(let o=0;o<e;o++){const c=[l[o]-a[o]*h,p[o]];t.push(c)}const s=new M({domain:t,size:this._step*h}).fit(r),n=Array(e).fill(0);do{let o=g,c=s;for(let f=0;f<e-1;f++)o=o[n[f]],c=c[Math.floor((n[f]+a[f])/this._step)];o[n[e-1]]+=c[Math.floor((n[e-1]+a[e-1])/this._step)]}while(m(n,_))}while(m(a,x));const u=Array(e).fill(0);do{let t=g;for(let s=0;s<e-1;s++)t=t[u[s]];t[u[e-1]]/=this._step**e}while(m(u,_));return this._dense=g,g}predict(r){return r.map(i=>{let h=this._dense;for(let e=0;e<i.length;e++){if(i[e]<this._ranges[e][0]||this._ranges[e][this._ranges[e].length-1]<i[e])return 0;let l=0;for(;l<this._ranges[e].length-1&&!(i[e]<=this._ranges[e][l+1]);l++);h=h[l]}return h})}}
