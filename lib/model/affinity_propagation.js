export default class AffinityPropagation{constructor(){this._epoch=0,this._l=.8,this._x=[],this._y=null}get categories(){const t=this.predict();return[...new Set(t)]}get centroids(){return this.categories.map((t=>this._x[t]))}get size(){const t=this.predict();return new Set(t).size}get epoch(){return this._epoch}init(t){this._x=t;const s=t.length;this._r=Array(s),this._a=Array(s),this._ar=Array(s),this._s=Array(s),this._as=Array(s);for(let t=0;t<s;t++)this._r[t]=Array(s).fill(0),this._a[t]=Array(s).fill(0),this._ar[t]=Array(s).fill(0),this._s[t]=Array(s),this._as[t]=Array(s);this._y=null,this._epoch=0;let i=1/0;for(let t=0;t<s;t++)for(let s=0;s<t;s++){const h=-this._x[t].reduce(((t,i,h)=>t+(i-this._x[s][h])**2),0);this._s[t][s]=this._s[s][t]=h,this._as[t][s]=this._as[s][t]=h,i=Math.min(i,h)}for(let t=0;t<s;t++)this._s[t][t]=this._as[t][t]=i}fit(){const t=this._x.length,s=this._l;for(let i=0;i<t;i++)for(let h=0;h<t;h++){let r=-1/0;const _=i===h?this._s[i]:this._as[i];for(let s=0;s<t;s++)h!==s&&(r=Math.max(r,_[s]));this._r[i][h]=s*this._r[i][h]+(1-s)*(this._s[i][h]-r)}for(let i=0;i<t;i++)for(let h=0;h<t;h++){let r=i===h?0:this._r[h][h];for(let s=0;s<t;s++)s!==i&&s!==h&&(r+=Math.max(0,this._r[s][h]));i!==h&&(r=Math.min(0,r));const _=s*this._a[i][h]+(1-s)*r;this._a[i][h]=_,this._ar[i][h]=_+this._r[i][h],this._as[i][h]=_+this._s[i][h]}this._y=null,this._epoch++}__fit(){const t=this._x.length;for(let s=0;s<t;s++)for(let i=0;i<t;i++){let h=0;for(let r=0;r<t;r++)r!==i&&(h+=this._a[s][r]*this._s[s][r]);this._r[s][i]=this._s[s][i]/h}for(let s=0;s<t;s++){let i=1;for(let h=0;h<t;h++)h!==s&&(i*=1+this._r[h][s]);this._a[s][s]=i-1,this._ar[s][s]=this._a[s][s]+this._r[s][s];for(let h=0;h<t;h++)if(s!==h){i=1/this._r[s][s]-1;for(let r=0;r<t;r++)r!==s&&r!==h&&(i*=1/(1+this._r[r][s]));this._a[s][h]=1/(1+i),this._ar[s][h]=this._a[s][h]+this._r[s][h]}}this._y=null,this._epoch++}predict(){if(!this._y){this._y=[];const t=this._x.length;for(let s=0;s<t;s++){let i=-1/0,h=-1;for(let r=0;r<t;r++){const t=this._ar[s][r];i<t&&(i=t,h=r)}this._y.push(h)}}return this._y}}