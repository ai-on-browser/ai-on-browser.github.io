var w=Object.defineProperty;var b=(A,n)=>w(A,"name",{value:n,configurable:!0});import k from"../util/matrix.js";export default class G{static{b(this,"LTSA")}constructor(n,l=null){this._k=n,this._rd=l}predict(n){n=k.fromArray(n);const l=n.cols,d=n.rows,v=this._rd||l,f=[];for(let o=0;o<d;o++){f[o]=[];for(let t=0;t<o;t++){let s=0;for(let r=0;r<l;r++)s+=(n.at(o,r)-n.at(t,r))**2;f[o][t]=f[t][o]=s}}const i=[];for(let o=0;o<d;o++){const t=[];for(let s=0;s<d;s++){if(s===o)continue;const r=f[o][s];if(t.length<this._k||r<t[this._k-1].dt){t.length===this._k&&t.pop(),t.push({dt:r,idx:s});for(let e=t.length-1;e>0;e--)t[e].dt<t[e-1].dt&&([t[e],t[e-1]]=[t[e-1],t[e]])}}i.push([o,...t.map(s=>s.idx)])}const h=k.zeros(d,d);for(let o=0;o<d;o++){const t=n.row(i[o]),s=t.mean(0);t.sub(s);const e=t.dot(t.t).eigenVectors(),u=new k(i[o].length,l+1,1/Math.sqrt(i[o].length));u.set(0,1,e.slice(0,l,1));const p=u.dot(u.t);for(let c=0;c<i[o].length;c++){const g=i[o][c];h.addAt(g,g,1+p.at(c,c));for(let a=0;a<c;a++){const m=i[o][a];h.addAt(g,m,p.at(c,a)),h.addAt(m,g,p.at(a,c))}}}const _=h.eigenVectors();return _.flip(1),_.slice(1,v+1,1).toArray()}}
