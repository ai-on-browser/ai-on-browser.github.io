var m=Object.defineProperty;var w=(n,t)=>m(n,"name",{value:t,configurable:!0});import c from"../util/matrix.js";export default class f{static{w(this,"ElasticNet")}constructor(t=.1,s=.5,o="CD"){this._w=null,this._method=o,this._lambda=t,this._alpha=s}_soft_thresholding(t,s){t.map(o=>o<-s?o+s:o>s?o-s:0)}_calc_b0(t,s){const o=this._w.copy();for(let _=0;_<o.cols;_++)o.set(o.rows-1,_,0);const h=t.dot(o);h.isub(s);const l=h.sum(0);l.div(t.rows),this._w.set(this._w.rows-1,0,l)}fit(t,s){t=c.fromArray(t),s=c.fromArray(s),this._w||(this._w=c.randn(t.cols,s.cols));const o=this._lambda*this._alpha,h=this._lambda*(1-this._alpha),l=t.cols;t.concat(c.eye(l,l,Math.sqrt(h)),0),t.div(Math.sqrt(1+h)),s.concat(c.zeros(l,s.cols),0),this._w.mult(Math.sqrt(1+h));const _=o/Math.sqrt(1+h);if(this._method==="ISTA"){const a=t.tDot(t);a.map(e=>Math.abs(e));const r=Math.max.apply(null,a.sum(0).value)/_;let i=t.dot(this._w);i.isub(s),i=t.t.dot(i),i.div(_*r),i.add(this._w),this._soft_thresholding(i,1/r),this._w=i}else if(this._method==="CD")for(let a=0;a<this._w.rows;a++){const d=t.col(a);let r=this._w.copy();for(let e=0;e<this._w.cols;e++)r.set(a,e,0);r=t.dot(r),r.isub(s);const i=d.tDot(r);this._soft_thresholding(i,_),i.div(d.tDot(d)),this._w.set(a,0,i)}this._w.div(Math.sqrt(1+h))}predict(t){return t=c.fromArray(t),t.dot(this._w).toArray()}importance(){return this._w.value}}
