var p=Object.defineProperty;var f=(a,s)=>p(a,"name",{value:s,configurable:!0});import l from"../util/matrix.js";export default class d{static{f(this,"OrderedLogisticRegression")}constructor(s=.1){this._w=null,this._a=s}_s(s){return 1/(1+Math.exp(-s))}fit(s,e){s=l.fromArray(s),this._response||(this._response=[...new Set(e)],this._response.sort((t,r)=>t-r),this._t=Array.from(this._response,(t,r)=>r-1),this._t[0]=-1/0,this._t.push(1/0),this._w=l.randn(s.cols,1,0,.1));const _=s.dot(this._w).value,i=Array(this._t.length).fill(0),o=l.zeros(this._w.rows,this._w.cols);for(let t=0;t<e.length;t++){const r=this._response.indexOf(e[t]),h=this._s(this._t[r]-_[t]),n=this._s(this._t[r+1]-_[t]);if(h===n)continue;i[r]+=h*(1-h)/(h-n),i[r+1]-=n*(1-n)/(h-n);const c=s.row(t).t;c.mult((n*(1-n)-h*(1-h))/(h-n)),o.add(c)}o.mult(this._a/e.length),this._w.add(o);for(let t=1;t<this._t.length-1;t++)this._t[t]+=this._a/e.length*i[t];this._t.sort((t,r)=>t-r)}predict(s){s=l.fromArray(s);const e=s.dot(this._w).value,_=[];for(let i=0;i<e.length;i++){_[i]=null;for(let o=0;o<this._response.length;o++)if(this._t[o]<e[i]&&e[i]<=this._t[o+1]){_[i]=this._response[o];break}}return _}}
