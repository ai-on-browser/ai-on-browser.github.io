export default class KDEOS{constructor(t,e,i="gaussian"){this._kmin=t,this._kmax=e,this._e=1/0,this._phi=.1,this._kernel="gaussian"===i?(t,e,i)=>Math.exp(-(t**2)/(2*e**2))/(e*Math.sqrt(2*Math.PI))**i:(t,e,i)=>3*(1-(t/e)**2)/(4*e**i)}_distance(t,e){return Math.sqrt(t.reduce(((t,i,s)=>t+(i-e[s])**2),0))}_cdf(t){return 1/(1+Math.exp(-1.7*t))}predict(t){const e=t.length,i=[];for(let s=0;s<e;s++){i[s]=[],i[s][s]={d:0,i:s};for(let e=0;e<s;e++){const h=this._distance(t[s],t[e]);i[s][e]={d:h,i:e},i[e][s]={d:h,i:s}}}for(let t=0;t<e;t++)i[t].sort(((t,e)=>t.d-e.d));const s=[],h=t[0].length;for(let t=0;t<e;t++){s[t]=[];for(let e=this._kmin;e<=this._kmax;e++){let r=0;for(let s=0;s<e;s++)r+=i[t][s+1].d;const n=Math.min(r/e,this._e);s[t][e]=0;for(let r=0;r<e;r++)s[t][e]+=this._kernel(i[t][r+1].d,n,h)}}const r=[];for(let t=0;t<e;t++){r[t]=0;for(let e=this._kmin;e<=this._kmax;e++){let h=0;for(let r=0;r<e;r++)h+=s[i[t][r+1].i][e];h/=e;let n=0;for(let r=0;r<e;r++)n+=(s[i[t][r+1].i][e]-h)**2;n=Math.sqrt(n/e),r[t]+=(h-s[t][e])/n}r[t]/=this._kmax-this._kmin+1}for(let t=0;t<e;t++)r[t]=1-this._cdf(r[t]),r[t]=this._phi*(1-r[t])/(this._phi+r[t]);return r}}