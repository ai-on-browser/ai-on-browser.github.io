import Layer from"./base.js";import{Matrix}from"../../util/math.js";export default class VariableLayer extends Layer{constructor({size:t,l2_decay:a=0,l1_decay:s=0,value:e=null,...i}){super(i),this._size=t,this._v=e?Matrix.fromArray(e):Matrix.randn(t[0],t[1]),this._l2_decay=a,this._l1_decay=s,this._n=1}bind({n:t}){this._n=t}calc(){return this._v}grad(t){this._bo=t}update(){const t=this._bo.copyDiv(this._n);if(this._l2_decay>0||this._l1_decay>0)for(let a=0;a<this._v.rows;a++)for(let s=0;s<this._v.cols;s++){const e=this._v.at(a,s);t.addAt(a,s,e*this._l2_decay+Math.sign(e)*this._l1_decay)}this._v.sub(this._opt.delta("v",t))}toObject(){return{type:"variable",size:this._size,l2_decay:this._l2_decay,l1_decay:this._l1_decay,value:this._v.toArray()}}}VariableLayer.registLayer();