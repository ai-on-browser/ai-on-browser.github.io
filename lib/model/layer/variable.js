import Layer from"./base.js";import Matrix from"../../util/matrix.js";export default class VariableLayer extends Layer{constructor({size:t,l2_decay:a=0,l1_decay:e=0,value:i=null,...s}){super(s),this._size=t,this._v=i?Matrix.fromArray(i):Matrix.randn(t[0],t[1]),this._l2_decay=a,this._l1_decay=e,this._n=1}bind({n:t}){this._n=t}calc(){return this._v}grad(t){this._bo=t}update(t){const a=this._bo.copyDiv(this._n);if(this._l2_decay>0||this._l1_decay>0)for(let t=0;t<this._v.rows;t++)for(let e=0;e<this._v.cols;e++){const i=this._v.at(t,e);a.addAt(t,e,i*this._l2_decay+Math.sign(i)*this._l1_decay)}this._v.sub(t.delta("v",a))}toObject(){return{type:"variable",size:this._size,l2_decay:this._l2_decay,l1_decay:this._l1_decay,value:this._v.toArray()}}}VariableLayer.registLayer();