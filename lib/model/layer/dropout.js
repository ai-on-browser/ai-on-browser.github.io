import Layer from"./base.js";export default class DropoutLayer extends Layer{constructor({drop_rate:r=.5,...o}){super(o),this._drop_rate=r}_shuffle(r){const o=Array(r);for(let t=0;t<r;o[t]=t++);for(let t=r-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[o[t],o[r]]=[o[r],o[t]]}return o.slice(0,Math.max(1,Math.floor(r*this._drop_rate)))}calc(r){this._drop_index=this._shuffle(r.cols);const o=r.copy();for(let t=0;t<r.rows;t++)for(const r of this._drop_index)o.set(t,r,0);return o}grad(r){const o=r.copy();for(let t=0;t<r.rows;t++)for(const r of this._drop_index)o.set(t,r,0);return o}}