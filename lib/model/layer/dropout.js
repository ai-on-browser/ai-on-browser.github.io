import Layer from"./base.js";export default class DropoutLayer extends Layer{constructor({drop_rate:r=.5,...t}){super(t),this._drop_rate=r}_shuffle(r){const t=Array(r);for(let o=0;o<r;t[o]=o++);for(let o=r-1;o>0;o--){let r=Math.floor(Math.random()*(o+1));[t[o],t[r]]=[t[r],t[o]]}return t.slice(0,Math.max(1,Math.floor(r*this._drop_rate)))}calc(r){this._drop_index=this._shuffle(r.cols);const t=r.copy();for(let o=0;o<r.rows;o++)for(const r of this._drop_index)t.set(o,r,0);return t}grad(r){const t=r.copy();for(let o=0;o<r.rows;o++)for(const r of this._drop_index)t.set(o,r,0);return t}toObject(){return{type:"dropout",drop_rate:this._drop_rate}}}DropoutLayer.registLayer();