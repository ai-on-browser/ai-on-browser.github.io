import Layer from"./base.js";import{Matrix}from"../../util/math.js";export default class ArgmaxLayer extends Layer{calc(t){return this._i=t,this._o=this._i.argmax(1),this._o}grad(t){this._bo=new Matrix(this._i.rows,this._i.cols);for(let s=0;s<this._i.cols;s++)this._bo.set(0,s,t.copyMult(s));const s=this._i.copy();s.sub(s.max(1)),s.map(Math.exp),s.div(s.sum(1)),this._bi=new Matrix(this._i.rows,this._i.cols);for(let t=0;t<this._bo.rows;t++)for(let i=0;i<this._bo.cols;i++){const o=s.at(t,i);let r=0;for(let a=0;a<this._bo.cols;a++){const h=i===a?1-o:-o;r+=s.at(t,a)*h*this._bo.at(t,a)}this._bi.set(t,i,r)}return this._bi}}