import Layer from"./base.js";import{Matrix}from"../../util/math.js";export default class VarLayer extends Layer{constructor({axis:i=-1,...s}){super(s),this._axis=i}calc(i){return this._i=i,this._m=i.mean(this._axis),this._axis<0?new Matrix(1,1,i.variance()):i.variance(this._axis)}grad(i){if(this._axis<0)return this._i.copyMap((s=>i.value[0]*(2*(s-this._m))/this._i.length));const s=this._i.copySub(this._m);return s.mult(2/this._i.sizes[this._axis]),s.mult(i),s}}