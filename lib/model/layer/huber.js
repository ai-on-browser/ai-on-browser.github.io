import{LossLayer}from"./base.js";import{Matrix}from"../../util/math.js";export default class HuberLayer extends LossLayer{bind({supervisor:t}){this._t=t}calc(t){this._i=t;const s=this._t.copySub(t);return s.map(Math.abs),this._cond=new Matrix(s.rows,s.cols,s.value.map((t=>t<1))),s.map(((t,s)=>this._cond.at(...s)?.5*t*t:t-.5)),new Matrix(1,1,s.sum())}grad(){return this._bi=this._cond.copy(),this._bi.map(((t,s)=>t?this._i.at(...s)-this._t.at(...s):Math.sign(this._i.at(...s)-this._t.at(...s)))),this._bi}}HuberLayer.registLayer();