import{LossLayer}from"./base.js";export default class HuberLayer extends LossLayer{bind({supervisor:s}){this._t=s}calc(s){this._i=s;const t=this._t.copySub(s);return t.map(Math.abs),this._cond=new Matrix(t.rows,t.cols,t.value.map((s=>s<1))),t.map(((s,t)=>this._cond.value[t]?.5*s*s:s-.5)),new Matrix(1,1,t.sum())}grad(){return this._bi=this._cond.copy(),this._bi.map(((s,t)=>s?this._i.value[t]-this._t.value[t]:Math.sign(this._i.value[t]-this._t.value[t]))),this._bi}}