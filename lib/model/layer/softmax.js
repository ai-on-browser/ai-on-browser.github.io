import Layer from"./base.js";import{Matrix}from"../../util/math.js";export default class SoftmaxLayer extends Layer{calc(t){return this._o=t.copySub(t.max(1)),this._o.map(Math.exp),this._o.div(this._o.sum(1)),this._o}grad(t){this._bi=new Matrix(t.rows,t.cols);for(let s=0;s<t.rows;s++)for(let o=0;o<t.cols;o++){const r=this._o.at(s,o);let i=0;for(let a=0;a<t.cols;a++){const e=o===a?1-r:-r;i+=this._o.at(s,a)*e*t.at(s,a)}this._bi.set(s,o,i)}return this._bi}}