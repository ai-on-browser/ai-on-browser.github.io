import Layer from"./base.js";import{Matrix}from"../../util/math.js";export default class SoftmaxLayer extends Layer{calc(t){return this._o=t.copySub(t.max(1)),this._o.map(Math.exp),this._o.div(this._o.sum(1)),this._o}grad(t){this._bi=new Matrix(t.rows,t.cols);for(let s=0;s<t.rows;s++)for(let o=0;o<t.cols;o++){const r=this._o.at(s,o);let a=0;for(let e=0;e<t.cols;e++){const i=o===e?1-r:-r;a+=this._o.at(s,e)*i*t.at(s,e)}this._bi.set(s,o,a)}return this._bi}}SoftmaxLayer.registLayer();