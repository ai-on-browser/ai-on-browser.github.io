import{QTableBase}from"./q_learning.js";class MCTable extends QTableBase{constructor(t,e=20,s=.99){super(t,e),this._g=Array(this._table.length).fill(0),this._epoch=0,this._gamma=s}update(t){let e=0;for(let s=t.length-1;s>=0;s--){const[a,i,h]=t[s],[_,l]=this._q(this._state_index(i),this._action_index(a));e=h+this._gamma*e,this._g[l]=(e+this._g[l]*this._epoch)/(this._epoch+1),this._table[l]=this._g[l]}this._epoch++}}export default class MCAgent{constructor(t,e=20){this._table=new MCTable(t,e)}get_score(t){return this._table.toArray()}get_action(t,e,s=.5){return Math.random()>s?this._table.best_action(e):t.sample_action(this)}update(t){this._table.update(t)}}