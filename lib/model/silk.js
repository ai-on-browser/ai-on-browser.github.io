var d=Object.defineProperty;var f=(o,i)=>d(o,"name",{value:i,configurable:!0});const m={gaussian:f(({s:o=1})=>(i,h)=>Math.exp(-i.reduce((s,e,t)=>s+(e-h[t])**2,0)/o**2),"gaussian"),polynomial:f(({d:o=2})=>(i,h)=>(1+i.reduce((s,e,t)=>s+e*h[t],0))**o,"polynomial")};export class ILK{static{f(this,"ILK")}constructor(i=1,h=1,s=1,e="gaussian",t="hinge"){if(this._eta=i,this._lambda=h,this._c=s,typeof e=="function"?this._kernel=e:(typeof e=="string"&&(e={name:e}),this._kernel=m[e.name](e)),t==="square")this._loss=(l,a,_)=>{const n=this._eta*this._lambda/(1+this._eta*this._lambda);return this._c*(1-n)*(_-(1-n)*l)/(1+this._c*(1-n)*a)};else if(t==="hinge")this._rho=1,this._loss=(l,a,_)=>{const n=this._eta*this._lambda/(1+this._eta*this._lambda),r=_*(this._rho-(1-n)*_*l)/a;return _*r<0?0:_*r>(1-n)*this._c?_*(1-n)*this._c:r};else{if(t==="graph")throw new Error("Not implemented.");t==="logistic"&&(this._loss=(l,a,_)=>{const n=f(c=>{const u=this._eta*this._lambda/(1+this._eta*this._lambda);return(1-u)*this._c*_/(1+Math.exp(_*(1-u)*l+c*_*a))-c},"fn");let r=[0,n(0)],p=[_*this._c,n(_*this._c)];for(;p[0]-r[0]>=1e-8;){const c=(p[0]+r[0])/2,u=n(c);if(u===0)return c;r[1]*u>0?r=[c,u]:p=[c,u]}return(p[0]+r[0])/2})}this._sv=[],this._a=[]}update(i,h){let s=0;for(let a=0;a<this._sv.length;a++)s+=this._a[a]*this._kernel(i,this._sv[a]);const e=this._kernel(i,i),t=this._loss(s,e,h),l=this._eta*this._lambda/(1+this._eta*this._lambda);for(let a=0;a<this._a.length;a++)this._a[a]*=1-l;t!==0&&(this._sv.push(i),this._a.push(t))}fit(i,h){for(let s=0;s<i.length;s++)this.update(i[s],h[s])}predict(i){const h=[];for(let s=0;s<i.length;s++){let e=0;for(let t=0;t<this._sv.length;t++)e+=this._a[t]*this._kernel(i[s],this._sv[t]);h[s]=e<0?-1:1}return h}}export class SILK extends ILK{static{f(this,"SILK")}constructor(i=1,h=1,s=1,e=10,t="gaussian",l="hinge"){super(i,h,s,t,l),this._w=e}update(i,h){if(super.update(i,h),this._sv.length>this._w){let s=1/0,e=-1;for(let t=0;t<this._sv.length;t++)Math.abs(this._a[t])<s&&(s=Math.abs(this._a[t]),e=t);this._a.splice(e,1),this._sv.splice(e,1)}}}
