var d=Object.defineProperty;var f=(p,e)=>d(p,"name",{value:e,configurable:!0});export class ILK{static{f(this,"ILK")}constructor(e=1,l=1,s=1,i="gaussian",t="hinge"){if(this._eta=e,this._lambda=l,this._c=s,typeof i=="function")this._kernel=i;else switch(typeof i=="string"&&(i={name:i}),i.name){case"gaussian":this._s=i.s??1,this._kernel=(n,h)=>Math.exp(-(n.reduce((a,_,r)=>a+(_-h[r])**2,0)**2)/this._s**2);break;case"polynomial":this._d=i.d??2,this._kernel=(n,h)=>(1+n.reduce((a,_,r)=>a+_*h[r]))**this._d;break}if(t==="square")this._loss=(n,h,a)=>{const _=this._eta*this._lambda/(1+this._eta*this._lambda);return this._c*(1-_)*(a-(1-_)*n)/(1+this._c*(1-_)*h)};else if(t==="hinge")this._rho=1,this._loss=(n,h,a)=>{const _=this._eta*this._lambda/(1+this._eta*this._lambda),r=a*(this._rho-(1-_)*a*n)/h;return a*r<0?0:a*r>(1-_)*this._c?a*(1-_)*this._c:r};else{if(t==="graph")throw new Error("Not implemented.");t==="logistic"&&(this._loss=(n,h,a)=>{const _=f(c=>{const o=this._eta*this._lambda/(1+this._eta*this._lambda);return(1-o)*this._c*a/(1+Math.exp(a*(1-o)*n+c*a*h))-c},"fn");let r=[0,_(0)],u=[a*this._c,_(a*this._c)];for(;u[0]-r[0]>=1e-8;){const c=(u[0]+r[0])/2,o=_(c);if(o===0)return c;r[1]*o>0?r=[c,o]:u=[c,o]}return(u[0]+r[0])/2})}this._sv=[],this._a=[]}update(e,l){let s=0;for(let h=0;h<this._sv.length;h++)s+=this._a[h]*this._kernel(e,this._sv[h]);const i=this._kernel(e,e),t=this._loss(s,i,l),n=this._eta*this._lambda/(1+this._eta*this._lambda);for(let h=0;h<this._a.length;h++)this._a[h]*=1-n;t!==0&&(this._sv.push(e),this._a.push(t))}fit(e,l){for(let s=0;s<e.length;s++)this.update(e[s],l[s])}predict(e){const l=[];for(let s=0;s<e.length;s++){let i=0;for(let t=0;t<this._sv.length;t++)i+=this._a[t]*this._kernel(e[s],this._sv[t]);l[s]=i<0?-1:1}return l}}export class SILK extends ILK{static{f(this,"SILK")}constructor(e=1,l=1,s=1,i=10,t="gaussian",n="hinge"){super(e,l,s,t,n),this._w=i}update(e,l){if(super.update(e,l),this._sv.length>this._w){let s=1/0,i=-1;for(let t=0;t<this._sv.length;t++)Math.abs(this._a[t])<s&&(s=Math.abs(this._a[t]),i=t);this._a.splice(i,1),this._sv.splice(i,1)}}}
