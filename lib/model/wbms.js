var g=Object.defineProperty;var _=(e,s)=>g(e,"name",{value:s,configurable:!0});const d={gaussian:_(e=>Math.exp(-e*e/2),"gaussian"),rectangular:_(e=>Math.abs(e)<=1?.5:0,"rectangular"),triangular:_(e=>Math.abs(e)<=1?1-Math.abs(e):0,"triangular"),epanechnikov:_(e=>Math.abs(e)<=1?3*(1-e**2)/4:0,"epanechnikov"),biweight:_(e=>Math.abs(e)<=1?.9375*(1-e**2)**2:0,"biweight"),triweight:_(e=>Math.abs(e)<=1?1.09375*(1-e**2)**3:0,"triweight")};export default class u{static{_(this,"WeightedBlurringMeanShift")}constructor(s,i,a,h="gaussian"){this._x=null,this._c=[],this._h=s,this._lambda=i,this._threshold=a,typeof h=="function"?this._kernel=h:(typeof h=="string"&&(h={name:h}),this._kernel=d[h.name])}get categories(){const s=this.predict();return[...new Set(s)]}get size(){const s=this.predict();return new Set(s).size}_distance(s,i){return Math.sqrt(s.reduce((a,h,t)=>a+this._w[t]*(h-i[t])**2,0))}init(s){this._x=s,this._c=this._x.map(a=>[].concat(a));const i=this._x[0].length;this._w=Array(i).fill(1/i)}predict(){const s=[];for(let i=0;i<this._c.length;i++){let a=i;for(let h=0;h<i;h++)if(this._distance(this._c[i],this._c[h])<this._threshold){a=s[h];break}s[i]=a}return s}fit(){const s=this._x.length,i=[];for(let t=0;t<s;t++){i[t]=[],i[t][t]=this._kernel(this._distance(this._c[t],this._c[t])/this._h);for(let n=0;n<t;n++)i[t][n]=i[n][t]=this._kernel(this._distance(this._c[t],this._c[n])/this._h)}let a=!1;this._c=this._c.map((t,n)=>{let c=0;const o=Array(t.length).fill(0);for(let r=0;r<s;r++){c+=i[n][r];for(let l=0;l<o.length;l++)o[l]+=this._c[r][l]*i[n][r]}const f=o.map(r=>r/c);return a||=t.some((r,l)=>r!==f[l]),f});let h=0;for(let t=0;t<this._w.length;t++){let n=0;for(let c=0;c<s;c++)n+=(this._x[c][t]-this._c[c][t])**2;this._w[t]=Math.exp(-n/(s*this._lambda)),h+=this._w[t]}return this._w=this._w.map(t=>t/h),a}}
