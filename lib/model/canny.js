export default class Canny{constructor(t,l){this._bigth=t,this._smlth=l}_convolute(t,l){const e=[];for(let n=0;n<t.length;n++){e[n]=[];for(let h=0;h<t[n].length;h++){let o=0;for(let e=0;e<l.length;e++){let r=n+e-Math.floor(l.length/2);r=Math.max(0,Math.min(t.length-1,r));for(let n=0;n<l[e].length;n++){let s=h+n-Math.floor(l[e].length/2);s=Math.max(0,Math.min(t[r].length-1,s)),o+=t[r][s]*l[e][n]}}e[n][h]=o}}return e}_gaussian(t){return this._convolute(t,[[1/16,2/16,1/16],[2/16,.25,2/16],[1/16,2/16,1/16]])}predict(t){t=this._gaussian(t);const l=this._convolute(t,[[1,0,-1],[2,0,-2],[1,0,-1]]),e=this._convolute(t,[[1,2,1],[0,0,0],[-1,-2,-1]]),n=[],h=[];for(let t=0;t<l.length;t++){n[t]=[],h[t]=[];for(let o=0;o<l[t].length;o++)n[t][o]=Math.sqrt(l[t][o]**2+e[t][o]**2),h[t][o]=360*Math.atan2(e[t][o],l[t][o])/(2*Math.PI)}const o=[];for(let t=0;t<n.length;t++){o[t]=[];for(let l=0;l<n[t].length;l++){if(0===t||t===n.length-1||0===l||l===n[t].length-1){o[t][l]=0;continue}o[t][l]=n[t][l];const e=h[t][l];-22.5<=e&&e<22.5||157.5<=e||e<-157.5?(n[t][l]<n[t][l-1]||n[t][l]<n[t][l+1])&&(o[t][l]=0):22.5<=e&&e<67.5||-157.5<=e&&e<-112.5?(n[t][l]<n[t+1][l-1]||n[t][l]<n[t-1][l+1])&&(o[t][l]=0):67.5<=e&&e<112.5||-112.5<=e&&e<-67.5?(n[t][l]<n[t+1][l]||n[t][l]<n[t-1][l])&&(o[t][l]=0):(112.5<=e&&e<157.5||-67.5<=e&&e<-22.5)&&(n[t][l]<n[t+1][l+1]||n[t][l]<n[t-1][l-1])&&(o[t][l]=0)}}const r=[];for(let t=0;t<o.length;t++)r[t]=Array(o[t].length).fill(!1);for(let t=0;t<o.length;t++)for(let l=0;l<o[t].length;l++)if(o[t][l]>=this._bigth){const e=[[t,l]];for(;e.length>0;){const[t,l]=e.pop();t<0||o.length<=t||l<0||o[t].length<=l||(r[t][l]||o[t][l]<this._smlth||(r[t][l]=!0,e.push([t+1,l],[t-1,l],[t,l+1],[t,l-1])))}}return r}}