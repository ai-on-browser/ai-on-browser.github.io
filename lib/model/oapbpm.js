var a=Object.defineProperty;var o=(b,_)=>a(b,"name",{value:_,configurable:!0});export default class g{static{o(this,"OAPBPM")}constructor(_,e,i=.1){this._n=_,this._tau=e,this._wh=null,this._w=[],this._a=i,this._bh=[0,1/0],this._b=Array.from({length:_},()=>[0,1/0]),this._min=1}_update(_,e,i){const t=this._w[i].reduce((h,s,r)=>h+s*_[r],0);let l=0;for(;l<this._b[i].length&&!(t-this._b[i][l]<0);l++);const n=l+this._min;if(e===n)return;let f=0;for(let h=0;h<this._b[i].length-1;h++){const s=e<=h+this._min?-1:1;(t-this._b[i][h])*s<=0&&(f+=s,this._b[i][h]-=this._a*s)}for(let h=0;h<this._w[i].length;h++)this._w[i][h]+=this._a*f*_[h]}fit(_,e){if(!this._wh)for(let i=0;i<this._n;i++)this._w[i]=Array(_[0].length).fill(0);for(let i=0;i<_.length;i++){if(e[i]<this._min){for(let t=0;t<this._b.length;t++)this._b[t].splice(0,0,...Array(this._min-e[i]).fill(this._b[t][0]));this._min=e[i]}else if(e[i]>=this._min+this._b[0].length)for(let t=0;t<this._b.length;t++)this._b[t].splice(this._b[t].length-1,0,...Array(this._min+this._b[t].length-e[i]+1).fill(this._b[t][this._b[t].length-2]));for(let t=0;t<this._n;t++){const l=this._w[t].reduce((h,s,r)=>h+s*_[i][r],0);let n=0;for(;n<this._b[t].length&&!(l-this._b[t][n]<0);n++);const f=n+this._min;if(Math.random()<this._tau&&e[i]!==f){let h=0;for(let s=0;s<this._b[t].length-1;s++){const r=e[i]<=s+this._min?-1:1;(l-this._b[t][s])*r<=0&&(h+=r,this._b[t][s]-=this._a*r)}for(let s=0;s<this._w[t].length;s++)this._w[t][s]+=this._a*h*_[i][s]}}}this._wh=Array(this._w[0].length).fill(0),this._bh=Array(this._b[0].length).fill(0);for(let i=0;i<this._n;i++){for(let t=0;t<this._wh.length;t++)this._wh[t]+=this._w[i][t]/this._n;for(let t=0;t<this._bh.length;t++)this._bh[t]+=this._b[i][t]/this._n}}predict(_){const e=[];for(let i=0;i<_.length;i++){const t=this._wh.reduce((n,f,h)=>n+f*_[i][h],0);let l=0;for(;l<this._bh.length&&!(t-this._bh[l]<0);l++);e[i]=l+this._min}return e}}
