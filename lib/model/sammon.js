import{Matrix}from"../util/math.js";export default class Sammon{constructor(t,s){this._x=t;const r=this._x.length;this._y=Matrix.randn(r,s),this._alpha=.3,this._d=Matrix.zeros(r,r);for(let s=0;s<r;s++)for(let i=s+1;i<r;i++){let r=0;for(let o=0;o<t[s].length;o++)r+=(t[s][o]-t[i][o])**2;r=Math.sqrt(r),this._d.set(s,i,r),this._d.set(i,s,r)}}fit(){const t=this._d.sum(),s=this._y.rows,r=this._y.cols;for(let i=0;i<s;i++){let o=Matrix.zeros(1,r),h=Matrix.zeros(1,r);for(let a=0;a<s;a++){if(i===a)continue;let s=0;for(let t=0;t<r;t++)s+=(this._y.at(i,t)-this._y.at(a,t))**2;if(s=Math.sqrt(s),0===s)continue;const e=(this._d.at(i,a)-s)/(this._d.at(i,a)*s),_=this._y.row(i).copySub(this._y.row(a));o.sub(_.copyMult(2/t*e)),h.sub(_.copyMap((r=>2/t*e*(1-r**2/s*(1/(this._d.at(i,a)-s)+1/s)))))}for(let t=0;t<r;t++)this._y.subAt(i,t,this._alpha*o.at(0,t)/Math.abs(h.at(0,t)))}return this._y.toArray()}predict(){return this._y.toArray()}}