var u=Object.defineProperty;var f=(l,r)=>u(l,"name",{value:r,configurable:!0});import a from"../util/matrix.js";export default class y{static{f(this,"Sammon")}constructor(r,n){this._x=r;const i=this._x.length;this._y=a.randn(i,n),this._alpha=.3,this._d=a.zeros(i,i);for(let s=0;s<i;s++)for(let h=s+1;h<i;h++){let e=0;for(let t=0;t<r[s].length;t++)e+=(r[s][t]-r[h][t])**2;e=Math.sqrt(e),this._d.set(s,h,e),this._d.set(h,s,e)}}fit(){const r=this._d.sum(),n=this._y.rows,i=this._y.cols;for(let s=0;s<n;s++){let h=a.zeros(1,i),e=a.zeros(1,i);for(let t=0;t<n;t++){if(s===t)continue;let o=0;for(let _=0;_<i;_++)o+=(this._y.at(s,_)-this._y.at(t,_))**2;if(o=Math.sqrt(o),o===0)continue;const d=(this._d.at(s,t)-o)/(this._d.at(s,t)*o),c=a.sub(this._y.row(s),this._y.row(t));h.sub(a.mult(c,2/r*d)),e.sub(a.map(c,_=>2/r*d*(1-_**2/o*(1/(this._d.at(s,t)-o)+1/o))))}for(let t=0;t<i;t++)this._y.subAt(s,t,this._alpha*h.at(0,t)/Math.abs(e.at(0,t)))}return this._y.toArray()}predict(){return this._y.toArray()}}
