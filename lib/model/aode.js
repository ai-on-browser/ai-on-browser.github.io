var u=Object.defineProperty;var p=(c,t)=>u(c,"name",{value:t,configurable:!0});import o from"../util/matrix.js";class b{static{p(this,"Gaussian")}constructor(){this._means=null,this._vars=null}_estimate_prob(t){this._means=t.mean(0),this._vars=t.variance(0)}_data_prob(t){const s=o.sub(t,this._means);return s.mult(s),s.div(this._vars),s.map(i=>Math.exp(-i/2)),s.div(o.map(this._vars,i=>Math.sqrt(2*Math.PI*i))),s.prod(1)}}class x{static{p(this,"ODE")}constructor(t=20,s="gaussian"){this._discrete=t,this._m=1,s==="gaussian"&&(this._p_class=b),this._p=[]}fit(t,s,i){this._k=i,this._labels=[...new Set(s)],this._p=[];const h=o.fromArray(t).col(i),n=h.max(),e=h.min();this._r=[-1/0];for(let r=1;r<this._discrete;r++)this._r[r]=e+(n-e)*r/this._discrete;this._r.push(1/0),this._rate=[];for(let r=0;r<this._labels.length;r++){this._rate[r]=[],this._p[r]=[];for(let l=0;l<this._discrete;l++){const a=t.filter((m,f)=>s[f]===this._labels[r]&&this._r[l]<=m[i]&&m[i]<this._r[l+1]);a.length>=this._m?(this._p[r][l]=new this._p_class,this._p[r][l]._estimate_prob(o.fromArray(a),r,l),this._rate[r][l]=a.length/t.length):this._rate[r][l]=0}}}probability(t){const s=[];for(let i=0;i<this._labels.length;i++){const _=t.map(h=>{const n=new o(1,h.length,h);for(let e=0;e<this._discrete;e++)if(this._r[e]<=h[this._k]&&h[this._k]<this._r[e+1])return this._rate[i][e]===0?0:this._p[i][e]._data_prob(n,i,e).toScaler()*this._rate[i][e]});s.push(_)}return s}predict(t){const s=this.probability(t);return t.map((i,_)=>{let h=0,n=-1;for(let e=0;e<this._labels.length;e++){let r=s[e][_];r>h&&(h=r,n=e)}return this._labels[n]})}}export default class d{static{p(this,"AODE")}constructor(t=20){this._discrete=t}fit(t,s){const i=t[0].length;this._labels=[...new Set(s)],this._ode=[];for(let _=0;_<i;_++){const h=new x(this._discrete);h.fit(t,s,_),this._ode[_]=h}}predict(t){const s=this._ode.map(_=>_.probability(t)),i=[];for(let _=0;_<t.length;_++){let h=-1/0,n=-1;for(let e=0;e<this._labels.length;e++){const r=s.reduce((l,a)=>l+a[e][_],0)/this._ode.length;r>h&&(h=r,n=e)}i[_]=h>0?this._labels[n]:null}return i}}
