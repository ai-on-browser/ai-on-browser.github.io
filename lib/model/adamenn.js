export default class ADAMENN{constructor(t=null,s=3,i=null,h=null,e=3,l=.5){this._k0=t,this._k1=s,this._k2=i,this._l=h,this._k=e,this._c=l,this._itr=2}_d(t,s,i){return Math.sqrt(t.reduce(((t,h,e)=>t+i[e]*(h-s[e])**2),0))}fit(t,s){this._x=t,this._y=s,this._classes=[...new Set(s)],this._k0||(this._k0=Math.ceil(.1*this._x.length)),this._k2||(this._k2=Math.ceil(.15*this._x.length)),this._l||(this._l=Math.ceil(this._k2/2))}predict(t){const s=this._x.length,i=this._x[0].length;return t.map((t=>{const h=Array(i).fill(1/i);for(let e=0;e<this._itr;e++){const e=[];for(let i=0;i<s;i++)e[i]={i:i,d:this._d(t,this._x[i],h)};e.sort(((t,s)=>t.d-s.d));const l=[],r=Array.from({length:this._classes.length},(()=>[])),_=Array.from({length:this._classes.length},(()=>Array.from({length:i},(()=>[]))));for(let t=0;t<this._k0;t++){const o=e[t+1].i;l[o]=[];for(let t=0;t<s;t++)l[o][t]=t===o?{i:t,d:0}:{i:t,d:this._d(this._x[o],this._x[t],h)};l[o].sort(((t,s)=>t.d-s.d));for(let s=0;s<this._classes.length;s++){r[s][t]=0;for(let i=0;i<this._k1;i++)this._y[l[o][i+1].i]===this._classes[s]&&r[s][t]++;r[s][t]/=this._k1}for(let h=0;h<i;h++){const i=[];for(let t=0;t<s;t++)i[t]={i:t,d:Math.abs(this._x[o][h]-this._x[t][h])};i.sort(((t,s)=>t.d-s.d));const e=[];for(let t=0;t<s-1&&e.length<this._l;t++)for(let s=0;s<this._k2;s++)if(i[t+1].i===l[o][s+1].i){e.push(i[t+1].i);break}for(let s=0;s<this._classes.length;s++){_[s][h][t]=0;for(let i=0;i<e.length;i++)this._y[e[i]]===this._classes[s]&&_[s][h][t]++;r[s][t]/=e.length}}}const o=Array(i).fill(0);for(let t=0;t<i;t++){for(let s=0;s<this._k0;s++)for(let i=0;i<this._classes.length;i++)_[i][t][s]>0&&(o[t]+=(r[i][s]-_[i][t][s])**2/_[i][t][s]);o[t]/=this._k0}const n=o.map((t=>Math.exp(this._c/t))),c=n.reduce(((t,s)=>t+s),0),a=h.concat();for(let t=0;t<i;t++)h[t]=n[t]/c;if(a.reduce(((t,s,i)=>t+(s-h[i])**2),0)<1e-32)break}const e=[];for(let i=0;i<s;i++)e[i]={i:i,d:this._d(t,this._x[i],h)};e.sort(((t,s)=>t.d-s.d));const l={};for(let t=0;t<this._k;t++){const s=this._y[e[t+1].i];l[s]?(l[s].count+=1,l[s].min_d=Math.min(l[s].min_d,e[t+1].d)):l[s]={category:s,count:1,min_d:e[t+1].d}}let r=0,_=-1,o=null;for(const t of Object.keys(l))(r<l[t].count||r===l[t].count&&l[t].min_d<_)&&(r=l[t].count,_=l[t].min_d,o=l[t].category);return o}))}}