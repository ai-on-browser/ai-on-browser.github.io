var p=Object.defineProperty;var l=(f,t)=>p(f,"name",{value:t,configurable:!0});import c from"../util/matrix.js";export default class d{static{l(this,"OrderedProbitRegression")}constructor(t=.001){this._w=null,this._s=1,this._a=t}_gaussian(t){return t===1/0||t===-1/0?0:Math.exp(-(t**2)/(2*this._s**2))/Math.sqrt(2*Math.PI*this._s**2)}_cdf(t){if(t===1/0)return 1;if(t===-1/0)return 0;const h=.3275911,n=.254829592,r=-.284496736,e=1.421413741,s=-1.453152027,i=1.061405429,a=t<0?-1:1,o=Math.abs(t)/Math.sqrt(2*this._s**2),_=1/(1+h*o),u=1-((((i*_+s)*_+e)*_+r)*_+n)*_*Math.exp(-o*o);return .5*(1+a*u)}fit(t,h){t=c.fromArray(t),this._response||(this._response=[...new Set(h)],this._response.sort((s,i)=>s-i),this._t=Array.from(this._response,(s,i)=>i-1),this._t[0]=-1/0,this._t.push(1/0),this._w=c.randn(t.cols,1,0,.1));const n=t.dot(this._w).value,r=Array(this._t.length).fill(0),e=c.zeros(this._w.rows,this._w.cols);for(let s=0;s<h.length;s++){const i=this._response.indexOf(h[s]),a=this._cdf(this._t[i]-n[s]),o=this._cdf(this._t[i+1]-n[s]);if(a===o)continue;r[i]+=this._gaussian(this._t[i]-n[s])/(a-o),r[i+1]-=this._gaussian(this._t[i+1]-n[s])/(a-o);const _=t.row(s).t;_.mult((this._gaussian(this._t[i+1]-n[s])-this._gaussian(this._t[i]-n[s]))/(a-o)),e.add(_)}e.mult(this._a/h.length),this._w.add(e);for(let s=1;s<this._t.length-1;s++)this._t[s]+=this._a/h.length*r[s];this._t.sort((s,i)=>s-i)}predict(t){t=c.fromArray(t);const h=t.dot(this._w).value,n=[];for(let r=0;r<h.length;r++){n[r]=null;for(let e=0;e<this._response.length;e++)if(this._t[e]<h[r]&&h[r]<=this._t[e+1]){n[r]=this._response[e];break}}return n}}
