var g=Object.defineProperty;var u=(m,t)=>g(m,"name",{value:t,configurable:!0});import s from"../util/matrix.js";import{PCA as v}from"./pca.js";export default class y{static{u(this,"ICA")}constructor(){this._w=null,this._alpha=.1}fit(t){t=s.fromArray(t);const a=t.cols;this._w||(this._w=s.zeros(a,a)),t=s.sub(t,t.mean(0));const n=new v;n.fit(t);const w=s.fromArray(n.predict(t)),f=1e-12,l=[];for(let i=0;i<a;i++){let o=s.randn(a,1);if(i>0){const c=this._w.slice(0,i),h=c.dot(o);c.mult(h),o.sub(c.sum(0).t)}o.div(o.norm());let p=1e4;for(;p-- >0;){const c=w.dot(o),h=s.map(c,r=>Math.tanh(r*this._alpha)),_=s.mult(w,h).mean(0).t,d=s.map(c,r=>this._alpha*(1-Math.tanh(this._alpha*r)**2)),b=s.mult(o,d.mean()),e=s.sub(_,b);if(i>0){const r=this._w.row(l),M=r.dot(e);r.mult(M),e.sub(r.sum(0).t)}e.div(e.norm());const A=s.mult(o,e);if(Math.abs(Math.abs(A.sum())-1)<f)break;o=e}this._w.set(i,0,o.t),l.push(i)}}predict(t,a=0){t=s.fromArray(t);const n=this._w.t;return a>0&&a<n.cols&&n.resize(n.rows,a),t.dot(n).toArray()}}
