import Matrix from"../util/matrix.js";export default class MOD{constructor(t,r,s=r){this._x=Matrix.fromArray(t),this._m=r,this._k=s,this._d=Matrix.randn(this._x.cols,r),this._d.div(Matrix.map(Matrix.map(this._d,(t=>t**2)).mean(0),Math.sqrt))}fit(){const t=new Matrix(this._x.rows,this._m);for(let r=0;r<this._x.rows;r++){const s=this._omp(this._x.row(r).t);t.set(r,0,s.t)}return this._d=this._x.tDot(t.dot(t.tDot(t).inv())),this._r=t,this._r.toArray()}_omp(t){let r=Matrix.zeros(this._m,1),s=t;const i=[];for(let o=0;o<this._k;o++){let o=1/0,e=-1;for(let t=0;t<this._m;t++){if(i.includes(t))continue;const r=this._d.col(t),h=s.norm()**2-r.tDot(s).toScaler()**2/(r.norm()**2+1e-12);h<o&&(o=h,e=t)}i.push(e);const h=this._d.col(i),_=h.tDot(h).solve(h.tDot(t));for(let t=0;t<i.length;t++)r.set(i[t],0,_.row(t));if(s=Matrix.sub(t,h.dot(_)),s.norm()<1e-8)break}return r}predict(){return this._r.toArray()}}