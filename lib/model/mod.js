var x=Object.defineProperty;var f=(h,t)=>x(h,"name",{value:t,configurable:!0});import o from"../util/matrix.js";export default class u{static{f(this,"MOD")}constructor(t,s=t){this._m=t,this._k=s}init(t){this._x=o.fromArray(t),this._d=o.randn(this._x.cols,this._m),this._d.div(o.map(o.map(this._d,s=>s**2).mean(0),Math.sqrt))}fit(){const t=new o(this._x.rows,this._m);for(let s=0;s<this._x.rows;s++){const r=this._omp(this._x.row(s).t);t.set(s,0,r.t)}return this._d=this._x.tDot(t.dot(t.tDot(t).inv())),this._r=t,this._r.toArray()}_omp(t){const s=o.zeros(this._m,1);let r=t;const n=[];for(let _=0;_<this._k;_++){let c=1/0,m=-1;for(let i=0;i<this._m;i++){if(n.includes(i))continue;const a=this._d.col(i),d=r.norm()**2-a.tDot(r).toScaler()**2/(a.norm()**2+1e-12);d<c&&(c=d,m=i)}n.push(m);const e=this._d.col(n),l=e.tDot(e).solve(e.tDot(t));for(let i=0;i<n.length;i++)s.set(n[i],0,l.row(i));if(r=o.sub(t,e.dot(l)),r.norm()<1e-8)break}return s}predict(){return this._r.toArray()}}
