var x=Object.defineProperty;var f=(h,t)=>x(h,"name",{value:t,configurable:!0});import e from"../util/matrix.js";export default class u{static{f(this,"MOD")}constructor(t,s,o=s){this._x=e.fromArray(t),this._m=s,this._k=o,this._d=e.randn(this._x.cols,s),this._d.div(e.map(e.map(this._d,r=>r**2).mean(0),Math.sqrt))}fit(){const t=new e(this._x.rows,this._m);for(let s=0;s<this._x.rows;s++){const o=this._omp(this._x.row(s).t);t.set(s,0,o.t)}return this._d=this._x.tDot(t.dot(t.tDot(t).inv())),this._r=t,this._r.toArray()}_omp(t){let s=e.zeros(this._m,1),o=t;const r=[];for(let _=0;_<this._k;_++){let c=1/0,l=-1;for(let i=0;i<this._m;i++){if(r.includes(i))continue;const m=this._d.col(i),d=o.norm()**2-m.tDot(o).toScaler()**2/(m.norm()**2+1e-12);d<c&&(c=d,l=i)}r.push(l);const n=this._d.col(r),a=n.tDot(n).solve(n.tDot(t));for(let i=0;i<r.length;i++)s.set(r[i],0,a.row(i));if(o=e.sub(t,n.dot(a)),o.norm()<1e-8)break}return s}predict(){return this._r.toArray()}}
