var r=Object.defineProperty;var n=(d,s)=>r(d,"name",{value:s,configurable:!0});import e from"../util/matrix.js";export default class o{static{n(this,"PLSA")}constructor(s=2){this._k=s,this._beta=1}init(s){const _=new Set;for(let t=0;t<s.length;t++)for(let i=0;i<s[t].length;i++)_.add(s[t][i]);this._w=[..._],this._d=s.map(t=>t.map(i=>this._w.indexOf(i))),this._n=e.zeros(this._d.length,this._w.length);for(let t=0;t<this._d.length;t++)for(let i=0;i<this._d[t].length;i++)this._n.addAt(t,this._d[t][i],1);this._pz=Array(this._k).fill(1/this._k),this._pwz=new e(this._w.length,this._k,1/this._w.length),this._pdz=e.random(this._d.length,this._k,0,1),this._pdz.div(this._pdz.sum(0)),this._pzdw=[];for(let t=0;t<this._k;t++)this._pzdw[t]=new e(this._d.length,this._w.length,1/this._k)}fit(){for(let s=0;s<this._d.length;s++)for(let _=0;_<this._w.length;_++){const t=[];for(let h=0;h<this._k;h++)t[h]=this._pz[h]*this._pdz.at(s,h)*this._pwz.at(_,h);const i=t.reduce((h,l)=>h+l,0);for(let h=0;h<this._k;h++)this._pzdw[h].set(s,_,t[h]/(i+1e-12))}for(let s=0;s<this._k;s++){const _=e.mult(this._n,this._pzdw[s]),t=_.sum(0);t.div(t.sum()+1e-12),this._pwz.set(0,s,t.t);const i=_.sum(1);i.div(i.sum()+1e-12),this._pdz.set(0,s,i),this._pz[s]=_.sum()/this._n.sum()}}predict(){return this._pdz.argmax(1).value}}
