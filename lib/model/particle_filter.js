import{Matrix}from"../util/math.js";export default class ParticleFilter{constructor(){this._n=2e3,this._l=20,this._noise=.2}fit(t){const o=t.length,r=t[0].length,e=[(t=Matrix.fromArray(t).t).col(0).copyRepeat(this._n,1)];for(let n=0;n<o;n++){const o=e[n].copyAdd(Matrix.randn(r,this._n).copyMult(this._noise)),i=t.col(n).copySub(o);i.map((t=>Math.exp(-(t**2))));const l=[i.col(0).mean()];for(let t=1;t<this._n;t++)l[t]=l[t-1]+i.col(t).mean();const s=l[this._n-1],a=Math.floor(Math.random()*s),c=[];for(let t=0;t<this._n;t++)c[t]=(t*s/this._n+a)%s;const h=[];for(let t=0;t<this._n;t++)for(let o=0;o<this._n;o++)if(l[o]>=c[t]){h[t]=o;break}for(let t=0;t<this._l;t++){let o=n-(this._l-t);o<0&&(o=0),e[o]=e[o].col(h)}e[n]=o.col(h),e[n+1]=e[n]}return e.map((t=>t.mean(1).value))}predict(t){return[]}}