export default class Banditron{constructor(s=.5){this._gamma=s,this._classes=[],this._w=[],this._b=[]}fit(s,t){for(let e=0;e<s.length;e++){let h=this._classes.indexOf(t[e]);h<0&&(h=this._classes.length,this._classes.push(t[e]),this._w.push(Array(s[e].length).fill(0)),this._b.push(0));let l=-1/0,i=-1;for(let t=0;t<this._classes.length;t++){const h=this._w[t].reduce(((t,h,l)=>t+h*s[e][l]),this._b[t]);h>l&&(l=h,i=t)}let _=Math.random(),a=-1;const c=[];for(let s=0;s<this._classes.length;s++)c[s]=this._gamma/this._classes.length+(h===s?1-this._gamma:0),_-=c[s],a<0&&_<0&&(a=s);for(let t=0;t<this._classes.length;t++){const l=(h===a&&a===t?1/c[t]:0)-(i===t?1:0);if(0!==l){for(let h=0;h<s[e].length;h++)this._w[t][h]+=s[e][h]*l;this._b[t]+=l}}}}predict(s){const t=[];for(let e=0;e<s.length;e++){let h=-1/0,l=-1;for(let t=0;t<this._classes.length;t++){const i=this._w[t].reduce(((t,h,l)=>t+h*s[e][l]),this._b[t]);i>h&&(h=i,l=t)}t[e]=this._classes[l]}return t}}