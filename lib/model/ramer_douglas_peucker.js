export default class RamerDouglasPeucker{constructor(t=.1){this._e=t}_d(t,s,i){return Math.abs((s[1]-t[1])*i[0]-(s[0]-t[0])*i[1]+s[0]*t[1]-s[1]*t[0])/Math.sqrt((s[1]-t[1])**2+(s[0]-t[0])**2)}fit(t,s){const i=t.length,r=t.map(((t,i)=>[t,s[i]]));r.sort(((t,s)=>t[0]-s[0])),t=r.map((t=>t[0])),s=r.map((t=>t[1]));const e=[[0,i-1]];for(;;){let i=0,r=-1,h=-1;for(let _=0;_<e.length;_++){const n=[t[e[_][0]],s[e[_][0]]],o=[t[e[_][1]],s[e[_][1]]];for(let a=e[_][0]+1;a<e[_][1];a++){const e=this._d(n,o,[t[a],s[a]]);e>i&&(i=e,r=_,h=a)}}if(0===i||i<this._e)break;e.splice(r,1,[e[r][0],h],[h,e[r][1]])}this._x=t,this._y=s,this._seg=e}predict(t){const s=this._x.length;return t.map((t=>{if(t<=this._x[0])return this._y[0];if(t>=this._x[s-1])return this._y[s-1];for(const[s,i]of this._seg)if(t<this._x[i])return this._y[s]+(t-this._x[s])*(this._y[i]-this._y[s])/(this._x[i]-this._x[s]);return 0}))}}