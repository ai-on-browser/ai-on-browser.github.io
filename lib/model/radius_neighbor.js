var _=Object.defineProperty;var o=(c,e)=>_(c,"name",{value:e,configurable:!0});const l={euclid:o(()=>(c,e)=>Math.sqrt(c.reduce((t,i,s)=>t+(i-e[s])**2,0)),"euclid"),manhattan:o(()=>(c,e)=>c.reduce((t,i,s)=>t+Math.abs(i-e[s]),0),"manhattan"),chebyshev:o(()=>(c,e)=>Math.max(...c.map((t,i)=>Math.abs(t-e[i]))),"chebyshev"),minkowski:o(({p:c=2}={})=>(e,t)=>Math.pow(e.reduce((i,s,r)=>i+(s-t[r])**c,0),1/c),"minkowski")};class d{static{o(this,"RadiusNeighborBase")}constructor(e=1,t="euclid"){this._p=[],this._c=[],this._r=e,this._metric=t,typeof this._metric=="function"?this._d=this._metric:this._d=l[this._metric]()}_near_points(e){const t=[];return this._p.forEach((i,s)=>{const r=this._d(e,i);r<this._r&&t.push({d:r,category:this._c[s],idx:s})}),t}_add(e,t){this._p.push(e),this._c.push(t)}}export class RadiusNeighbor extends d{static{o(this,"RadiusNeighbor")}constructor(e=1,t="euclid"){super(e,t)}add(e,t){super._add(e,t)}fit(e,t){for(let i=0;i<e.length;i++)this.add(e[i],t[i])}predict(e){return e.map(t=>{const i=this._near_points(t),s={};i.forEach(n=>{let h=n.category;s[h]?(s[h].count+=1,s[h].min_d=Math.min(s[h].min_d,n.d)):s[h]={category:h,count:1,min_d:n.d}});let r=0,a=-1,u=null;for(let n of Object.keys(s))(r<s[n].count||r===s[n].count&&s[n].min_d<a)&&(r=s[n].count,a=s[n].min_d,u=s[n].category);return u})}}export class RadiusNeighborRegression extends d{static{o(this,"RadiusNeighborRegression")}constructor(e=1,t="euclid"){super(e,t)}add(e,t){super._add(e,t)}fit(e,t){for(let i=0;i<e.length;i++)this.add(e[i],t[i])}predict(e){return e.map(t=>{const i=this._near_points(t);return i.length===0?null:i.reduce((s,r)=>s+r.category,0)/i.length})}}export class SemiSupervisedRadiusNeighbor extends d{static{o(this,"SemiSupervisedRadiusNeighbor")}constructor(e=5,t="euclid"){super(e,t),this._k=1/0,this._orgk=e}add(e,t){super._add(e,t)}fit(e,t){for(let i=0;i<e.length;i++)this.add(e[i],t[i])}predict(){for(;;){const e=[];for(let t=0;t<this._p.length;t++)if(this._c[t]!=null){let i=0;const s=this._near_points(this._p[t]);for(const r of s)if(r.category==null&&(r.d<(e[r.idx]?.d??1/0)&&(e[r.idx]={d:r.d,category:this._c[t]}),++i>=this._orgk))break}if(e.length===0)break;for(let t=0;t<this._p.length;t++)e[t]&&(this._c[t]=e[t].category)}return this._c}}
