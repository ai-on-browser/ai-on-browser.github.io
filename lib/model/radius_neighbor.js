class RadiusNeighborBase{constructor(t=1,e="euclid"){switch(this._p=[],this._c=[],this._r=t,this._metric=e,this._metric){case"euclid":this._d=(t,e)=>Math.sqrt(t.reduce(((t,s,i)=>t+(s-e[i])**2),0));break;case"manhattan":this._d=(t,e)=>t.reduce(((t,s,i)=>t+Math.abs(s-e[i])),0);break;case"chebyshev":this._d=(t,e)=>Math.max(...t.map(((t,s)=>Math.abs(t-e[s]))));break;case"minkowski":this._dp=2,this._d=(t,e)=>Math.pow(t.reduce(((t,s,i)=>t*(s-e[i])**this._dp),0),1/this._dp)}}_near_points(t){const e=[];return this._p.forEach(((s,i)=>{const r=this._d(t,s);r<this._r&&e.push({d:r,category:this._c[i],idx:i})})),e}_add(t,e){this._p.push(t),this._c.push(e)}}export class RadiusNeighbor extends RadiusNeighborBase{constructor(t=1,e="euclid"){super(t,e)}add(t,e){super._add(t,e)}fit(t,e){for(let s=0;s<t.length;s++)this.add(t[s],e[s])}predict(t){return t.map((t=>{const e=this._near_points(t),s={};e.forEach((t=>{let e=t.category;s[e]?(s[e].count+=1,s[e].min_d=Math.min(s[e].min_d,t.d)):s[e]={category:e,count:1,min_d:t.d}}));let i=0,r=-1,d=null;for(let t of Object.keys(s))(i<s[t].count||i===s[t].count&&s[t].min_d<r)&&(i=s[t].count,r=s[t].min_d,d=s[t].category);return d}))}}export class RadiusNeighborRegression extends RadiusNeighborBase{constructor(t=1,e="euclid"){super(t,e)}add(t,e){super._add(t,e)}fit(t,e){for(let s=0;s<t.length;s++)this.add(t[s],e[s])}predict(t){return t.map((t=>{const e=this._near_points(t);return 0===e.length?null:e.reduce(((t,e)=>t+e.category),0)/e.length}))}}export class SemiSupervisedRadiusNeighbor extends RadiusNeighborBase{constructor(t=5,e="euclid"){super(t,e),this._k=1/0,this._orgk=t}add(t,e){super._add(t,e)}fit(t,e){for(let s=0;s<t.length;s++)this.add(t[s],e[s])}predict(){for(;;){const t=[];for(let e=0;e<this._p.length;e++)if(null!=this._c[e]){let s=0;const i=this._near_points(this._p[e]);for(const r of i)if(null==r.category&&(r.d<(t[r.idx]?.d??1/0)&&(t[r.idx]={d:r.d,category:this._c[e]}),++s>=this._orgk))break}if(0===t.length)break;for(let e=0;e<this._p.length;e++)t[e]&&(this._c[e]=t[e].category)}return this._c}}