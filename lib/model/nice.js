var h=Object.defineProperty;var a=(l,e)=>h(l,"name",{value:e,configurable:!0});import n from"../util/matrix.js";import m from"./neuralnetwork.js";import{FlowLayer as f}from"./nns/layer/base.js";import d from"./nns/layer/reverse.js";export default class u{static{a(this,"NICE")}constructor(e,r){const t=[{type:"input"}];for(let o=0;o<e;o++)t.push({type:"reverse",axis:1}),t.push({type:"additive_coupling"});t.push({type:"output"}),this._model=m.fromObject(t,null,r),this._epoch=0}get epoch(){return this._epoch}fit(e,r,t,o){for(let s=0;s<r;s++)for(let i=0;i<e.length;i+=o){const p=Math.min(e.length,i+o),c=this._model.calc(e.slice(i,p));this._model.grad(c),this._model.update(t)}this._epoch+=r}predict(e){return this._model.calc(e).toArray()}generate(e){e=n.fromArray(e);for(let r=this._model._graph.size-1;r>=0;r--){const t=this._model._graph.nodes[r];t.layer instanceof f?e=t.layer.inverse(e):t.layer instanceof d&&(e=t.layer.calc(e))}return e.toArray()}}
