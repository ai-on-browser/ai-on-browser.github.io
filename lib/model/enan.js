var o=Object.defineProperty;var d=(a,r)=>o(a,"name",{value:r,configurable:!0});export default class f{static{d(this,"ENaN")}constructor(r="euclid"){if(this._p=[],this._c=[],this._metric=r,typeof this._metric=="function")this._d=this._metric;else switch(this._metric){case"euclid":this._d=(h,t)=>Math.sqrt(h.reduce((e,i,s)=>e+(i-t[s])**2,0));break;case"manhattan":this._d=(h,t)=>h.reduce((e,i,s)=>e+Math.abs(i-t[s]),0);break;case"chebyshev":this._d=(h,t)=>Math.max(...h.map((e,i)=>Math.abs(e-t[i])));break;case"minkowski":this._dp=2,this._d=(h,t)=>Math.pow(h.reduce((e,i,s)=>e+(i-t[s])**this._dp,0),1/this._dp);break}}fit(r,h){this._x=r,this._c=h,this._classes=[...new Set(this._c)],this._nears=[],this._n=Array(this._classes.length).fill(0);for(let t=0;t<this._x.length;t++){const e=this._x.map((i,s)=>({d:this._d(this._x[t],i),idx:s}));e.sort((i,s)=>i.d-s.d),this._nears[t]=e,this._n[this._classes.indexOf(this._c[t])]++}this._k=2;for(let t=2;t<this._x.length;t++){let e=!0;for(let i=0;i<this._nears.length&&e;i++){let s=!1;for(let _=1;_<t&&!s;_++){const n=this._nears[i][_].idx;for(let l=1;l<t&&!s;l++)s=this._nears[n][l].idx===i}e&&=s}if(e){this._k=t;break}}this._t=[];for(let t=0;t<this._classes.length;t++){let e=0;for(let i=0;i<this._nears.length;i++)if(this._c[i]===this._classes[t])for(let s=1;s<=this._k;s++)this._c[this._nears[i][s].idx]===this._classes[t]&&e++;this._t[t]=e/(this._n[t]*this._k)}}predict(r){const h=[];for(let t=0;t<r.length;t++)h[t]=this._predict(r[t]);return h}_predict(r){const h=[{d:0,idx:-1}],t=[];for(let s=0;s<this._x.length;s++){const _=this._d(r,this._x[s]);h.push({d:_,idx:s}),t[s]=_}h.sort((s,_)=>s.d-_.d);let e=-1/0,i=-1;for(let s=0;s<this._classes.length;s++){let _=0;for(let c=1;c<=this._k;c++)this._c[h[c].idx]===this._classes[s]&&_++;let n=0;for(let c=0;c<this._nears.length;c++)t[c]<this._nears[c][this._k].d&&n++;const l=n+_-this._k*this._t[s];e<l&&(e=l,i=s)}return this._classes[i]}}
