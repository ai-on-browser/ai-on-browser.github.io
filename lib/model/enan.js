var d=Object.defineProperty;var a=(l,i)=>d(l,"name",{value:i,configurable:!0});const f={euclid:a(()=>(l,i)=>Math.sqrt(l.reduce((_,t,e)=>_+(t-i[e])**2,0)),"euclid"),manhattan:a(()=>(l,i)=>l.reduce((_,t,e)=>_+Math.abs(t-i[e]),0),"manhattan"),chebyshev:a(()=>(l,i)=>Math.max(...l.map((_,t)=>Math.abs(_-i[t]))),"chebyshev"),minkowski:a(({p:l=2}={})=>(i,_)=>Math.pow(i.reduce((t,e,h)=>t+(e-_[h])**l,0),1/l),"minkowski")};export default class x{static{a(this,"ENaN")}constructor(i="euclid"){this._p=[],this._c=[],this._metric=i,typeof this._metric=="function"?this._d=this._metric:this._d=f[this._metric]()}fit(i,_){this._x=i,this._c=_,this._classes=[...new Set(this._c)],this._nears=[],this._n=Array(this._classes.length).fill(0);for(let t=0;t<this._x.length;t++){const e=this._x.map((h,s)=>({d:this._d(this._x[t],h),idx:s}));e.sort((h,s)=>h.d-s.d),this._nears[t]=e,this._n[this._classes.indexOf(this._c[t])]++}this._k=2;for(let t=2;t<this._x.length;t++){let e=!0;for(let h=0;h<this._nears.length&&e;h++){let s=!1;for(let n=1;n<t&&!s;n++){const o=this._nears[h][n].idx;for(let c=1;c<t&&!s;c++)s=this._nears[o][c].idx===h}e&&=s}if(e){this._k=t;break}}this._t=[];for(let t=0;t<this._classes.length;t++){let e=0;for(let h=0;h<this._nears.length;h++)if(this._c[h]===this._classes[t])for(let s=1;s<=this._k;s++)this._c[this._nears[h][s].idx]===this._classes[t]&&e++;this._t[t]=e/(this._n[t]*this._k)}}predict(i){const _=[];for(let t=0;t<i.length;t++)_[t]=this._predict(i[t]);return _}_predict(i){const _=[{d:0,idx:-1}],t=[];for(let s=0;s<this._x.length;s++){const n=this._d(i,this._x[s]);_.push({d:n,idx:s}),t[s]=n}_.sort((s,n)=>s.d-n.d);let e=-1/0,h=-1;for(let s=0;s<this._classes.length;s++){let n=0;for(let r=1;r<=this._k;r++)this._c[_[r].idx]===this._classes[s]&&n++;let o=0;for(let r=0;r<this._nears.length;r++)t[r]<this._nears[r][this._k].d&&o++;const c=o+n-this._k*this._t[s];e<c&&(e=c,h=s)}return this._classes[h]}}
