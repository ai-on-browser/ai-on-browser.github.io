var _=Object.defineProperty;var l=(h,s)=>_(h,"name",{value:s,configurable:!0});import a from"../util/matrix.js";export default class c{static{l(this,"LabelPropagation")}constructor(s="rbf",i=.1,e=1/0){this._k=e,this._sigma=i,this._affinity=s}_affinity_matrix(s){const i=s.rows,e=a.zeros(i,i);for(let t=0;t<i;t++)for(let r=t+1;r<i;r++){let n=a.sub(s.row(t),s.row(r)).norm();e.set(t,r,n),e.set(r,t,n)}const o=a.zeros(i,i);if(this._k>=i)o.fill(1);else if(this._k>0){for(let t=0;t<i;t++){const r=e.row(t).value.map((n,f)=>[n,f]);r.sort((n,f)=>n[0]-f[0]);for(let n=1;n<Math.min(this._k+1,r.length);n++)o.set(t,r[n][1],1)}o.add(o.t),o.div(2)}if(this._affinity==="rbf")return a.map(e,(t,r)=>o.at(r)>0?Math.exp(-(t**2)/this._sigma**2):0);if(this._affinity==="knn")return a.map(o,t=>t>0?1:0)}init(s,i){s=a.fromArray(s);const e=s.rows;this._y=i;const o=new Set;for(let t=0;t<e;t++)this._y[t]!=null&&o.add(this._y[t]);this._classes=[...o],this._w=this._affinity_matrix(s),this._probs=a.zeros(e,this._classes.length);for(let t=0;t<e;t++)this._y[t]!=null&&this._probs.set(t,this._classes.indexOf(this._y[t]),1)}fit(){const s=this._w.dot(this._probs);s.div(s.sum(1));for(let i=0;i<this._y.length;i++)this._y[i]==null&&this._probs.set(i,0,s.row(i))}predict(){return this._probs.argmax(1).value.map(s=>this._classes[s])}}
