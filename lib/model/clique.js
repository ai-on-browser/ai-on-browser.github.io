export default class CLIQUE{constructor(t,e){this._xi=t,this._t=e}get size(){return this._clusters.length}fit(t){const e=t.length,s=t[0].length,i=Array(s).fill(1/0),l=Array(s).fill(-1/0);for(let r=0;r<e;r++)for(let e=0;e<s;e++)i[e]=Math.min(i[e],t[r][e]),l[e]=Math.max(l[e],t[r][e]);this._u=[];for(let t=0;t<s;t++){this._u[t]=[];let e=i[t];for(;e<=l[t];){const s=e+(Array.isArray(this._xi)?this._xi[t]:this._xi);this._u[t].push([e,s]),e=s}}let r=[];for(let i=0;i<s;i++)for(let l=0;l<this._u[i].length;l++){const h={c:Array(s).fill(-1),i:new Set};h.c[i]=l;for(let s=0;s<e;s++)this._u[i][l][0]<=t[s][i]&&t[s][i]<this._u[i][l][1]&&h.i.add(s);h.i.size/e>=this._t&&r.push(h)}for(let t=0;t<s;t++){const t=[];for(let i=0;i<r.length;i++)for(let l=0;l<i;l++){let h=-1,c=-1;const f=[];for(let t=0;t<s;t++)if(r[i].c[t]!==r[l].c[t])if(r[i].c[t]<0){if(c>=0)break;c=t,f[t]=r[l].c[t]}else{if(!(r[l].c[t]<0))break;if(h>=0)break;h=t,f[t]=r[i].c[t]}else{if(r[i].c[t]>=0&&(h>=0||c>=0))break;f[t]=r[i].c[t]}if(f.length<s)continue;const n={c:f,i:new Set};for(const t of r[i].i)r[l].i.has(t)&&n.i.add(t);n.i.size/e>=this._t&&t.push(n)}if(0===t.length)break;r=t}const h=[],c=[];let f=[];for(;r.length>0||h.length>0;){0===h.length&&(f.length>0&&(c.push(f),f=[]),h.push(r.pop()));const t=h.pop();f.push(t);for(let e=r.length-1;e>=0;e--){let i=0;for(let l=0;l<s&&i<2;l++)if(!(t.c[l]<0||r[e].c[l]<0||t.c[l]===r[e].c[l])){if(Math.abs(t.c[l]-r[e].c[l])>1){i=2;break}i++}i<2&&h.push(r.splice(e,1)[0])}}f.length>0&&c.push(f),this._clusters=c}predict(t){const e=Array(t.length).fill(-1);for(let s=0;s<t.length;s++)for(let i=0;i<this._clusters.length;i++){let l=!1;for(let e=0;e<this._clusters[i].length;e++){const r=this._clusters[i][e];let h=!0;for(let e=0;e<r.c.length;e++){if(r.c[e]<0)continue;const i=this._u[e][r.c[e]];if(t[s][e]<i[0]||i[1]<=t[s][e]){h=!1;break}}if(h){l=!0;break}}if(l){e[s]=i;break}}return e}}