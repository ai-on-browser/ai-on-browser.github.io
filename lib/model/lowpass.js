const f=(t,l,s,e,n,o)=>{const h=t/2,r=2*Math.PI/t;if(t>1){for(let t=0;t<h;t++){const e=Math.cos(t*r),o=-Math.sin(t*r),f=l[t+n],a=s[t+n],c=l[t+n+h],i=s[t+n+h];l[t+n]=f+c,s[t+n]=a+i,l[t+n+h]=(f-c)*e-(a-i)*o,s[t+n+h]=(a-i)*e+(f-c)*o}f(t/2,l,s,2*e,n,o),f(t/2,l,s,2*e,n+h,o+e)}else n>o&&([l[n],l[o]]=[l[o],l[n]],[s[n],s[o]]=[s[o],s[n]])},fft=(t,l=null)=>{const s=t.length;if(!Number.isInteger(Math.log2(s)))throw"Invalid value length.";return l||(l=Array(s).fill(0)),f(s,t,l,1,0,0),[t,l]},ifft=(t,l)=>(l=l.map((t=>-t)),f(t.length,t,l,1,0,0),t=t.map((l=>l/t.length)),l=l.map((l=>-l/t.length)),[t,l]);export class LowpassFilter{constructor(t=.5){this._c=t}_cutoff(t,l,s,e){return t>=l?[0,0]:[s,e]}_lowpass(t){const[l,s]=fft(t),e=t.length/2,n=Math.floor(e*(1-this._c));for(let o=1;o<=e;o++)[l[o],s[o]]=this._cutoff(o,n,l[o],s[o]),o!==e&&([l[t.length-o],s[t.length-o]]=this._cutoff(o,n,l[t.length-o],s[t.length-o]));const[o,h]=(r=l,a=(a=s).map((t=>-t)),f(r.length,r,a,1,0,0),r=r.map((t=>t/r.length)),a=a.map((t=>-t/r.length)),[r,a]);var r,a;return o}predict(t){const l=t.length,s=Math.log2(l);if(Number.isInteger(s))return this._lowpass(t);const e=2**Math.floor(s),n=t.length-e,o=Math.floor(n/2),h=this._lowpass(t.slice(0,e)),r=this._lowpass(t.slice(o,o+e)),f=this._lowpass(t.slice(n)),a=[];for(let t=0;t<e/2;t++)a[t]=a[e-t-1]=t+1;const c=[];for(let t=0;t<l;t++)c[t]=t<o?h[t]:t<n?(h[t]*a[t]+r[t-o]*a[t-o])/(a[t]+a[t-o]):t>=o+e?f[t-n]:t>=e?(r[t-o]*a[t-o]+f[t-n]*a[t-n])/(a[t-o]+a[t-n]):(h[t]*a[t]+r[t-o]*a[t-o]+f[t-n]*a[t-n])/(a[t]+a[t-o]+a[t-n]);return c}}