const f=(t,l,e,n,r,h)=>{const o=t/2,s=2*Math.PI/t;if(t>1){for(let t=0;t<o;t++){const f=Math.cos(t*s),n=-Math.sin(t*s),h=l[t+r],a=e[t+r],i=l[t+r+o],c=e[t+r+o];l[t+r]=h+i,e[t+r]=a+c,l[t+r+o]=(h-i)*f-(a-c)*n,e[t+r+o]=(a-c)*f+(h-i)*n}f(t/2,l,e,2*n,r,h),f(t/2,l,e,2*n,r+o,h+n)}else r>h&&([l[r],l[h]]=[l[h],l[r]],[e[r],e[h]]=[e[h],e[r]])},fft=(t,l=null)=>{const e=t.length;if(!Number.isInteger(Math.log2(e)))throw"Invalid value length.";return l||(l=Array(e).fill(0)),f(e,t,l,1,0,0),[t,l]},ifft=(t,l)=>(l=l.map((t=>-t)),fft(t,l),t=t.map((l=>l/t.length)),l=l.map((l=>-l/t.length)),[t,l]),dft=(t,l=null)=>{const e=t.length;l||(l=Array(e).fill(0));const f=Array(e).fill(0),n=Array(e).fill(0),r=-2*Math.PI/e;for(let h=0;h<e;h++)for(let o=0;o<e;o++)f[h]+=t[o]*Math.cos(o*h*r)-l[o]*Math.sin(o*h*r),n[h]+=t[o]*Math.sin(o*h*r)+l[o]*Math.cos(o*h*r);return[f,n]},idft=(t,l)=>{l=l.map((t=>-t));let[e,f]=dft(t,l);return e=e.map((l=>l/t.length)),f=f.map((l=>-l/t.length)),[e,f]};export class LowpassFilter{constructor(t=.5){this._c=t}_cutoff(t,l,e,f){return t>=l?[0,0]:[e,f]}predict(t){const l=t.length;let e=dft,f=idft;Number.isInteger(Math.log2(l))&&(e=fft,f=ifft);const[n,r]=e(t),h=t.length/2,o=Math.floor(h*(1-this._c));for(let l=1;l<=h;l++)[n[l],r[l]]=this._cutoff(l,o,n[l],r[l]),l!==h&&([n[t.length-l],r[t.length-l]]=this._cutoff(l,o,n[t.length-l],r[t.length-l]));const[s]=f(n,r);return s}}