var g=Object.defineProperty;var k=(u,r)=>g(u,"name",{value:r,configurable:!0});import a from"../util/matrix.js";export default class w{static{k(this,"LLE")}constructor(r=1,l=null){this._k=r,this._rd=l}predict(r){r=a.fromArray(r);const l=r.cols,i=r.rows,_=this._rd||l,d=[];for(let o=0;o<i;d[o++]=[]);for(let o=0;o<i;o++)for(let t=0;t<o;t++){let e=0;for(let s=0;s<l;s++)e+=(r.at(o,s)-r.at(t,s))**2;d[o][t]=d[t][o]=e}const m=[];for(let o=0;o<i;o++){const t=[];for(let e=0;e<i;e++){if(e===o)continue;const s=d[o][e];if(t.length<this._k||s<t[this._k-1].dt){t.length===this._k&&t.pop(),t.push({dt:s,idx:e});for(let n=t.length-1;n>0;n--)t[n].dt<t[n-1].dt&&([t[n],t[n-1]]=[t[n-1],t[n]])}}m.push(t)}const f=a.eye(i,i);for(let o=0;o<i;o++){const t=m[o].map(c=>c.idx),e=r.row(t);e.sub(r.row(o));const s=e.dot(e.t),n=Math.floor(Math.log10(s.trace()))-3;s.add(a.eye(s.rows,s.cols,10**n));const h=s.inv().sum(0);h.div(h.sum());for(let c=0;c<this._k;c++)f.subAt(o,t[c],h.value[c])}const p=f.tDot(f).eigenVectors();return p.flip(1),p.slice(1,_+1,1).toArray()}}
