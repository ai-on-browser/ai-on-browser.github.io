var c=Object.defineProperty;var l=(a,e)=>c(a,"name",{value:e,configurable:!0});const u={gaussian:l(({d:a=1})=>(e,s)=>{let t=e.reduce((i,_,o)=>i+(_-s[o])**2,0);return Math.exp(-t/(2*a*a))},"gaussian"),linear:l(()=>(a,e)=>a.reduce((s,t,i)=>s+t*e[i],0),"linear")};export default class k{static{l(this,"OCSVM")}constructor(e,s){typeof s=="function"?this._kernel=s:(typeof s=="string"&&(s={name:s}),this._kernel=u[s.name](s)),this._nu=e,this._eps=.001}init(e){this._x=e;const s=this._x.length;this._nl=s*this._nu,this._a=Array(s).fill(1/this._nl),this._b=0,this._alldata=!0,this._k=[];for(let t=0;t<s;this._k[t++]=[]);for(let t=0;t<s;t++)for(let i=t;i<s;i++)this._k[t][i]=this._k[i][t]=this._kernel(this._x[t],this._x[i])}fit(){const e=this._fitOnce(this._alldata);if(this._alldata){if(this._alldata=!1,e===0)return}else e===0&&(this._alldata=!0)}_fitOnce(){let e=0;const s=this._x.length;for(let t=0;t<s;t++){const i=[];this._rho=-1/0;for(let h=0;h<s;h++){i[h]=0;for(let n=0;n<s;n++)i[h]+=this._a[h]*this._k[h][n];this._rho<i[h]&&(this._rho=i[h])}if(!this._alldata&&(!l(n=>(i[t]-this._rho)*n>0||(this._rho-i[t])*(1/this._nl-n)>0,"between_eps")(this._a[t])||this._a[t]>=1/this._nl-this._eps||this._a[t]<=this._eps))continue;let _=-1,o=-1/0;for(let h=0;h<s;h++)h!==t&&(this._a[h]>=1/this._nl-this._eps||this._a[h]<=this._eps||o<Math.abs(i[t]-i[h])&&(_=h,o=Math.abs(i[t]-i[h])));if(_<0||_===t){const h=Math.floor(Math.random()*(s+1));for(let n=0;n<s;n++){const f=(n+h)%s;if(f!==t){_=f;break}}}let r=1;for(let h=0;h<s;h++)h===t||h===_||(r-=this._a[h]);this._a[_]+=(i[t]-i[_])/(this._k[t][t]+this._k[_][_]-2*this._k[t][_]),this._a[_]=Math.max(0,Math.min(1/this._nl,this._a[_])),this._a[t]=Math.max(0,Math.min(1/this._nl,r-this._a[_])),e++}this._rho=-1/0;for(let t=0;t<s;t++){let i=0;for(let _=0;_<s;_++)i+=this._a[t]*this._k[t][_];this._rho<i&&(this._rho=i)}return e}predict(e){return e.map(s=>{let t=0;for(let i=0;i<this._x.length;i++)this._a[i]&&(t+=this._a[i]*this._kernel(s,this._x[i]));return t-this._rho})}}
