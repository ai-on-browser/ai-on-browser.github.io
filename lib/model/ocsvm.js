var u=Object.defineProperty;var o=(n,_)=>u(n,"name",{value:_,configurable:!0});const c={gaussian:(n=1)=>(_,s)=>{let t=_.reduce((i,e,l)=>i+(e-s[l])**2,0);return Math.exp(-t/(2*n*n))},linear:()=>(n,_)=>n.reduce((s,t,i)=>s+t*_[i],0)};export default class d{static{o(this,"OCSVM")}constructor(_,s){typeof s=="function"?this._kernel=s:(typeof s=="string"&&(s={name:s}),s.name==="gaussian"?this._kernel=c.gaussian(s.d):this._kernel=c.linear()),this._nu=_,this._eps=.001}init(_){this._x=_;const s=this._x.length;this._nl=s*this._nu,this._a=Array(s).fill(1/this._nl),this._b=0,this._alldata=!0,this._k=[];for(let t=0;t<s;this._k[t++]=[]);for(let t=0;t<s;t++)for(let i=t;i<s;i++)this._k[t][i]=this._k[i][t]=this._kernel(this._x[t],this._x[i])}fit(){const _=this._fitOnce(this._alldata);if(this._alldata){if(this._alldata=!1,_===0)return}else _===0&&(this._alldata=!0)}_fitOnce(){let _=0;const s=this._x.length;for(let t=0;t<s;t++){const i=[];this._rho=-1/0;for(let h=0;h<s;h++){i[h]=0;for(let a=0;a<s;a++)i[h]+=this._a[h]*this._k[h][a];this._rho<i[h]&&(this._rho=i[h])}if(!this._alldata&&(!o(a=>(i[t]-this._rho)*a>0||(this._rho-i[t])*(1/this._nl-a)>0,"between_eps")(this._a[t])||this._a[t]>=1/this._nl-this._eps||this._a[t]<=this._eps))continue;let e=-1,l=-1/0;for(let h=0;h<s;h++)h!==t&&(this._a[h]>=1/this._nl-this._eps||this._a[h]<=this._eps||l<Math.abs(i[t]-i[h])&&(e=h,l=Math.abs(i[t]-i[h])));if(e<0||e===t){const h=Math.floor(Math.random()*(s+1));for(let a=0;a<s;a++){const f=(a+h)%s;if(f!==t){e=f;break}}}let r=1;for(let h=0;h<s;h++)h===t||h===e||(r-=this._a[h]);this._a[e]+=(i[t]-i[e])/(this._k[t][t]+this._k[e][e]-2*this._k[t][e]),this._a[e]=Math.max(0,Math.min(1/this._nl,this._a[e])),this._a[t]=Math.max(0,Math.min(1/this._nl,r-this._a[e])),_++}this._rho=-1/0;for(let t=0;t<s;t++){let i=0;for(let e=0;e<s;e++)i+=this._a[t]*this._k[t][e];this._rho<i&&(this._rho=i)}return _}predict(_){return _.map(s=>{let t=0;for(let i=0;i<this._x.length;i++)this._a[i]&&(t+=this._a[i]*this._kernel(s,this._x[i]));return t-this._rho})}}
