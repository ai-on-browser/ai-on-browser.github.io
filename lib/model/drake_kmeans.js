var a=Object.defineProperty;var o=(e,_)=>a(e,"name",{value:_,configurable:!0});export default class f{static{o(this,"DrakeKMeans")}constructor(_){this._k=_,this._b=Math.max(1,Math.floor(_/4)),this._c=null,this._d=(r,i)=>Math.sqrt(r.reduce((l,s,t)=>l+(s-i[t])**2,0))}get centroids(){return this._c}init(_){this._x=_;const r=this._x.length,i=[];for(let s=0;s<this._k;s++)i.push(Math.floor(Math.random()*(r-s)));for(let s=i.length-1;s>=0;s--)for(let t=i.length-1;t>s;t--)i[s]<=i[t]&&i[t]++;this._c=i.map(s=>this._x[s]),this._t=Array(this._k).fill(0),this._y=[],this._u=[],this._a=[],this._l=[];const l=Array.from(this._c,(s,t)=>t);for(let s=0;s<r;s++)this._a[s]=[],this._l[s]=[],this._sortCenters(s,this._b,l)}_sortCenters(_,r,i){const l=i.map(s=>[this._d(this._c[s],this._x[_]),s]);l.sort((s,t)=>s[0]-t[0]),this._y[_]=l[0][1],this._u[_]=l[0][0];for(let s=0;s<r;s++)this._a[_][s]=l[s+1][1],this._l[_][s]=l[s+1][0]}fit(){const _=this._x.length;let r=Math.max(1,Math.floor(this._k/8));for(let t=0;t<_;t++){let h=0;for(;h<this._b&&!(this._u[t]<=this._l[t][h]);h++);h=Math.min(h+1,this._b);const n=[this._y[t],...this._a[t].slice(0,h)];this._sortCenters(t,h,n),r=Math.max(r,h)}const i=[],l=Array(this._k).fill(0);for(let t=0;t<this._k;t++)i[t]=Array(this._x[0].length).fill(0);for(let t=0;t<_;t++){for(let h=0;h<this._x[t].length;h++)i[this._y[t]][h]+=this._x[t][h];l[this._y[t]]++}let s=0;for(let t=0;t<this._k;t++)i[t]=i[t].map(h=>h/l[t]),this._t[t]=this._d(this._c[t],i[t]),s=Math.max(s,this._t[t]),this._c[t]=i[t];for(let t=0;t<_;t++){this._u[t]+=this._t[this._y[t]],this._l[t][this._b]-=s;for(let h=this._b-1;h>=0;h--)this._l[t][h]-=this._t[this._a[t][h]],this._l[t][h]>this._l[t][h+1]&&(this._l[t][h]=this._l[t][h+1])}this._b=r}predict(_){const r=[];for(let i=0;i<_.length;i++){let l=1/0;r[i]=-1;for(let s=0;s<this._c.length;s++){const t=this._d(_[i],this._c[s]);t<l&&(l=t,r[i]=s)}}return r}}
