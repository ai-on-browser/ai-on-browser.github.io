import{Matrix}from"../util/math.js";export default class LatentDirichletAllocation{constructor(t=2){this._k=t,this._alpha=.1,this._beta=.1}init(t){const h=new Set;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++)h.add(t[i][s]);this._x_cand=[...h],this._w=t.map((t=>t.map((t=>this._x_cand.indexOf(t))))),this._zmn=[],this._nmz=new Matrix(this._w.length,this._k,this._alpha),this._nzt=new Matrix(this._k,this._x_cand.length,this._beta),this._nz=this._nzt.sum(1),this._n=0;for(let t=0;t<this._w.length;t++){this._n+=this._w[t].length,this._zmn[t]=[];for(let h=0;h<this._w[t].length;h++){const i=Math.floor(Math.random()*this._k);this._zmn[t][h]=i,this._nmz.addAt(t,i,1),this._nzt.addAt(i,this._w[t][h],1),this._nz.addAt(i,0,1)}}}fit(){for(let t=0;t<this._w.length;t++)for(let h=0;h<this._w[t].length;h++){const i=this._zmn[t][h];this._nmz.subAt(t,i,1),this._nzt.subAt(i,this._w[t][h],1),this._nz.subAt(i,0,1);const s=this._nzt.col(this._w[t][h]);s.mult(this._nmz.row(t).t),s.div(this._nz),s.div(s.sum());let n=Math.random(),_=0;for(;_<this._k&&(n-=s.at(_,0),!(n<0));_++);this._zmn[t][h]=_,this._nmz.addAt(t,_,1),this._nzt.addAt(_,this._w[t][h],1),this._nz.addAt(_,0,1)}}predict(){return this._nmz.argmax(1).value}}