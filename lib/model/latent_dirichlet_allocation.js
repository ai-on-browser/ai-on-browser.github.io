var z=Object.defineProperty;var e=(a,t)=>z(a,"name",{value:t,configurable:!0});import l from"../util/matrix.js";export default class d{static{e(this,"LatentDirichletAllocation")}constructor(t=2){this._k=t,this._alpha=.1,this._beta=.1}init(t){const s=new Set;for(let h=0;h<t.length;h++)for(let i=0;i<t[h].length;i++)s.add(t[h][i]);this._x_cand=[...s],this._w=t.map(h=>h.map(i=>this._x_cand.indexOf(i))),this._zmn=[],this._nmz=new l(this._w.length,this._k,this._alpha),this._nzt=new l(this._k,this._x_cand.length,this._beta),this._nz=this._nzt.sum(1),this._n=0;for(let h=0;h<this._w.length;h++){this._n+=this._w[h].length,this._zmn[h]=[];for(let i=0;i<this._w[h].length;i++){const n=Math.floor(Math.random()*this._k);this._zmn[h][i]=n,this._nmz.addAt(h,n,1),this._nzt.addAt(n,this._w[h][i],1),this._nz.addAt(n,0,1)}}}fit(){for(let t=0;t<this._w.length;t++)for(let s=0;s<this._w[t].length;s++){const h=this._zmn[t][s];this._nmz.subAt(t,h,1),this._nzt.subAt(h,this._w[t][s],1),this._nz.subAt(h,0,1);const i=this._nzt.col(this._w[t][s]);i.mult(this._nmz.row(t).t),i.div(this._nz),i.div(i.sum());let n=Math.random(),_=0;for(;_<this._k&&(n-=i.at(_,0),!(n<0));_++);this._zmn[t][s]=_,this._nmz.addAt(t,_,1),this._nzt.addAt(_,this._w[t][s],1),this._nz.addAt(_,0,1)}}predict(){return this._nmz.argmax(1).value}}
