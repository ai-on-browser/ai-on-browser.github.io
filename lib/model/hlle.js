var v=Object.defineProperty;var _=(u,n)=>v(u,"name",{value:n,configurable:!0});import f from"../util/matrix.js";export default class y{static{_(this,"HLLE")}constructor(n=1){this._k=n}predict(n,l=0){n=f.fromArray(n);const g=n.cols,r=n.rows,a=[],h=[];for(let t=0;t<r;a[t++]=[]);for(let t=0;t<r;t++){for(let e=t+1;e<r;e++){let c=0;for(let o=0;o<g;o++)c+=(n.at(t,o)-n.at(e,o))**2;a[t][e]=a[e][t]=c}const s=[];for(let e=0;e<r;e++){if(e===t)continue;const c=a[t][e];if(s.length<this._k||c<s[this._k-1].dt){s.length===this._k&&s.pop(),s.push({dt:c,idx:e});for(let o=s.length-1;o>0;o--)s[o].dt<s[o-1].dt&&([s[o],s[o-1]]=[s[o-1],s[o]])}}h.push(s)}const p=f.zeros(r,r);for(let t=0;t<r;t++){const s=n.row(h[t].map(i=>i.idx));s.sub(s.mean(0));const[e]=s.svd(),c=f.ones(this._k,1+l+l*(l+1)/2);c.set(0,1,e.slice(0,l,1));let o=1+l;for(let i=0;i<l;i++)c.set(0,o,f.mult(e.col(i),e.slice(i,l,1))),o+=l-i;const[w]=c.qr(),d=w.slice(l+1,null,1);d.div(f.add(d.sum(0),1e-15));const j=d.dot(d.t);for(let i=0;i<this._k;i++)for(let k=0;k<this._k;k++)p.addAt(h[t][i].idx,h[t][k].idx,j.at(i,k))}const m=p.eigenVectors();return m.flip(1),m.slice(1,l+1,1).toArray()}}
