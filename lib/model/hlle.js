import Matrix from"../util/matrix.js";export default class HLLE{constructor(t=1){this._k=t}predict(t,o=0){const s=(t=Matrix.fromArray(t)).cols,r=t.rows,e=[],i=[];for(let t=0;t<r;e[t++]=[]);for(let o=0;o<r;o++){for(let i=o+1;i<r;i++){let r=0;for(let e=0;e<s;e++)r+=(t.at(o,e)-t.at(i,e))**2;e[o][i]=e[i][o]=r}const l=[];for(let t=0;t<r;t++){if(t===o)continue;const s=e[o][t];if(l.length<this._k||s<l[this._k-1].dt){l.length===this._k&&l.pop(),l.push({dt:s,idx:t});for(let t=l.length-1;t>0;t--)l[t].dt<l[t-1].dt&&([l[t],l[t-1]]=[l[t-1],l[t]])}}i.push(l)}const l=Matrix.zeros(r,r);for(let s=0;s<r;s++){const r=t.row(i[s].map((t=>t.idx)));r.sub(r.mean(0));const[e]=r.svd(),c=Matrix.ones(this._k,1+o+o*(o+1)/2);c.set(0,1,e.slice(0,o,1));let n=1+o;for(let t=0;t<o;t++)c.set(0,n,Matrix.mult(e.col(t),e.slice(t,o,1))),n+=o-t;const[a]=c.qr(),f=a.slice(o+1,null,1);f.div(f.sum(0));const d=f.dot(f.t);for(let t=0;t<this._k;t++)for(let o=0;o<this._k;o++)l.addAt(i[s][t].idx,i[s][o].idx,d.at(t,o))}const c=l.eigenVectors();return c.flip(1),c.slice(1,o+1,1).toArray()}}