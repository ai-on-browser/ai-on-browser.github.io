var v=Object.defineProperty;var g=(p,r)=>v(p,"name",{value:r,configurable:!0});import d from"../util/matrix.js";export default class y{static{g(this,"HLLE")}constructor(r,f=null){this._k=r,this._rd=f}predict(r){r=d.fromArray(r);const f=r.cols,c=r.rows,n=this._rd||f,h=[],a=[];for(let t=0;t<c;h[t++]=[]);for(let t=0;t<c;t++){for(let e=t+1;e<c;e++){let l=0;for(let o=0;o<f;o++)l+=(r.at(t,o)-r.at(e,o))**2;h[t][e]=h[e][t]=l}const s=[];for(let e=0;e<c;e++){if(e===t)continue;const l=h[t][e];if(s.length<this._k||l<s[this._k-1].dt){s.length===this._k&&s.pop(),s.push({dt:l,idx:e});for(let o=s.length-1;o>0;o--)s[o].dt<s[o-1].dt&&([s[o],s[o-1]]=[s[o-1],s[o]])}}a.push(s)}const _=d.zeros(c,c);for(let t=0;t<c;t++){const s=r.row(a[t].map(i=>i.idx));s.sub(s.mean(0));const[e]=s.svd(),l=d.ones(this._k,1+n+n*(n+1)/2);l.set(0,1,e.slice(0,n,1));let o=1+n;for(let i=0;i<n;i++)l.set(0,o,d.mult(e.col(i),e.slice(i,n,1))),o+=n-i;const[w]=l.qr(),u=w.slice(n+1,null,1);u.div(d.add(u.sum(0),1e-15));const j=u.dot(u.t);for(let i=0;i<this._k;i++)for(let k=0;k<this._k;k++)_.addAt(a[t][i].idx,a[t][k].idx,j.at(i,k))}const m=_.eigenVectors();return m.flip(1),m.slice(1,n+1,1).toArray()}}
