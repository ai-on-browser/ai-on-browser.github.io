var C=Object.defineProperty;var B=(I,n)=>C(I,"name",{value:n,configurable:!0});import D from"./dbscan.js";import{KMeanspp as E}from"./kmeans.js";export default class G{static{B(this,"BRIDGE")}constructor(n,l,s){this._k=n,this._e_core=l,this._e_den=s}_distance(n,l){return Math.sqrt(n.reduce((s,r,h)=>s+(r-l[h])**2,0))}predict(n){const l=n.length,s=n[0].length,r=new E;for(let t=0;t<this._k;t++)r.add(n);for(;r.fit(n)>0;);const h=[],f=Array(this._k).fill(1/0);for(let t=0;t<this._k;t++){for(let e=t+1;e<this._k;e++){const c=this._distance(r.centroids[t],r.centroids[e])/2;c<f[t]&&(f[t]=c),c<f[e]&&(f[e]=c)}h[t]=Array.from({length:s},()=>[1/0,-1/0])}const P=r.predict(n),x=Array(this._k).fill(0),w=Array.from({length:this._k},()=>[]),k=Array.from({length:this._k},()=>[]),b=[],m=Array.from({length:s},()=>[1/0,-1/0]);for(let t=0;t<l;t++){const e=P[t];x[e]++;for(let i=0;i<s;i++)h[e][i][0]=Math.min(h[e][i][0],n[t][i]),h[e][i][1]=Math.max(h[e][i][1],n[t][i]),m[i][0]=Math.min(m[i][0],n[t][i]),m[i][1]=Math.max(m[i][1],n[t][i]);const c=this._distance(r.centroids[e],n[t]);c<f[e]-this._e_core?w[e].push(t):c<f[e]+this._e_core?k[e].push(t):b.push(t)}const p=Array(l).fill(-1);let d=1;s===1?d=2*this._e_den:s===2?d=Math.PI*this._e_den**2:s===3?d=4/3*Math.PI*this._e_den**3:d=(2*this._e_den)**s;let u=0;for(let t=0;t<this._k;t++){const e=h[t].reduce((o,j)=>o*(j[1]-j[0]),1),c=d/e*x[t],i=new D(this._e_den,c),g=w[t].concat(k[t]),M=i.predict(g.map(o=>n[o]));let A=u;for(let o=0;o<g.length;o++)M[o]>=0&&(p[g[o]]=u+M[o],A=Math.max(A,u+M[o]));u=A+1}const q=m.reduce((t,e)=>t*(e[1]-e[0]),1),v=new D(this._e_den,d/q*l),_=k.reduce((t,e)=>t.concat(e),b),a=v.predict(_.map(t=>n[t])),y=[];for(let t=0;t<_.length;t++)p[_[t]]>=0&&a[t]>=0&&y[a[t]]==null&&(y[a[t]]=p[_[t]]);for(let t=0;t<_.length;t++)p[_[t]]<0&&a[t]>=0&&(p[_[t]]=y[a[t]]);return this._clusters=p,this._clusters}}
