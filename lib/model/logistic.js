var b=Object.defineProperty;var p=(m,t)=>b(m,"name",{value:t,configurable:!0});import r from"../util/matrix.js";export class LogisticRegression{static{p(this,"LogisticRegression")}constructor(){this._W=null,this._b=0}_output(t){let s=t.dot(this._W);return s.add(this._b),s}fit(t,s,a=1,h=.1,o=0,e=0){t=r.fromArray(t),s=r.fromArray(s),this._W||(this._W=r.randn(t.cols,1));const d=t.rows;for(let u=0;u<a;u++){const l=this._output(t);l.sub(s);let n=t.tDot(l);n.div(d),(o>0||e>0)&&n.map(_=>_+_*e+Math.sign(_)*o),n.mult(h),this._W.sub(n);let i=l.mean();(o>0||e>0)&&(i+=i*e+Math.sign(i)*o),this._b-=i*h}}predict(t){let a=r.fromArray(t).dot(this._W);return a.add(this._b),a.value.map(h=>h>=0?1:-1)}}export class MultinomialLogisticRegression{static{p(this,"MultinomialLogisticRegression")}constructor(t){this._classes=t,this._W=null,this._b=null}_output(t){let s=t.dot(this._W);return s.add(this._b),s.map(Math.exp),s.div(s.sum(1)),s}fit(t,s,a=1,h=.1,o=0,e=0){const d=t.length;this._classes||(this._classes=[...new Set(s)]);const u=r.fromArray(t),l=new r(d,this._classes.length);s.forEach((n,i)=>l.set(i,this._classes.indexOf(n),1)),this._W||(this._W=r.randn(u.cols,this._classes.length),this._b=r.randn(1,this._classes.length));for(let n=0;n<a;n++){let i=this._output(u);i.sub(l);const _=u.tDot(i);_.div(d),(o>0||e>0)&&_.map(c=>c+c*e+Math.sign(c)*o),_.mult(h),this._W.sub(_);const f=i.mean(0);(o>0||e>0)&&f.map(c=>c+c*e+Math.sign(c)*o),f.mult(h),this._b.sub(f)}}predict(t){let a=r.fromArray(t).dot(this._W);return a.add(this._b),a.argmax(1).value.map(h=>this._classes[h])}}
