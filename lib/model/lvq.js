export class LVQCluster{constructor(t){this._k=t,this._w=null}_distance(t,i){return Math.sqrt(t.reduce(((t,s,h)=>t+(s-i[h])**2),0))}_nearest(t){let i=1/0,s=-1;for(let h=0;h<this._w.length;h++){const _=this._distance(t,this._w[h]);_<i&&(i=_,s=h)}return s}_init(t){const i=t.length,s=[];for(let t=0;t<this._k;t++)s.push(Math.floor(Math.random()*(i-t)));for(let t=this._k-1;t>=0;t--)for(let i=this._k-1;i>t;i--)s[t]<=s[i]&&s[i]++;this._w=[];for(let i=0;i<this._k;i++)this._w[i]=t[s[i]]}fit(t,i=.1){this._w||this._init(t);for(let s=0;s<t.length;s++){const h=this._nearest(t[s]);this._w[h]=this._w[h].map(((h,_)=>h+i*(t[s][_]-h)))}}predict(t){if(0!==this._w.length)return t.map((t=>this._nearest(t)))}}export class LVQClassifier{constructor(t){this._m=null,this._c=[],this._type=t,this._w=.2}_distance(t,i){return Math.sqrt(t.reduce(((t,s,h)=>t+(s-i[h])**2),0))}_nears(t){const i=[];for(let s=0;s<this._m.length;s++){const h=this._distance(t,this._m[s]);let _=0;for(;_<i.length&&!(h<i[_].d);_++);i.splice(_,0,{d:h,c:this._c[s],i:s})}return i}_init(t,i){const s=t.length;this._c=[...new Set(i)],this._m=[];for(let h=0;h<s;h++){const s=this._c.indexOf(i[h]);this._m[s]||(this._m[s]=t[h].concat())}}fit(t,i,s=.1){this._m||this._init(t,i);for(let h=0;h<t.length;h++)if(1===this._type){const _=this._nears(t[h])[0];i[h]===_.c?this._m[_.i]=this._m[_.i].map(((i,_)=>i+s*(t[h][_]-i))):this._m[_.i]=this._m[_.i].map(((i,_)=>i-s*(t[h][_]-i)))}else if(2===this._type){const _=this._nears(t[h]),e=_.find((t=>t.c===i[h])),n=_.find((t=>t.c!==i[h])),r=(1-this._w)/(1+this._w);Math.min(e.d/n.d,n.d/e.d)>r&&(this._m[e.i]=this._m[e.i].map(((i,_)=>i+s*(t[h][_]-i))),this._m[n.i]=this._m[n.i].map(((i,_)=>i-s*(t[h][_]-i))))}else if(3===this._type){const _=this._nears(t[h]),e=_[0],n=_[1];if(e.c===i[h]&&n.c===i[h])this._m[e.i]=this._m[e.i].map(((i,_)=>i+s*(t[h][_]-i))),this._m[n.i]=this._m[n.i].map(((i,_)=>i+s*(t[h][_]-i)));else if(e.c!==i[h]&&n.c===i[h]){const i=(1-this._w)/(1+this._w);Math.min(n.d/e.d,e.d/n.d)>i&&(this._m[n.i]=this._m[n.i].map(((i,_)=>i+s*(t[h][_]-i))),this._m[e.i]=this._m[e.i].map(((i,_)=>i-s*(t[h][_]-i))))}}}predict(t){if(0!==this._m.length)return t.map((t=>this._nears(t)[0].c))}}