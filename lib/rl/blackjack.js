var l=Object.defineProperty;var a=(e,s)=>l(e,"name",{value:s,configurable:!0});import{RLEnvironmentBase as p,RLIntRange as n,RLStepResult as r}from"./base.js";const d=0,u=1,_=2,o=3;class f{static{a(this,"Deck")}constructor(){this.cards=[];for(const s of[d,_,u,o])for(let t=1;t<=13;t++)this.cards.push({suit:s,value:t});this.shuffle()}init(){this.cards=[];for(const s of[d,_,u,o])for(let t=1;t<=13;t++)this.cards.push({suit:s,value:t});this.shuffle()}shuffle(){for(let s=this.cards.length-1;s>0;s--){const t=Math.floor(Math.random()*(s+1));[this.cards[s],this.cards[t]]=[this.cards[t],this.cards[s]]}}pop(){return this.cards.pop()}}export default class m extends p{static{a(this,"BlackjackRLEnvironment")}constructor(){super(),this._deck=new f,this._dealer_hands=[],this._player_hands=[],this._done=!1,this._reward={bust:-1,win:1,step:0},this.reset()}get actions(){return[[0,1]]}get states(){return[new n(2,31),new n(1,10),[0,1]]}_sumhands(s){let t=s.reduce((h,c)=>h+Math.min(10,c.value),0);const i=t<=11&&s.some(h=>h.value===1);return i&&(t+=10),[t,i]}reset(){return super.reset(),this._deck.init(),this._dealer_hands=[this._deck.pop(),this._deck.pop()],this._player_hands=[this._deck.pop(),this._deck.pop()],this._done=!1,this.state()}state(){const[s,t]=this._sumhands(this._player_hands);return[s,Math.min(10,this._dealer_hands[0].value),t?1:0]}step(s){if(s[0]===1)return this._player_hands.push(this._deck.pop()),this._sumhands(this._player_hands)[0]>21?(this._done=!0,new r(this,this.state(),this._reward.bust,!0)):new r(this,this.state(),this._reward.step,!1);for(this._done=!0;this._sumhands(this._dealer_hands)[0]<17;)this._dealer_hands.push(this._deck.pop());const t=this._sumhands(this._player_hands)[0]-this._sumhands(this._dealer_hands)[0];return new r(this,this.state(),t,!0)}}
