var M=Object.defineProperty;var m=(c,t)=>M(c,"name",{value:t,configurable:!0});import{RLRealRange as _,RLEnvironmentBase as y}from"./base.js";export default class x extends y{static{m(this,"CartPoleRLEnvironment")}constructor(){super(),this._position=0,this._angle=0,this._cart_velocity=0,this._pendulum_velocity=0,this._cart_weight=.711,this._pendulum_weight=.209,this._pendulum_length=.326,this._g=9.8,this._t=.02,this._force=10,this._fail_position=2.4,this._fail_angle=12/180*Math.PI,this._max_step=200,this._reward={goal:1,step:1,fail:0}}get actions(){return[[0,1]]}get states(){return[new _(-this._fail_position,this._fail_position),new _(-this._fail_angle,this._fail_angle),new _(-2,2),new _(-3,3)]}reset(){return super.reset(),this._position=Math.random()*.1-.05,this._angle=Math.random()*.1-.05,this._cart_velocity=Math.random()*.1-.05,this._pendulum_velocity=Math.random()*.1-.05,this.state()}state(){return[this._position,this._angle,this._cart_velocity,this._pendulum_velocity]}setState(t){this._position=t[0],this._angle=t[1],this._cart_velocity=t[2],this._pendulum_velocity=t[3]}test(t,f){let[h,s,n,e]=t;const u=this._force*(f[0]===0?-1:1),a=this._cart_weight,i=this._pendulum_weight,o=this._pendulum_length,l=Math.sin(s),r=Math.cos(s),d=((a+i)*this._g*l-r*(u+i*o*e**2*l))/(o*(4/3*(a+i)-i*r**2)),w=(u+i*o*(e**2*l-d*r))/(a+i);h+=n*this._t,s+=e*this._t,n+=w*this._t,e+=d*this._t;const p=Math.abs(s)>=this._fail_angle||Math.abs(h)>this._fail_position,g=this.epoch>=this._max_step||p,v=p?this._reward.fail:g?this._reward.goal:this._reward.step;return{state:[h,s,n,e],reward:v,done:g}}}
