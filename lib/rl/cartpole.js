import{RLRealRange,RLEnvironmentBase}from"./base.js";export default class CartPoleRLEnvironment extends RLEnvironmentBase{constructor(){super(),this._position=0,this._angle=0,this._cart_velocity=0,this._pendulum_velocity=0,this._cart_weight=.711,this._pendulum_weight=.209,this._pendulum_length=.326,this._g=9.8,this._t=.02,this._force=10,this._fail_position=2.4,this._fail_angle=12/180*Math.PI,this._max_step=200,this._reward={goal:1,step:1,fail:0}}get actions(){return[[0,1]]}get states(){return[new RLRealRange(-this._fail_position,this._fail_position),new RLRealRange(-this._fail_angle,this._fail_angle),new RLRealRange(-2,2),new RLRealRange(-3,3)]}set reward(t){this._reward={goal:1,step:1,fail:0}}reset(){return super.reset(),this._position=.1*Math.random()-.05,this._angle=.1*Math.random()-.05,this._cart_velocity=.1*Math.random()-.05,this._pendulum_velocity=.1*Math.random()-.05,this.state()}state(){return[this._position,this._angle,this._cart_velocity,this._pendulum_velocity]}step(t,e){super.step(t,e);const s=this.test(this.state(),t,e);return this._position=s.state[0],this._angle=s.state[1],this._cart_velocity=s.state[2],this._pendulum_velocity=s.state[3],s}test(t,e,s){let[i,a,_,h]=t;const n=this._force*(0===e[0]?-1:1),r=this._cart_weight,l=this._pendulum_weight,o=this._pendulum_length,p=Math.sin(a),u=Math.cos(a),g=((r+l)*this._g*p-u*(n+l*o*h**2*p))/(o*(4/3*(r+l)-l*u**2)),c=(n+l*o*(h**2*p-g*u))/(r+l);i+=_*this._t,a+=h*this._t,_+=c*this._t,h+=g*this._t;const d=Math.abs(a)>=this._fail_angle||Math.abs(i)>this._fail_position,m=this.epoch>=this._max_step||d;return{state:[i,a,_,h],reward:d?this._reward.fail:m?this._reward.goal:this._reward.step,done:m}}}