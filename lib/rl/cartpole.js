import{RLRealRange,RLEnvironmentBase}from"./base.js";export default class CartPoleRLEnvironment extends RLEnvironmentBase{constructor(){super(),this._position=0,this._angle=0,this._cart_velocity=0,this._pendulum_velocity=0,this._cart_weight=.711,this._pendulum_weight=.209,this._pendulum_length=.326,this._g=9.8,this._t=.02,this._force=10,this._fail_position=2.4,this._fail_angle=12/180*Math.PI,this._max_step=200,this._reward={goal:1,step:1,fail:0}}get actions(){return[[0,1]]}get states(){return[new RLRealRange(-this._fail_position,this._fail_position),new RLRealRange(-this._fail_angle,this._fail_angle),new RLRealRange(-2,2),new RLRealRange(-3,3)]}reset(){return super.reset(),this._position=.1*Math.random()-.05,this._angle=.1*Math.random()-.05,this._cart_velocity=.1*Math.random()-.05,this._pendulum_velocity=.1*Math.random()-.05,this.state()}state(){return[this._position,this._angle,this._cart_velocity,this._pendulum_velocity]}setState(t){this._position=t[0],this._angle=t[1],this._cart_velocity=t[2],this._pendulum_velocity=t[3]}test(t,i){let[e,s,a,_]=t;const h=this._force*(0===i[0]?-1:1),n=this._cart_weight,l=this._pendulum_weight,o=this._pendulum_length,r=Math.sin(s),g=Math.cos(s),p=((n+l)*this._g*r-g*(h+l*o*_**2*r))/(o*(4/3*(n+l)-l*g**2)),u=(h+l*o*(_**2*r-p*g))/(n+l);e+=a*this._t,s+=_*this._t,a+=u*this._t,_+=p*this._t;const c=Math.abs(s)>=this._fail_angle||Math.abs(e)>this._fail_position,d=this.epoch>=this._max_step||c;return{state:[e,s,a,_],reward:c?this._reward.fail:d?this._reward.goal:this._reward.step,done:d}}}