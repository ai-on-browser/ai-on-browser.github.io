import{RLRealRange,RLEnvironmentBase}from"./base.js";export default class CartPoleRLEnvironment extends RLEnvironmentBase{constructor(){super(),this._position=0,this._angle=0,this._cart_velocity=0,this._pendulum_velocity=0,this._cart_weight=.711,this._pendulum_weight=.209,this._pendulum_length=.326,this._g=9.8,this._t=.02,this._force=10,this._fail_position=2.4,this._fail_angle=12/180*Math.PI,this._max_step=200,this._reward={goal:1,step:1,fail:0}}get actions(){return[[0,1]]}get states(){return[new RLRealRange(-this._fail_position,this._fail_position),new RLRealRange(-this._fail_angle,this._fail_angle),new RLRealRange(-2,2),new RLRealRange(-3,3)]}set reward(t){this._reward={goal:1,step:1,fail:0}}reset(){return super.reset(),this._position=.1*Math.random()-.05,this._angle=.1*Math.random()-.05,this._cart_velocity=.1*Math.random()-.05,this._pendulum_velocity=.1*Math.random()-.05,this.state()}state(){return[this._position,this._angle,this._cart_velocity,this._pendulum_velocity]}step(t,e){super.step(t,e);const s=this.test(this.state(),t,e);return this._position=s.state[0],this._angle=s.state[1],this._cart_velocity=s.state[2],this._pendulum_velocity=s.state[3],s}test(t,e){let[s,i,a,_]=t;const h=this._force*(0===e[0]?-1:1),n=this._cart_weight,r=this._pendulum_weight,l=this._pendulum_length,o=Math.sin(i),p=Math.cos(i),u=((n+r)*this._g*o-p*(h+r*l*_**2*o))/(l*(4/3*(n+r)-r*p**2)),g=(h+r*l*(_**2*o-u*p))/(n+r);s+=a*this._t,i+=_*this._t,a+=g*this._t,_+=u*this._t;const c=Math.abs(i)>=this._fail_angle||Math.abs(s)>this._fail_position,d=this.epoch>=this._max_step||c;return{state:[s,i,a,_],reward:c?this._reward.fail:d?this._reward.goal:this._reward.step,done:d}}}