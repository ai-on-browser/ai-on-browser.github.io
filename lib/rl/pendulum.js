import{RLRealRange,RLEnvironmentBase}from"./base.js";export default class PendulumRLEnvironment extends RLEnvironmentBase{constructor(){super(),this._theta=0,this._dtheta=0,this._mass=1,this._length=1,this._max_speed=8,this._max_torque=2,this._g=9.8,this._dt=.05,this._max_step=200}get actions(){return[new RLRealRange(-this._max_torque,this._max_torque)]}get states(){return[new RLRealRange(-1,1),new RLRealRange(-1,1),new RLRealRange(-this._max_speed,this._max_speed)]}reset(){return super.reset(),this._theta=2*Math.random()*Math.PI-Math.PI,this._dtheta=Math.random()-.5,this.state()}state(){return[Math.cos(this._theta),Math.sin(this._theta),this._dtheta]}step(t,e){super.step(t,e);let s=this._theta,a=this._dtheta;const h=(t,e,s)=>t<e?e:t>s?s:t,_=h(t[0],-this._max_torque,this._max_torque),i=this._g,n=this._mass,r=this._length,o=this._angle_normalize(s)**2+.1*a**2+.001*_**2;return a+=(-3*i/(2*r)*Math.sin(s+Math.PI)+3/(n*r**2)*_)*this._dt,this._theta+=a*this._dt,this._dtheta=h(a,-this._max_speed,this._max_speed),{state:[Math.cos(s),Math.sin(s),a],reward:-o,done:this.epoch>=this._max_step}}_angle_normalize(t){t+=Math.PI;const e=2*Math.PI;for(;t<0;)t+=e;for(;t>=e;)t-=e;return t-Math.PI}}