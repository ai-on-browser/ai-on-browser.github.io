var u=Object.defineProperty;var p=(o,t)=>u(o,"name",{value:t,configurable:!0});import{RLEnvironmentBase as g,RLIntRange as c,RLRealRange as m,RLStepResult as M}from"./base.js";export default class y extends g{static{p(this,"SmoothMazeRLEnvironment")}constructor(t,_){super(),this._width=t,this._height=_,this._points=[],this._map_resolution=[100,50],this._goal_size=[50,50],this._position=Array(2).fill(0),this._orient=0,this._velocity=10,this._rotate=5,this._max_step=3e3,this.__map=[];for(let i=0;i<this._map_resolution[0];i++)this.__map[i]=Array(this._map_resolution[1]);this._reward={step:-1,wall:-2,goal:200,fail:-100}}get actions(){return[[0,1,2,3]]}get states(){return[new m(0,this._width),new m(0,this._height),new c(0,359)]}get map(){for(let t=0;t<this._map_resolution[0];t++)this.__map[t].fill(0);return this._points.forEach(t=>{this.__map[t[0]][t[1]]=1-this.__map[t[0]][t[1]]}),this.__map[0][0]=0,this.__map[this._map_resolution[0]-1][this._map_resolution[1]-1]=0,this.__map}reset(){return super.reset(),this._position=Array(2).fill(0),this._position[0]=Math.random()*this._width/4,this._position[1]=Math.random()*this._height/4,this._orient=Math.random()*360,this.state()}state(){return[this._position[0],this._position[1],this._orient]}setState(t){this._position=[t[0],t[1]],this._orient=t[2]}test(t,_){let i=this._reward.step,[s,h,e]=t;const d=this.map,f=this._width/this._map_resolution[0],w=this._height/this._map_resolution[1],r=Math.cos(e/180*Math.PI)*this._velocity,a=Math.sin(e/180*Math.PI)*this._velocity;_[0]===0?(s+=r,h+=a):_[0]===1?(s-=r,h-=a):_[0]===2?e+=this._rotate:_[0]===3&&(e-=this._rotate),e=(e+360)%360,s<0||h<0||s>=this._width||h>=this._height?(i=this._reward.wall,[s,h,e]=t):d[Math.floor(s/f)][Math.floor(h/w)]!==0&&(i=this._reward.wall,[s,h,e]=t);const n=this._max_step&&this._max_step<=this.epoch,l=s>this._width-this._goal_size[0]&&h>this._height-this._goal_size[1]||n;return l&&(i=this._reward.goal),n&&(i=this._reward.fail),new M(this,[s,h,e],i,l)}}
