var S=Object.defineProperty;var M=(p,i)=>S(p,"name",{value:i,configurable:!0});import{RLRealRange as o,RLEnvironmentBase as j}from"./base.js";export default class q extends j{static{M(this,"AcrobotRLEnvironment")}constructor(){super(),this._theta1=0,this._theta2=0,this._dtheta1=0,this._dtheta2=0,this._link_len1=1,this._link_len2=1,this._link_mass1=1,this._link_mass2=1,this._link_com_pos1=.5,this._link_com_pos2=.5,this._moi=1,this._max_vel1=4*Math.PI,this._max_vel2=9*Math.PI,this._g=9.8,this._dt=.1,this._max_step=200,this._reward={goal:0,step:-1,fail:0}}get actions(){return[[-1,0,1]]}get states(){return[new o(-Math.PI,Math.PI),new o(-Math.PI,Math.PI),new o(-this._max_vel1,this._max_vel1),new o(-this._max_vel2,this._max_vel2)]}reset(){return super.reset(),this._theta1=Math.random()*.2-.1,this._theta2=Math.random()*.2-.1,this._dtheta1=Math.random()*.2-.1,this._dtheta2=Math.random()*.2-.1,this.state()}state(){return[this._theta1,this._theta2,this._dtheta1,this._dtheta2]}setState(i){this._theta1=i[0],this._theta2=i[1],this._dtheta1=i[2],this._dtheta2=i[3]}test(i,R){let[s,t,e,n]=i;const L=R[0],I=this._link_mass1,a=this._link_mass2,_=this._link_len1,P=this._link_com_pos1,h=this._link_com_pos2,E=this._moi,l=this._moi,w=this._g,c=I*P**2+a*(_**2+h**2+2*_*h*Math.cos(t))+E+l,r=a*(h**2+_*h*Math.cos(t))+l,d=a*h*w*Math.cos(s+t-Math.PI/2),b=-a*_*h*n**2*Math.sin(t)-2*a*_*h*n*e*Math.sin(t)+(I*P+a*_)*w*Math.cos(s-Math.PI/2)+d,v=(L+r/c*b-a*_*h*e**2*Math.sin(t)-d)/(a*h**2+l-r**2/c),A=-(r*v+d)/c,k=M((m,g,f)=>m<g?g:m>f?f:m,"clip");for(s+=this._dt*e;s<-Math.PI;)s+=2*Math.PI;for(;s>Math.PI;)s-=2*Math.PI;for(t+=this._dt*n;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;e=k(e+this._dt*A,-this._max_vel1,this._max_vel1),n=k(n+this._dt*v,-this._max_vel2,this._max_vel2);const x=this.epoch>=this._max_step,u=-Math.cos(s)-Math.cos(t+s)>1||x,B=x?this._reward.fail:u?this._reward.goal:this._reward.step;return{state:[s,t,e,n],reward:B,done:u}}}
