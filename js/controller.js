var x=Object.defineProperty;var h=(b,t)=>x(b,"name",{value:t,configurable:!0});export default class f{static{h(this,"Controller")}constructor(t,u){this._platform=t,this._e=u??t.setting.ml.configElement.node(),this._terminators=[],t.setting.terminate=this.terminate.bind(this),this.input=this.input.bind(this),this.input.text=e=>this.input({type:"text",...e}),this.input.number=e=>this.input({type:"number",...e}),this.input.range=e=>this.input({type:"range",...e}),this.input.button=e=>(typeof e=="string"&&(e={value:e}),this.input({type:"button",...e}))}get element(){return this._e}terminate(){this._terminators.forEach(t=>t())}span(){const t=document.createElement("span");return this._e.appendChild(t),new f(this._platform,t)}text(t={}){typeof t=="string"&&(t={value:t});const u=this._e;t.label&&u.appendChild(document.createTextNode(t.label));const e=document.createElement("span");return u.appendChild(e),e.innerText=t.value??"",{element:e,get value(){return e.innerText},set value(r){e.innerText=r}}}select(t={}){Array.isArray(t)&&(t={values:t});const u=this._e,{label:e,values:r,value:l,...n}=t;e&&u.appendChild(document.createTextNode(e));const i=document.createElement("select");u.appendChild(i);for(const a of r){const p=document.createElement("option");p.value=p.innerText=a,i.appendChild(p)}l&&(i.value=l);for(const a of Object.keys(n))n[a]!=null&&i.setAttribute(a,n[a]);return{element:i,get value(){return i.value},set value(a){i.value=a},set values(a){i.replaceChild();for(const p of a){const o=document.createElement("option");o.value=p,o.innerText=p,i.appendChild(o)}},on(a,p){return i.addEventListener(a,p),this}}}input({label:t,type:u,...e}){const r=this._e;t&&r.appendChild(document.createTextNode(t));const l=document.createElement("input");r.appendChild(l),l.type=u;for(const n of Object.keys(e))e[n]!=null&&l.setAttribute(n,e[n]);return{element:l,get value(){return u==="number"||u==="range"?+l.value:u==="checkbox"?l.checked:l.value},set value(n){l.value=n},on(n,i){return l.addEventListener(n,i),this}}}array({label:t,type:u,...e}){const r=this._e;t&&r.appendChild(document.createTextNode(t));const l=document.createElement("span");r.appendChild(l);const n=e.values??[],i=[],a=h(()=>{l.replaceChildren();for(let o=0;o<n.length;o++){const c=document.createElement("input");c.type=u;for(const s of Object.keys(e))e[s]!=null&&c.setAttribute(s,e[s]);c.value=n[o],c.onchange=()=>{n[o]=c.value},l.appendChild(c),i.push(c)}if(n.length>0){const o=document.createElement("input");o.type="button",o.value="-",o.onclick=()=>{n.pop(),a()},l.appendChild(o)}},"createElms"),p=document.createElement("input");return p.type="button",p.value="+",p.onclick=()=>{n.push(e.default),a()},r.appendChild(p),a(),{element:l,get value(){return u==="number"||u==="range"?n.map(o=>+o):n},set value(o){n.length=0,n.push(...o),a()},on(o,c){return i.forEach(s=>s.addEventListener(o,c)),this}}}stepLoopButtons(){let t=0;const u=this._e;let e=!1,r=null,l=null,n=null,i=null,a=h(()=>t+1,"epochCb"),p=!1,o=null;const c={initialize:null,stop:()=>e=!1,set enable(s){r&&(r.disabled=!s),l&&(l.disabled=!s),n&&(n.disabled=!s)},init(s){this.initialize=s;const d=document.createElement("input");return d.type="button",d.value="Initialize",d.onclick=()=>{s.length>0?(d.disabled=!0,this.enable=!1,s(()=>{d.disabled=!1,this.enable=!0,i&&(i.innerText=t=0)})):(s(),this.enable=!0,i&&(i.innerText=t=0))},u.appendChild(d),p=!0,this},step(s){return r=document.createElement("input"),r.type="button",r.value="Step",r.disabled=p,r.onclick=()=>{s.length>0?(this.enable=!1,s(()=>{this.enable=!0,i&&(i.innerText=t=a())})):(s(),i&&(i.innerText=t=a()))},u.appendChild(r),l=document.createElement("input"),l.type="button",l.value="Run",l.disabled=p,l.onclick=()=>{if(e=!e,l.value=e?"Stop":"Run",e){const d=h(()=>{e&&(s.length>0?s(()=>{i&&(i.innerText=t=a()),setTimeout(d,0)}):(s(),i&&(i.innerText=t=a()),setTimeout(d,0))),r.disabled=e,n&&(n.disabled=e),l.disabled=!1},"stepLoop");d()}else l.disabled=!0},u.appendChild(l),o=s,this},skip(s){return s||=o,n=document.createElement("input"),n.type="button",n.value="Skip",n.disabled=p,n.onclick=()=>{if(e=!e,n.value=e?"Stop":"Skip",e){let d=new Date().getTime();const m=h(()=>{for(r&&(r.disabled=e),l&&(l.disabled=e),n.disabled=!1;e;)if(s.length>0){s(()=>{i&&(i.innerText=t=a()),setTimeout(m,0)});return}else{s(),i&&(i.innerText=t=a());const v=new Date().getTime();if(v-d>200){d=v,setTimeout(m,0);return}}},"stepLoop");m()}else n.disabled=!0},u.appendChild(n),this},epoch(s){return u.appendChild(document.createTextNode(" Epoch: ")),i=document.createElement("span"),u.appendChild(i),i.setAttribute("name","epoch"),i.innerText=0,s&&(a=s),this},elm(s){return s(u),this}};return this._terminators.push(c.stop),c}}
