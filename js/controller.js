export default class Controller{constructor(e){this._e=e.setting.ml.configElement.node(),this._terminators=[],e.setting.terminate=this.terminate.bind(this),this.input.text=e=>this.input({type:"text",...e}),this.input.number=e=>this.input({type:"number",...e}),this.input.range=e=>this.input({type:"range",...e}),this.input.button=e=>("string"==typeof e&&(e={value:e}),this.input({type:"button",...e}))}terminate(){this._terminators.forEach((e=>e()))}text(e={}){"string"==typeof e&&(e={value:e});const t=this._e;e.label&&t.appendChild(document.createTextNode(e.label));const n=document.createElement("span");return t.appendChild(n),n.innerText=e.value??"",{element:n,get value(){return n.innerText},set value(e){n.innerText=e}}}select(e={}){Array.isArray(e)&&(e={values:e});const t=this._e,{label:n,values:i,value:l,...s}=e;n&&t.appendChild(document.createTextNode(n));const a=document.createElement("select");t.appendChild(a);for(const e of i){const t=document.createElement("option");t.value=t.innerText=e,a.appendChild(t)}l&&(a.value=l);for(const e of Object.keys(s))null!=s[e]&&a.setAttribute(e,s[e]);return{element:a,get value(){return a.value},set value(e){a.value=e},set values(e){a.replaceChild();for(const t of e){const e=document.createElement("option");e.value=t,e.innerText=t,a.appendChild(e)}},on(e,t){return a.addEventListener(e,t),this}}}input({label:e,type:t,...n}){const i=this._e;e&&i.appendChild(document.createTextNode(e));const l=document.createElement("input");i.appendChild(l),l.type=t;for(const e of Object.keys(n))null!=n[e]&&l.setAttribute(e,n[e]);return{element:l,get value(){return"number"===t||"range"===t?+l.value:l.value},set value(e){l.value=e},on(e,t){return l.addEventListener(e,t),this}}}stepLoopButtons(){let e=0;const t=this._e;let n=!1,i=null,l=null,s=null,a=null,u=()=>e+1,r=!1,o=null;const d={initialize:null,stop:()=>n=!1,set enable(e){i&&(i.disabled=!e),l&&(l.disabled=!e),s&&(s.disabled=!e)},init(n){this.initialize=n;const i=document.createElement("input");return i.type="button",i.value="Initialize",i.onclick=()=>{n.length>0?(i.disabled=!0,this.enable=!1,n((()=>{i.disabled=!1,this.enable=!0,a&&(a.innerText=e=0)}))):(n(),this.enable=!0,a&&(a.innerText=e=0))},t.appendChild(i),r=!0,this},step(d){return i=document.createElement("input"),i.type="button",i.value="Step",i.disabled=r,i.onclick=()=>{d.length>0?(this.enable=!1,d((()=>{this.enable=!0,a&&(a.innerText=e=u())}))):(d(),a&&(a.innerText=e=u()))},t.appendChild(i),l=document.createElement("input"),l.type="button",l.value="Run",l.disabled=r,l.onclick=()=>{if(n=!n,l.value=n?"Stop":"Run",n){const t=()=>{n&&(d.length>0?d((()=>{a&&(a.innerText=e=u()),setTimeout(t,0)})):(d(),a&&(a.innerText=e=u()),setTimeout(t,0))),i.disabled=n,s&&(s.disabled=n),l.disabled=!1};t()}else l.disabled=!0},t.appendChild(l),o=d,this},skip(d){return d||=o,s=document.createElement("input"),s.type="button",s.value="Skip",s.disabled=r,s.onclick=()=>{if(n=!n,s.value=n?"Stop":"Skip",n){let t=(new Date).getTime();const r=()=>{for(i&&(i.disabled=n),l&&(l.disabled=n),s.disabled=!1;n;){if(d.length>0)return void d((()=>{a&&(a.innerText=e=u()),setTimeout(r,0)}));{d(),a&&(a.innerText=e=u());const n=(new Date).getTime();if(n-t>200)return t=n,void setTimeout(r,0)}}};r()}else s.disabled=!0},t.appendChild(s),this},epoch(e){return t.appendChild(document.createTextNode(" Epoch: ")),a=document.createElement("span"),t.appendChild(a),a.setAttribute("name","epoch"),a.innerText=0,e&&(u=e),this},elm(e){return e(t),this}};return this._terminators.push(d.stop),d}}