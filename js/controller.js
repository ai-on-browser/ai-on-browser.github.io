var x=Object.defineProperty;var c=(b,t)=>x(b,"name",{value:t,configurable:!0});export default class m{static{c(this,"Controller")}constructor(t,r){this._platform=t,this._e=r??t.setting.ml.configElement.node(),this._terminators=[],t._manager._terminateFunction.push(this.terminate.bind(this)),this.input=this.input.bind(this),this.input.text=e=>this.input({type:"text",...e}),this.input.number=e=>this.input({type:"number",...e}),this.input.range=e=>this.input({type:"range",...e}),this.input.button=e=>(typeof e=="string"&&(e={value:e}),this.input({type:"button",...e}))}get element(){return this._e}terminate(){this._terminators.forEach(t=>t())}span(){const t=document.createElement("span");return this._e.appendChild(t),new m(this._platform,t)}div(){const t=document.createElement("div");return this._e.appendChild(t),new m(this._platform,t)}text(t={}){typeof t=="string"&&(t={value:t});const r=this._e;t.label&&r.appendChild(document.createTextNode(t.label));const e=document.createElement("span");return r.appendChild(e),e.innerText=t.value??"",{element:e,get value(){return e.innerText},set value(o){e.innerText=o}}}select(t={}){Array.isArray(t)&&(t={values:t});const r=this._e,{label:e,values:o,value:i,texts:n,...s}=t;e&&r.appendChild(document.createTextNode(e));const d=document.createElement("select");r.appendChild(d);for(let a=0;a<o.length;a++){const u=document.createElement("option");u.value=o[a],u.innerText=n?.[a]??o[a],d.appendChild(u)}i&&(d.value=i);for(const a of Object.keys(s))s[a]!=null&&d.setAttribute(a,s[a]);return{element:d,get value(){return d.value},set value(a){d.value=a},set values(a){d.replaceChildren();for(const u of a){const p=document.createElement("option");p.value=u,p.innerText=u,d.appendChild(p)}},on(a,u){return d.addEventListener(a,u),this}}}input({label:t,type:r,...e}){const o=this._e;t&&o.appendChild(document.createTextNode(t));const i=document.createElement("input");o.appendChild(i),i.type=r;for(const n of Object.keys(e))e[n]!=null&&i.setAttribute(n,e[n]);return{element:i,get value(){return r==="number"||r==="range"?+i.value:r==="checkbox"?i.checked:i.value},set value(n){i.value=n},on(n,s){return i.addEventListener(n,s),this}}}array({label:t,type:r,...e}){const o=this._e;t&&o.appendChild(document.createTextNode(t));const i=document.createElement("span");o.appendChild(i);const n=e.values??[],s=[],d=c(()=>{i.replaceChildren();for(let u=0;u<n.length;u++){const p=document.createElement("input");p.type=r;for(const l of Object.keys(e))e[l]!=null&&p.setAttribute(l,e[l]);p.value=n[u],p.onchange=()=>{n[u]=p.value},i.appendChild(p),s.push(p)}if(n.length>0){const u=document.createElement("input");u.type="button",u.value="-",u.onclick=()=>{n.pop(),d()},i.appendChild(u)}},"createElms"),a=document.createElement("input");return a.type="button",a.value="+",a.onclick=()=>{n.push(e.default),d()},o.appendChild(a),d(),{element:i,get value(){return r==="number"||r==="range"?n.map(u=>+u):n},set value(u){n.length=0,n.push(...u),d()},on(u,p){return s.forEach(l=>l.addEventListener(u,p)),this}}}stepLoopButtons(){let t=0;const r=this._e;let e=!1,o=null,i=null,n=null,s=null,d=c(()=>t+1,"epochCb"),a=!1,u=null;const p={initialize:null,stop:c(()=>e=!1,"stop"),set enable(l){o&&(o.disabled=!l),i&&(i.disabled=!l),n&&(n.disabled=!l)},init(l){this.initialize=l;const h=document.createElement("input");return h.type="button",h.value="Initialize",h.onclick=()=>{l.length>0?(h.disabled=!0,this.enable=!1,l(()=>{h.disabled=!1,this.enable=!0,s&&(s.innerText=t=0)})):(l(),this.enable=!0,s&&(s.innerText=t=0))},r.appendChild(h),a=!0,this},step(l){return o=document.createElement("input"),o.type="button",o.value="Step",o.disabled=a,o.onclick=()=>{if(l.length>0)this.enable=!1,l(()=>{this.enable=!0,s&&(s.innerText=t=d())});else{const h=l();h?(this.enable=!1,Promise.resolve(h).then(()=>{this.enable=!0,s&&(s.innerText=t=d())})):s&&(s.innerText=t=d())}},r.appendChild(o),i=document.createElement("input"),i.type="button",i.value="Run",i.disabled=a,i.onclick=()=>{if(e=!e,i.value=e?"Stop":"Run",e){const h=c(()=>{e&&(l.length>0?l(()=>{s&&(s.innerText=t=d()),setTimeout(h,0)}):Promise.resolve(l()).then(()=>{s&&(s.innerText=t=d()),setTimeout(h,0)})),o.disabled=e,n&&(n.disabled=e),i.disabled=!1},"stepLoop");h()}else i.disabled=!0},r.appendChild(i),u=l,this},skip(l){return l||=u,n=document.createElement("input"),n.type="button",n.value="Skip",n.disabled=a,n.onclick=()=>{if(e=!e,n.value=e?"Stop":"Skip",e){let h=new Date().getTime();const v=c(()=>{for(o&&(o.disabled=e),i&&(i.disabled=e),n.disabled=!1;e;)if(l.length>0){l(()=>{s&&(s.innerText=t=d()),setTimeout(v,0)});return}else{l(),s&&(s.innerText=t=d());const f=new Date().getTime();if(f-h>200){h=f,setTimeout(v,0);return}}},"stepLoop");v()}else n.disabled=!0},r.appendChild(n),this},epoch(l){return r.appendChild(document.createTextNode(" Epoch: ")),s=document.createElement("span"),r.appendChild(s),s.setAttribute("name","epoch"),s.innerText=0,l&&(d=l),this},elm(l){return l(r),this}};return this._terminators.push(p.stop),p}}
