import{FixData}from"./base.js";class JSONLoader{constructor(t){this._data=t}get data(){return this._data}async load(t){if(t instanceof File)return void await new Promise((e=>{const a=new FileReader;a.onload=()=>{this._data=JSON.parse(a.result),e()},a.readAsText(t)}));const e=await fetch(t);this._data=await e.json()}}export default class JSONData extends FixData{constructor(t,e,a){super(t),e&&a&&this.setJSON(e,a)}readJSON(t,e){const a=new JSONLoader(null);a.load(t).then((()=>e(a.data)))}setJSON(t,e){if(!Array.isArray(t))return void this.readJSON(t,(t=>{this.setJSON(t,e)}));const a=[];if(e)for(let t=0;t<e.length;t++)a[t]=e[t].name;const s=[],n=[];for(let r=0;r<t.length;r++){const o=[];for(const e of Object.keys(t[r])){let s=a.indexOf(e);s<0&&(a.push(e),s=a.length-1,n[s]=!1),o[s]=t[r][e],n[s]||=isNaN(o[s])}if(e)for(let t=0;t<e.length;t++)null==o[t]&&"number"==typeof e[t].nan&&(o[t]=e[t].nan);s[r]=o}e||((e=a.map(((t,e)=>({name:t,type:n[e]?"category":"numeric"}))))[e.length-1].out=!0),this.setArray(s,e)}}