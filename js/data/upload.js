var f=Object.defineProperty;var l=(_,t)=>f(_,"name",{value:t,configurable:!0});import{BaseData as s,FixData as p}from"./base.js";import y from"./loader/audio.js";import c from"./loader/csv.js";import d from"./loader/document.js";import m from"./loader/image.js";import u from"./loader/json.js";export default class i extends s{static{l(this,"UploadData")}constructor(t){super(t);const e=this.setting.data.configElement,o=document.createElement("input");o.type="file",o.classList.add("data-upload"),o.onchange=()=>{!o.files||o.files.length<=0||this.loadFile(o.files[0])},e.appendChild(o);const a=document.createElement("div");a.classList.add("data-upload"),e.appendChild(a),a.append("You can upload Text/Image/CSV files.");const n=document.createElement("div");a.appendChild(n),n.classList.add("sub-menu","data-upload");for(const h of["CSV: A header in the first line and a target variable in the last column.","JSON: Array of objects.","Text: Plain text or PDF.","Image: JPEG, PNG, BMP, GIF etc.","Audio: Audio data."]){const r=document.createElement("div");r.innerText=h,r.style.fontSize="80%",r.classList.add("data-upload"),n.appendChild(r)}}get availTask(){return this._filetype==="image"?["SG","DN","ED"]:this._filetype==="audio"||this._filetype==="video"?["SM"]:this._filetype==="text"?["WE"]:["CF","RG","AD","DR","FS"]}async loadFile(t){if(this._file=t,this._filetype=null,t.type.startsWith("image/"))this._filetype="image";else if(t.type.startsWith("audio/"))this._filetype="audio";else if(t.type.startsWith("video/"))this._filetype="video";else if(t.type==="application/pdf")this._filetype="text";else if(t.type==="text/plain")this._filetype="text";else if(t.type==="text/csv")this._filetype="csv";else if(t.type==="application/json")this._filetype="json";else if(t.type==="")this._filetype="csv";else throw`Unknown file type: ${t.type}`;if(this.setting.data.configElement.querySelectorAll(":not(.data-upload)").forEach(e=>e.remove()),this._manager.task&&this._manager.platform._renderer.forEach(e=>e.terminate()),this._filetype==="image"){i.prototype.__proto__=s.prototype,i.__proto__=s;const e=await m.load(t);this._x=[e],this._y=[0]}else if(this._filetype==="audio"||this._filetype==="video"){i.prototype.__proto__=s.prototype,i.__proto__=s;const e=await y.load(t);this._x=Array.from(e.getChannelData(0)).map(o=>[o]),this._y=Array(this._x.length).fill(0)}else if(this._filetype==="text"){i.prototype.__proto__=s.prototype,i.__proto__=s;const e=await d.load(t);this._x=[d.segment(e)],this._y=[0]}else if(this._filetype==="json"){i.prototype.__proto__=p.prototype,i.__proto__=p;const e=await u.load(t);this.setArray(e.data,e.info)}else{i.prototype.__proto__=p.prototype,i.__proto__=p;const e=await c.load(t,{header:1});this.setArray(e.data,e.info)}this.setting.ml.refresh(),this._manager.setTask(""),this.setting.$forceUpdate()}}
