import{BaseData}from"./base.js";import CSVData from"./csv.js";import JSONData from"./json.js";import ImageData from"./image.js";import AudioData from"./audio.js";import DocumentData from"./document.js";export default class UploadData extends BaseData{constructor(t){super(t);const e=this.setting.data.configElement,a=document.createElement("input");a.type="file",a.classList.add("data-upload"),a.onchange=()=>{!a.files||a.files.length<=0||this.loadFile(a.files[0])},e.appendChild(a);const i=document.createElement("div");i.classList.add("data-upload"),e.appendChild(i),i.append("You can upload Text/Image/CSV files.");const o=document.createElement("div");i.appendChild(o),o.classList.add("sub-menu","data-upload");for(const t of["CSV: A header in the first line and a target variable in the last column.","JSON: Array of objects.","Text: Plain text or PDF.","Image: JPEG, PNG, BMP, GIF etc.","Audio: Audio data."]){const e=document.createElement("div");e.innerText=t,e.style.fontSize="80%",e.classList.add("data-upload"),o.appendChild(e)}}get availTask(){return"image"===this._filetype?["SG","DN","ED"]:"audio"===this._filetype?["SM"]:"text"===this._filetype?["WE"]:["CF","RG","AD","DR","FS"]}loadFile(t){if(this._file=t,this._filetype=null,t.type.startsWith("image/"))this._filetype="image";else if(t.type.startsWith("audio/"))this._filetype="audio";else if(t.type.startsWith("video/"))this._filetype="video";else if("application/pdf"===t.type)this._filetype="text";else if("text/plain"===t.type)this._filetype="text";else if("text/csv"===t.type)this._filetype="csv";else if("application/json"===t.type)this._filetype="json";else{if(""!==t.type)throw"Unknown file type: "+t.type;this._filetype="csv"}this.setting.data.configElement.querySelectorAll(":not(.data-upload)").forEach((t=>t.remove())),this.setting.vue.mlTask&&this._manager.platform._renderer.forEach((t=>t.terminate())),"image"===this._filetype?(UploadData.prototype.__proto__=ImageData.prototype,UploadData.__proto__=ImageData,this.readImage(t).then((t=>{this._x=[t],this._y=[0],this._manager.platform.render&&this._manager.platform.render()}))):"audio"===this._filetype||"video"===this._filetype?(UploadData.prototype.__proto__=AudioData.prototype,UploadData.__proto__=AudioData,this.readAudio(t).then((t=>{this._x=Array.from(t.getChannelData(0)).map((t=>[t])),this._y=Array(this._x.length).fill(0),this._manager.platform.render&&this._manager.platform.render()}))):"text"===this._filetype?(UploadData.prototype.__proto__=DocumentData.prototype,UploadData.__proto__=DocumentData,this.readDocument(t).then((t=>{this._x=[this.segment(t)],this._y=[0],this._manager.platform.render&&this._manager.platform.render()}))):"json"===this._filetype?(UploadData.prototype.__proto__=JSONData.prototype,UploadData.__proto__=JSONData,this.setJSON(t)):(UploadData.prototype.__proto__=CSVData.prototype,UploadData.__proto__=CSVData,this.setCSV(t,null,!0)),this.setting.ml.refresh(),this.setting.vue.mlTask="",this.setting.vue.$forceUpdate()}}