var y=Object.defineProperty;var p=(f,t)=>y(f,"name",{value:t,configurable:!0});import{BaseData as u}from"./base.js";import n from"./csv.js";import l from"./json.js";import h from"./image.js";import _ from"./audio.js";import d from"./document.js";export default class i extends u{static{p(this,"UploadData")}constructor(t){super(t);const e=this.setting.data.configElement,s=document.createElement("input");s.type="file",s.classList.add("data-upload"),s.onchange=()=>{!s.files||s.files.length<=0||this.loadFile(s.files[0])},e.appendChild(s);const o=document.createElement("div");o.classList.add("data-upload"),e.appendChild(o),o.append("You can upload Text/Image/CSV files.");const a=document.createElement("div");o.appendChild(a),a.classList.add("sub-menu","data-upload");for(const m of["CSV: A header in the first line and a target variable in the last column.","JSON: Array of objects.","Text: Plain text or PDF.","Image: JPEG, PNG, BMP, GIF etc.","Audio: Audio data."]){const r=document.createElement("div");r.innerText=m,r.style.fontSize="80%",r.classList.add("data-upload"),a.appendChild(r)}}get availTask(){return this._filetype==="image"?["SG","DN","ED"]:this._filetype==="audio"||this._filetype==="video"?["SM"]:this._filetype==="text"?["WE"]:["CF","RG","AD","DR","FS"]}loadFile(t){if(this._file=t,this._filetype=null,t.type.startsWith("image/"))this._filetype="image";else if(t.type.startsWith("audio/"))this._filetype="audio";else if(t.type.startsWith("video/"))this._filetype="video";else if(t.type==="application/pdf")this._filetype="text";else if(t.type==="text/plain")this._filetype="text";else if(t.type==="text/csv")this._filetype="csv";else if(t.type==="application/json")this._filetype="json";else if(t.type==="")this._filetype="csv";else throw"Unknown file type: "+t.type;this.setting.data.configElement.querySelectorAll(":not(.data-upload)").forEach(e=>e.remove()),this.setting.vue.mlTask&&this._manager.platform._renderer.forEach(e=>e.terminate()),this._filetype==="image"?(i.prototype.__proto__=h.prototype,i.__proto__=h,this.readImage(t).then(e=>{this._x=[e],this._y=[0],this._manager.platform.render&&this._manager.platform.render()})):this._filetype==="audio"||this._filetype==="video"?(i.prototype.__proto__=_.prototype,i.__proto__=_,this.readAudio(t).then(e=>{this._x=Array.from(e.getChannelData(0)).map(s=>[s]),this._y=Array(this._x.length).fill(0),this._manager.platform.render&&this._manager.platform.render()})):this._filetype==="text"?(i.prototype.__proto__=d.prototype,i.__proto__=d,this.readDocument(t).then(e=>{this._x=[this.segment(e)],this._y=[0],this._manager.platform.render&&this._manager.platform.render()})):this._filetype==="json"?(i.prototype.__proto__=l.prototype,i.__proto__=l,this.setJSON(t)):(i.prototype.__proto__=n.prototype,i.__proto__=n,this.setCSV(t,null,!0)),this.setting.ml.refresh(),this.setting.vue.mlTask="",this.setting.vue.$forceUpdate()}}
