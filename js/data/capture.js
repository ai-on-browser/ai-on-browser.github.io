var a=Object.defineProperty;var h=(n,e)=>a(n,"name",{value:e,configurable:!0});import{BaseData as l}from"./base.js";import s from"./loader/image.js";import d from"../renderer/image.js";export default class o extends l{static{h(this,"CaptureData")}constructor(e){super(e),this._size=[240,360];const t=this.setting.data.configElement;this._mngelm=document.createElement("div"),t.appendChild(this._mngelm);const i=document.createElement("input");i.type="button",i.value="Add data",i.onclick=()=>this.startVideo(),this._mngelm.appendChild(i),this._slctImg=document.createElement("select"),this._slctImg.onchange=()=>{this._manager.platform.render(),this._thumbnail.replaceChildren(),this._thumbnail.appendChild(s.createCanvas(this.x[0]))},this._mngelm.appendChild(this._slctImg),this._thumbnail=document.createElement("span"),this._mngelm.appendChild(this._thumbnail),this._videoElm=document.createElement("div"),t.appendChild(this._videoElm),this.startVideo(),this._x=[],this._y=[],this._manager.platform._renderer.push(new d(e)),this._manager.setting.render.selectItem("image")}get availTask(){return["SG","DN","ED"]}get x(){const e=+this._slctImg.value-1;return this._x.length===0||!this._x[e]?[]:[this._x[e]]}startVideo(){this._mngelm.style.display="none";const e=document.createElement("div");e.innerText="Click video to use as data.",this._videoElm.appendChild(e),this._video=document.createElement("video"),this._videoElm.appendChild(this._video),this._video.width=this._size[1],this._video.height=this._size[0],this._video.autoplay=!0,this._video.onclick=()=>{s.load(this._video).then(t=>{this._x.push(t),this._y.push(0);const i=document.createElement("option");i.value=i.innerText=this._x.length,this._slctImg.appendChild(i),this._slctImg.value=this._x.length,this._thumbnail.replaceChildren(),this._thumbnail.appendChild(s.createCanvas(t)),this.stopVideo(),this._mngelm.style.display=null,this._manager.platform.render&&setTimeout(()=>{this._manager.platform.render()},0)})},navigator.mediaDevices.getDisplayMedia({video:!0}).then(t=>{this._video.srcObject=t}).catch(t=>{console.error(t),this.stopVideo(),this._mngelm.style.display=null})}stopVideo(){if(this._video){const e=this._video.srcObject;e&&(e.getTracks().forEach(t=>{t.stop()}),this._video.srcObject=null),this._video=null}this._videoElm.replaceChildren()}terminate(){super.terminate(),this.stopVideo()}}
