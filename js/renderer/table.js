import BaseRenderer from"./base.js";export default class TableRenderer extends BaseRenderer{constructor(e){super(e),this._offset=0,this._pagesize=100,this._predict=null;const t=this.setting.render.addItem("table"),s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.position="sticky",s.style.top="0";const i=document.createElement("div");i.style.backgroundColor="white",i.style.padding="5px",i.style.marginBottom="-1px",i.style.borderBottom="1px solid black",s.append(i),this._navigator=document.createElement("span"),i.appendChild(this._navigator);const n=document.createElement("select");n.onchange=()=>{this._offset=0,this._pagesize=+n.value,this._renderPager()};for(const e of[10,50,100,500,1e3]){const t=document.createElement("option");t.value=e,t.innerText=e,n.append(t)}n.value=this._pagesize,i.appendChild(n);const a=document.createElement("button");a.innerHTML="&uarr;",a.onclick=()=>{window.scroll({top:0,behavior:"smooth"})},a.title="To top",a.style.margin="5px",a.style.borderRadius="50%",s.appendChild(a),this._table=document.createElement("table"),this._table.style.border="1px solid black",this._table.style.borderCollapse="collapse",t.append(s,this._table)}init(){this._predict=null}setPredict(e){"CF"===this._manager.platform.task&&this.datas.outputCategoryNames?e=e.map((e=>this.datas.outputCategoryNames[e-1])):"AD"===this._manager.platform.task&&(e=e.map((e=>e?"anomalous":""))),this._predict?(this._predict=e,this._renderData()):(this._predict=e,this.render())}render(){this._table.replaceChildren(),this._navigator.replaceChildren(),this._offset=0;const e=this.datas;if(!e)return;const t=e.columnNames;if(t){const s=document.createElement("thead"),i=document.createElement("tr");s.appendChild(i);const n=[];e.index&&n.push("index"),n.push(...t);const a=e.originalY;a&&a.length>0&&n.push("target"),this._predict&&n.push("predict");for(const e of n){const t=document.createElement("td");t.innerText=e,t.style.border="1px solid black",i.appendChild(t)}this._table.appendChild(s)}const s=document.createElement("tbody");this._table.appendChild(s),this._renderPager()}_renderPager(){this._navigator.replaceChildren(),this._renderData();const e=this.datas;if(!e)return;const t=Math.ceil(e.length/this._pagesize),s=Math.floor(this._offset/this._pagesize)+1;if(s>1){const e=document.createElement("input");e.type="button",e.value="<",e.onclick=()=>{this._offset=Math.max(0,this._offset-this._pagesize),this._renderPager()},this._navigator.appendChild(e)}const i=document.createElement("input");i.type="button",i.value="1",i.onclick=()=>{this._offset=0,this._renderPager()},1===s&&(i.disabled=!0),this._navigator.appendChild(i),s>3&&this._navigator.append(" ... ");for(let e=Math.max(2,s-1);e<=Math.min(t-1,s+1);e++){const t=document.createElement("input");t.type="button",t.value=e,t.onclick=()=>{this._offset=this._pagesize*(e-1),this._renderPager()},e===s&&(t.disabled=!0),this._navigator.appendChild(t)}if(s<t-2&&this._navigator.append(" ... "),t>1){const e=document.createElement("input");e.type="button",e.value=t,e.onclick=()=>{this._offset=this._pagesize*(t-1),this._renderPager()},s===t&&(e.disabled=!0),this._navigator.appendChild(e)}if(s<t){const t=document.createElement("input");t.type="button",t.value=">",t.onclick=()=>{this._offset=Math.min(e.length-1,this._offset+this._pagesize),this._renderPager()},this._navigator.appendChild(t)}this._navigator.append(` (${this._offset+1} - ${Math.min(this._offset+this._pagesize,e.length)} / ${e.length}) `)}_renderData(){const e=this._table.querySelector("tbody");e.replaceChildren();const t=this.datas;if(!t)return;const s=t.originalX,i="RG"===this._manager.platform.task?t.y:t.originalY,n=t.index;for(let a=this._offset;a<Math.min(t.length,this._offset+this._pagesize);a++){const t=document.createElement("tr"),r=[];n&&r.push(n[a]),s[a]&&r.push(...s[a]),i&&i.length>0&&r.push(i[a]),this._predict&&r.push(this._predict[a]);for(const e of r){const s=document.createElement("td");s.innerText=e,s.style.border="1px solid black",t.appendChild(s)}e.appendChild(t)}}terminate(){this.setting.render.removeItem("table"),super.terminate()}}