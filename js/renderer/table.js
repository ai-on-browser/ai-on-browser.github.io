import BaseRenderer from"./base.js";export default class TableRenderer extends BaseRenderer{constructor(t){super(t),this._offset=0,this._pagesize=100,this._predict=null;const e=this.setting.render.addItem("table"),s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.position="sticky",s.style.top="0";const i=document.createElement("div");i.style.backgroundColor="white",i.style.padding="5px",i.style.marginBottom="-1px",i.style.borderBottom="1px solid black",s.append(i),this._navigator=document.createElement("span"),i.appendChild(this._navigator);const a=document.createElement("select");a.onchange=()=>{this._offset=0,this._pagesize=+a.value,this._renderPager()};for(const t of[10,50,100,500,1e3]){const e=document.createElement("option");e.value=t,e.innerText=t,a.append(e)}a.value=this._pagesize,i.appendChild(a);const n=document.createElement("button");n.innerHTML="&uarr;",n.onclick=()=>{window.scroll({top:0,behavior:"smooth"})},n.title="To top",n.style.margin="5px",n.style.borderRadius="50%",s.appendChild(n),this._table=document.createElement("table"),this._table.style.border="1px solid black",this._table.style.borderCollapse="collapse",e.append(s,this._table)}set trainResult(t){"CF"===this._manager.platform.task&&this.datas.outputCategoryNames?t=t.map((t=>this.datas.outputCategoryNames[t-1])):"AD"===this._manager.platform.task&&(t=t.map((t=>t?"anomalous":""))),this._predict?(this._predict=t,this._renderData()):(this._predict=t,this.render())}init(){this._predict=null}render(){this._table.replaceChildren(),this._navigator.replaceChildren(),this._offset=0;const t=this.datas;if(!t)return;const e=t.columnNames;if(e){const s=this._table.createTHead().insertRow(),i=[];t.index&&i.push("index"),i.push(...e);const a=t.originalY;a&&a.length>0&&i.push("target"),this._predict&&i.push("predict");for(const t of i){const e=s.insertCell();e.innerText=t,e.style.border="1px solid black"}}this._table.createTBody(),this._renderPager()}_renderPager(){this._navigator.replaceChildren(),this._renderData();const t=this.datas;if(!t)return;const e=Math.ceil(t.length/this._pagesize),s=Math.floor(this._offset/this._pagesize)+1;if(s>1){const t=document.createElement("input");t.type="button",t.value="<",t.onclick=()=>{this._offset=Math.max(0,this._offset-this._pagesize),this._renderPager()},this._navigator.appendChild(t)}const i=document.createElement("input");i.type="button",i.value="1",i.onclick=()=>{this._offset=0,this._renderPager()},1===s&&(i.disabled=!0),this._navigator.appendChild(i),s>3&&this._navigator.append(" ... ");for(let t=Math.max(2,s-1);t<=Math.min(e-1,s+1);t++){const e=document.createElement("input");e.type="button",e.value=t,e.onclick=()=>{this._offset=this._pagesize*(t-1),this._renderPager()},t===s&&(e.disabled=!0),this._navigator.appendChild(e)}if(s<e-2&&this._navigator.append(" ... "),e>1){const t=document.createElement("input");t.type="button",t.value=e,t.onclick=()=>{this._offset=this._pagesize*(e-1),this._renderPager()},s===e&&(t.disabled=!0),this._navigator.appendChild(t)}if(s<e){const e=document.createElement("input");e.type="button",e.value=">",e.onclick=()=>{this._offset=Math.min(t.length-1,this._offset+this._pagesize),this._renderPager()},this._navigator.appendChild(e)}this._navigator.append(` (${this._offset+1} - ${Math.min(this._offset+this._pagesize,t.length)} / ${t.length}) `)}_renderData(){const t=this._table.tBodies[0];t.replaceChildren();const e=this.datas;if(!e)return;const s=e.originalX,i="RG"===this._manager.platform.task?e.y:e.originalY,a=e.index;for(let n=this._offset;n<Math.min(e.length,this._offset+this._pagesize);n++){const e=t.insertRow(),r=[];a&&r.push(a[n]),s[n]&&r.push(...s[n]),i&&i.length>0&&r.push(i[n]),this._predict&&r.push(this._predict[n]);for(const t of r){const s=e.insertCell();s.innerText=t,s.style.border="1px solid black"}}}terminate(){this.setting.render.removeItem("table"),super.terminate()}}