import BaseRenderer from"./base.js";export default class ImageRenderer extends BaseRenderer{constructor(t){super(t),this._size=[0,0];const e=this.setting.render.addItem("image");this._root=document.createElement("div"),e.appendChild(this._root),this._root.style.position="relative",this._root.style.border="1px solid black"}get width(){return this._size[0]}set width(t){this._size[0]=t,this._root.style.width=`${t}px`}get height(){return this._size[1]}set height(t){this._size[1]=t,this._root.style.height=`${t}px`}init(){this._root.replaceChildren()}render(){if(this._root.querySelector("canvas.base-img")?.remove(),!(this.datas&&this.datas.x&&Array.isArray(this.datas.x[0])&&Array.isArray(this.datas.x[0][0])))return;const t=this.datas.x[0],e=this.datas._applySpace(t,this._manager.platform._color_space,this._manager.platform._normalize,this._manager.platform._binary_threshold),a=e[0][0].length,i=document.createElement("canvas");i.classList.add("base-img"),i.style.position="absolute",i.width=t[0].length,i.height=t.length;const s=i.getContext("2d"),r=s.createImageData(i.width,i.height);for(let t=0,s=0;t<i.height;t++)for(let h=0;h<i.width;h++,s+=4)r.data[s]=e[t][h][0],1===a?(r.data[s+1]=e[t][h][0],r.data[s+2]=e[t][h][0],r.data[s+3]=255):3===a?(r.data[s+1]=e[t][h][1],r.data[s+2]=e[t][h][2],r.data[s+3]=255):(r.data[s+1]=e[t][h][1],r.data[s+2]=e[t][h][2],r.data[s+3]=e[t][h][3]);s.putImageData(r,0,0),this._root.firstChild?this._root.insertBefore(i,this._root.firstChild):this._root.appendChild(i),this.width=i.width,this.height=i.height}terminate(){this.setting.render.removeItem("image"),super.terminate()}}