var f=Object.defineProperty;var b=(_,t)=>f(_,"name",{value:t,configurable:!0});export default class y{static{b(this,"GridMazeRenderer")}constructor(t){this.renderer=t,this._init_menu()}_init_menu(){const t=this.renderer.setting.rl.configElement;t.replaceChildren(),t.appendChild(document.createTextNode("Columns "));const r=document.createElement("input");r.type="number",r.min=1,r.max=50,r.value=this.renderer.env._size[0],r.onchange=()=>{this.renderer.env._size[0]=+r.value,this.renderer.platform.init(),this.renderer.setting.ml.refresh()},t.appendChild(r),t.appendChild(document.createTextNode(" Rows "));const i=document.createElement("input");i.type="number",i.min=1,i.max=50,i.value=this.renderer.env._size[1],i.onchange=()=>{this.renderer.env._size[1]=+i.value,this.renderer.platform.init(),this.renderer.setting.ml.refresh()},t.appendChild(i);const s=document.createElement("input");s.type="button",s.value="Maze",s.onclick=()=>{this.renderer.env.resetMapAsMaze(),this.renderer.render()},t.appendChild(s);const n=document.createElement("input");n.type="button",n.value="Clear",n.onclick=()=>{this.renderer.env.resetMap(),this.renderer.render()},t.appendChild(n)}init(t){const s=document.createElement("div");s.onclick=n=>{const o=d3.pointer(n),l=this.renderer.env._size[0]/960,e=this.renderer.env._size[1]/500,c=Math.floor(o[0]*l),d=Math.floor(o[1]*e);this.renderer.env._points.push([c,d]),n.stopPropagation(),setTimeout(()=>{this.renderer.render()},0)},t.appendChild(s),this._envrenderer=new x(this.renderer.env,{width:960,height:500,g:s}),this._envrenderer.init()}render(t,r){this._envrenderer.render(r)}}const A=b(function(_,t){return _.length===0?-1:(_=t?_.map(t):_,_.indexOf(Math.max(..._)))},"argmax");class x{static{b(this,"Renderer")}constructor(t,r={}){this.env=t,this._size=[r.width||200,r.height||200],this._points=[],this._q=null,this._show_max=!1,this._render_blocks=[],this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this._size[0]),this.svg.setAttribute("height",this._size[1]),this.svg.setAttribute("viewbox","0 0 200 200"),r.g&&r.g.replaceChildren(this.svg)}get _action_str(){return this._dim===1?["\u2192","\u2190"]:["\u2192","\u2193","\u2190","\u2191"]}init(){const t=this._size[0],r=this._size[1],i=t/this.env._size[0],s=r/this.env._size[1];this._render_blocks=[];for(let o=0;o<this.env._size[0];o++){this._render_blocks[o]=[];for(let l=0;l<this.env._size[1];l++){const e=this._render_blocks[o][l]=document.createElementNS("http://www.w3.org/2000/svg","g");if(e.classList.add("grid"),e.setAttribute("stroke-width",1),e.setAttribute("stroke","black"),e.setAttribute("stroke-opacity",.2),this.svg.appendChild(e),this._show_max){const d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("x",i*o),d.setAttribute("y",i*l),d.setAttribute("width",i),d.setAttribute("height",s),d.setAttribute("fill","white"),e.appendChild(d);const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.classList.add("value"),a.setAttribute("x",i*o),a.setAttribute("y",s*(l+.8)),a.setAttribute("font-size",14),a.setAttribute("user-select","none"),e.appendChild(a)}else{const d=[i*(o+.5),s*(l+.5)],a=[[i*(o+1),s*l],[i*(o+1),s*(l+1)],[i*o,s*(l+1)],[i*o,s*l]];a[4]=a[0];for(let h=0;h<4;h++){const m=document.createElementNS("http://www.w3.org/2000/svg","polygon");m.setAttribute("points",`${a[h][0]},${a[h][1]} ${a[h+1][0]},${a[h+1][1]} ${d[0]},${d[1]}`),m.setAttribute("fill","white"),e.appendChild(m);const u=document.createElementNS("http://www.w3.org/2000/svg","title");m.appendChild(u)}}const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.classList.add("action"),c.setAttribute("x",i*(o+.5)),c.setAttribute("y",s*(l+.5)),c.style.userSelect="none",c.style.transformBox="fill-box",c.style.transform="translate(-50%, 25%)",e.appendChild(c)}}const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.classList.add("agent"),n.setAttribute("cx",.5*i),n.setAttribute("cy",.5*s),n.setAttribute("fill","gray"),n.setAttribute("fill-opacity",.8),n.setAttribute("stroke-width",1),n.setAttribute("stroke","black"),n.setAttribute("r",Math.min(i,s)/3),this.svg.appendChild(n)}_min(t){return Array.isArray(t[0])?Math.min(...t.map(this._min.bind(this))):Math.min(...t)}_max(t){return Array.isArray(t[0])?Math.max(...t.map(this._max.bind(this))):Math.max(...t)}render(t){const r=this._size[0],i=this._size[1],s=r/this.env._size[0],n=i/this.env._size[1],o=this.env.map;if(t&&(this._q=t()),this._q){const e=this._q,c=this._max(e),d=this._min(e),a=Math.max(Math.abs(c),Math.abs(d));for(let h=0;h<this.env._size[0];h++){if(!this._q[h])continue;const m=this.env._dim===2?e[h]:[e[h]];for(let u=0;u<this.env._size[1];u++){if(!m[u]||o[h][u]||h===this.env._size[0]-1&&u===this.env._size[1]-1)continue;const w=A(m[u]),v=b(g=>{const p=255*(1-Math.abs(g)/a);return g>0?`rgb(${p}, 255, ${p})`:g<0?`rgb(255, ${p}, ${p})`:"white"},"getColor");if(this._render_blocks[h][u].querySelector("text.action").replaceChildren(this._action_str[w]),this._show_max){const g=Math.max(...m[u]);this._render_blocks[h][u].querySelector("rect").setAttribute("fill",v(g)),this._render_blocks[h][u].querySelector("text.value").replaceChildren(`${g}`.slice(0,6))}else{const g=this._render_blocks[h][u].querySelectorAll("polygon");for(let p=0;p<g.length;p++)g[p].setAttribute("fill",v(m[u][p])),g[p].querySelector("title").replaceChildren(m[u][p])}}}}else for(const e of this.svg.querySelectorAll("g.grid rect, g.grid polygon"))e.setAttribute("fill","white");for(let e=0;e<this.env._size[0];e++)for(let c=0;c<this.env._size[1];c++)if(o[e][c])for(const d of this._render_blocks[e][c].querySelectorAll("rect, polygon"))d.setAttribute("fill","black");for(const e of this._render_blocks[this.env._size[0]-1][this.env._size[1]-1].querySelectorAll("rect, polygon"))e.setAttribute("fill","yellow");const l=this.svg.querySelector("circle.agent");l.setAttribute("cx",(this.env._position[0]+.5)*s),l.setAttribute("cy",((this.env._position[1]||0)+.5)*n)}}
