var f=Object.defineProperty;var b=(_,e)=>f(_,"name",{value:e,configurable:!0});export default class y{static{b(this,"GridMazeRenderer")}constructor(e){this.renderer=e,this._init_menu()}_init_menu(){const e=this.renderer.setting.rl.configElement;e.replaceChildren(),e.appendChild(document.createTextNode("Columns "));const i=document.createElement("input");i.type="number",i.min=1,i.max=50,i.value=this.renderer.env._size[0],i.onchange=()=>{this.renderer.env._size[0]=+i.value,this.renderer.platform.init(),this.renderer.setting.ml.refresh()},e.appendChild(i),e.appendChild(document.createTextNode(" Rows "));const t=document.createElement("input");t.type="number",t.min=1,t.max=50,t.value=this.renderer.env._size[1],t.onchange=()=>{this.renderer.env._size[1]=+t.value,this.renderer.platform.init(),this.renderer.setting.ml.refresh()},e.appendChild(t);const r=document.createElement("input");r.type="button",r.value="Maze",r.onclick=()=>{this.renderer.env.resetMapAsMaze(),this.renderer.render()},e.appendChild(r);const n=document.createElement("input");n.type="button",n.value="Clear",n.onclick=()=>{this.renderer.env.resetMap(),this.renderer.render()},e.appendChild(n)}init(e){const i=this.renderer.width,t=this.renderer.height,r=document.createElement("div");r.onclick=n=>{const o=d3.pointer(n),l=this.renderer.env._size[0]/i,s=this.renderer.env._size[1]/t,c=Math.floor(o[0]*l),d=Math.floor(o[1]*s);this.renderer.env._points.push([c,d]),n.stopPropagation(),setTimeout(()=>{this.renderer.render()},0)},e.appendChild(r),this._envrenderer=new x(this.renderer.env,{width:i,height:t,g:r}),this._envrenderer.init()}render(e,i){this._envrenderer.render(i)}}const A=b(function(_,e){return _.length===0?-1:(_=e?_.map(e):_,_.indexOf(Math.max(..._)))},"argmax");class x{static{b(this,"Renderer")}constructor(e,i={}){this.env=e,this._size=[i.width||200,i.height||200],this._points=[],this._q=null,this._show_max=!1,this._render_blocks=[],this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this._size[0]),this.svg.setAttribute("height",this._size[1]),this.svg.setAttribute("viewbox","0 0 200 200"),i.g&&i.g.replaceChildren(this.svg)}get _action_str(){return this._dim===1?["\u2192","\u2190"]:["\u2192","\u2193","\u2190","\u2191"]}init(){const e=this._size[0],i=this._size[1],t=e/this.env._size[0],r=i/this.env._size[1];this._render_blocks=[];for(let o=0;o<this.env._size[0];o++){this._render_blocks[o]=[];for(let l=0;l<this.env._size[1];l++){const s=this._render_blocks[o][l]=document.createElementNS("http://www.w3.org/2000/svg","g");if(s.classList.add("grid"),s.setAttribute("stroke-width",1),s.setAttribute("stroke","black"),s.setAttribute("stroke-opacity",.2),this.svg.appendChild(s),this._show_max){const d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("x",t*o),d.setAttribute("y",t*l),d.setAttribute("width",t),d.setAttribute("height",r),d.setAttribute("fill","white"),s.appendChild(d);const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.classList.add("value"),a.setAttribute("x",t*o),a.setAttribute("y",r*(l+.8)),a.setAttribute("font-size",14),a.setAttribute("user-select","none"),s.appendChild(a)}else{const d=[t*(o+.5),r*(l+.5)],a=[[t*(o+1),r*l],[t*(o+1),r*(l+1)],[t*o,r*(l+1)],[t*o,r*l]];a[4]=a[0];for(let h=0;h<4;h++){const m=document.createElementNS("http://www.w3.org/2000/svg","polygon");m.setAttribute("points",`${a[h][0]},${a[h][1]} ${a[h+1][0]},${a[h+1][1]} ${d[0]},${d[1]}`),m.setAttribute("fill","white"),s.appendChild(m);const u=document.createElementNS("http://www.w3.org/2000/svg","title");m.appendChild(u)}}const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.classList.add("action"),c.setAttribute("x",t*(o+.5)),c.setAttribute("y",r*(l+.5)),c.style.userSelect="none",c.style.transformBox="fill-box",c.style.transform="translate(-50%, 25%)",s.appendChild(c)}}const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.classList.add("agent"),n.setAttribute("cx",.5*t),n.setAttribute("cy",.5*r),n.setAttribute("fill","gray"),n.setAttribute("fill-opacity",.8),n.setAttribute("stroke-width",1),n.setAttribute("stroke","black"),n.setAttribute("r",Math.min(t,r)/3),this.svg.appendChild(n)}_min(e){return Array.isArray(e[0])?Math.min(...e.map(this._min.bind(this))):Math.min(...e)}_max(e){return Array.isArray(e[0])?Math.max(...e.map(this._max.bind(this))):Math.max(...e)}render(e){const i=this._size[0],t=this._size[1],r=i/this.env._size[0],n=t/this.env._size[1],o=this.env.map;if(e&&(this._q=e()),this._q){const s=this._q,c=this._max(s),d=this._min(s),a=Math.max(Math.abs(c),Math.abs(d));for(let h=0;h<this.env._size[0];h++){if(!this._q[h])continue;const m=this.env._dim===2?s[h]:[s[h]];for(let u=0;u<this.env._size[1];u++){if(!m[u]||o[h][u]||h===this.env._size[0]-1&&u===this.env._size[1]-1)continue;const w=A(m[u]),v=b(g=>{const p=255*(1-Math.abs(g)/a);return g>0?`rgb(${p}, 255, ${p})`:g<0?`rgb(255, ${p}, ${p})`:"white"},"getColor");if(this._render_blocks[h][u].querySelector("text.action").replaceChildren(this._action_str[w]),this._show_max){const g=Math.max(...m[u]);this._render_blocks[h][u].querySelector("rect").setAttribute("fill",v(g)),this._render_blocks[h][u].querySelector("text.value").replaceChildren(`${g}`.slice(0,6))}else{const g=this._render_blocks[h][u].querySelectorAll("polygon");for(let p=0;p<g.length;p++)g[p].setAttribute("fill",v(m[u][p])),g[p].querySelector("title").replaceChildren(m[u][p])}}}}else for(const s of this.svg.querySelectorAll("g.grid rect, g.grid polygon"))s.setAttribute("fill","white");for(let s=0;s<this.env._size[0];s++)for(let c=0;c<this.env._size[1];c++)if(o[s][c])for(const d of this._render_blocks[s][c].querySelectorAll("rect, polygon"))d.setAttribute("fill","black");for(const s of this._render_blocks[this.env._size[0]-1][this.env._size[1]-1].querySelectorAll("rect, polygon"))s.setAttribute("fill","yellow");const l=this.svg.querySelector("circle.agent");l.setAttribute("cx",(this.env._position[0]+.5)*r),l.setAttribute("cy",((this.env._position[1]||0)+.5)*n)}}
