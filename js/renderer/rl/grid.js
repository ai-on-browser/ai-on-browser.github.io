var f=Object.defineProperty;var v=(_,e)=>f(_,"name",{value:e,configurable:!0});export default class y{static{v(this,"GridMazeRenderer")}constructor(e){this.renderer=e,this._init_menu()}_init_menu(){const e=this.renderer.setting.rl.configElement;e.replaceChildren(),e.appendChild(document.createTextNode("Columns "));const c=document.createElement("input");c.type="number",c.min=1,c.max=50,c.value=this.renderer.env._size[0],c.onchange=()=>{this.renderer.env._size[0]=+c.value,this.renderer.platform.init(),this.renderer.setting.ml.refresh()},e.appendChild(c),e.appendChild(document.createTextNode(" Rows "));const i=document.createElement("input");i.type="number",i.min=1,i.max=50,i.value=this.renderer.env._size[1],i.onchange=()=>{this.renderer.env._size[1]=+i.value,this.renderer.platform.init(),this.renderer.setting.ml.refresh()},e.appendChild(i);const s=document.createElement("input");s.type="button",s.value="Maze",s.onclick=()=>{this.renderer.env.resetMapAsMaze(),this.renderer.render()},e.appendChild(s);const o=document.createElement("input");o.type="button",o.value="Clear",o.onclick=()=>{this.renderer.env.resetMap(),this.renderer.render()},e.appendChild(o)}init(e){const s=e.appendChild(document.createElement("div"));s.style.position="relative",this._envrenderer=new x(this.renderer.env,{width:960,height:500,g:s}),this._envrenderer.init();const o=s.appendChild(document.createElement("div")),l=960/this.renderer.env._size[0],d=500/this.renderer.env._size[1];for(let t=0;t<this.renderer.env._size[0];t++)for(let n=0;n<this.renderer.env._size[1];n++){const r=o.appendChild(document.createElement("div"));r.style.position="absolute",r.style.top=`${d*n}px`,r.style.left=`${l*t}px`,r.style.width=`${l}px`,r.style.height=`${d}px`,r.onclick=a=>{this.renderer.env._points.push([t,n]),a.stopPropagation(),setTimeout(()=>{this.renderer.render()},0)}}}render(e){this._envrenderer.render(e)}}const A=v(function(_,e){return _.length===0?-1:(_=e?_.map(e):_,_.indexOf(Math.max(..._)))},"argmax");class x{static{v(this,"Renderer")}constructor(e,c={}){this.env=e,this._size=[c.width||200,c.height||200],this._points=[],this._q=null,this._show_max=!1,this._render_blocks=[],this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this._size[0]),this.svg.setAttribute("height",this._size[1]),this.svg.setAttribute("viewbox","0 0 200 200"),c.g&&c.g.replaceChildren(this.svg)}get _action_str(){return this._dim===1?["\u2192","\u2190"]:["\u2192","\u2193","\u2190","\u2191"]}init(){const e=this._size[0],c=this._size[1],i=e/this.env._size[0],s=c/this.env._size[1];this._render_blocks=[];for(let l=0;l<this.env._size[0];l++){this._render_blocks[l]=[];for(let d=0;d<this.env._size[1];d++){const t=this._render_blocks[l][d]=document.createElementNS("http://www.w3.org/2000/svg","g");if(t.classList.add("grid"),t.setAttribute("stroke-width",1),t.setAttribute("stroke","black"),t.setAttribute("stroke-opacity",.2),this.svg.appendChild(t),this._show_max){const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",i*l),r.setAttribute("y",i*d),r.setAttribute("width",i),r.setAttribute("height",s),r.setAttribute("fill","white"),t.appendChild(r);const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.classList.add("value"),a.setAttribute("x",i*l),a.setAttribute("y",s*(d+.8)),a.setAttribute("font-size",14),a.setAttribute("user-select","none"),t.appendChild(a)}else{const r=[i*(l+.5),s*(d+.5)],a=[[i*(l+1),s*d],[i*(l+1),s*(d+1)],[i*l,s*(d+1)],[i*l,s*d]];a[4]=a[0];for(let h=0;h<4;h++){const m=document.createElementNS("http://www.w3.org/2000/svg","polygon");m.setAttribute("points",`${a[h][0]},${a[h][1]} ${a[h+1][0]},${a[h+1][1]} ${r[0]},${r[1]}`),m.setAttribute("fill","white"),t.appendChild(m);const u=document.createElementNS("http://www.w3.org/2000/svg","title");m.appendChild(u)}}const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.classList.add("action"),n.setAttribute("x",i*(l+.5)),n.setAttribute("y",s*(d+.5)),n.style.userSelect="none",n.style.transformBox="fill-box",n.style.transform="translate(-50%, 25%)",t.appendChild(n)}}const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.classList.add("agent"),o.setAttribute("cx",.5*i),o.setAttribute("cy",.5*s),o.setAttribute("fill","gray"),o.setAttribute("fill-opacity",.8),o.setAttribute("stroke-width",1),o.setAttribute("stroke","black"),o.setAttribute("r",Math.min(i,s)/3),this.svg.appendChild(o)}_min(e){return Array.isArray(e[0])?Math.min(...e.map(this._min.bind(this))):Math.min(...e)}_max(e){return Array.isArray(e[0])?Math.max(...e.map(this._max.bind(this))):Math.max(...e)}render(e){const c=this._size[0],i=this._size[1],s=c/this.env._size[0],o=i/this.env._size[1],l=this.env.map;if(e&&(this._q=e()),this._q){const t=this._q,n=this._max(t),r=this._min(t),a=Math.max(Math.abs(n),Math.abs(r));for(let h=0;h<this.env._size[0];h++){if(!this._q[h])continue;const m=this.env._dim===2?t[h]:[t[h]];for(let u=0;u<this.env._size[1];u++){if(!m[u]||l[h][u]||h===this.env._size[0]-1&&u===this.env._size[1]-1)continue;const w=A(m[u]),b=v(g=>{const p=255*(1-Math.abs(g)/a);return g>0?`rgb(${p}, 255, ${p})`:g<0?`rgb(255, ${p}, ${p})`:"white"},"getColor");if(this._render_blocks[h][u].querySelector("text.action").replaceChildren(this._action_str[w]),this._show_max){const g=Math.max(...m[u]);this._render_blocks[h][u].querySelector("rect").setAttribute("fill",b(g)),this._render_blocks[h][u].querySelector("text.value").replaceChildren(`${g}`.slice(0,6))}else{const g=this._render_blocks[h][u].querySelectorAll("polygon");for(let p=0;p<g.length;p++)g[p].setAttribute("fill",b(m[u][p])),g[p].querySelector("title").replaceChildren(m[u][p])}}}}else for(const t of this.svg.querySelectorAll("g.grid rect, g.grid polygon"))t.setAttribute("fill","white");for(let t=0;t<this.env._size[0];t++)for(let n=0;n<this.env._size[1];n++)if(l[t][n])for(const r of this._render_blocks[t][n].querySelectorAll("rect, polygon"))r.setAttribute("fill","black");for(const t of this._render_blocks[this.env._size[0]-1][this.env._size[1]-1].querySelectorAll("rect, polygon"))t.setAttribute("fill","yellow");const d=this.svg.querySelector("circle.agent");d.setAttribute("cx",(this.env._position[0]+.5)*s),d.setAttribute("cy",((this.env._position[1]||0)+.5)*o)}}
