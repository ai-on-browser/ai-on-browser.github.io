export default class WaterballRenderer{constructor(t){this.renderer=t,this._init_menu()}_init_menu(){const t=this.renderer.setting.rl.configElement;t.replaceChildren(),t.appendChild(document.createTextNode("Number of balls "));const e=document.createElement("input");e.type="number",e.min=1,e.max=100,e.value=this.renderer.env._max_size,e.onchange=()=>{this.renderer.env._max_size=+e.value},t.appendChild(e)}init(t){this._envrenderer=new Renderer(this.renderer.env,{g:t.node()}),this._envrenderer.init()}render(){this._envrenderer.render()}}class Renderer{constructor(t,e={}){this.env=t,this._ball_elms=[],this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.env._width),this.svg.setAttribute("height",this.env._height),e.g&&e.g.replaceChildren(this.svg)}init(){const t=document.createElementNS("http://www.w3.org/2000/svg","g");t.classList.add("agent"),t.setAttribute("transform",`translate(${this.env._agent_p.join(",")})`),this.svg.appendChild(t);let e=360/this.env._sensor_count;for(let s=0;s<this.env._sensor_count;s++){const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.classList.add(`sensor_${s}`),r.setAttribute("x1",0),r.setAttribute("x2",this.env._sensor_length),r.setAttribute("y1",0),r.setAttribute("y2",0),r.setAttribute("stroke","black"),r.setAttribute("stroke-width",1),r.setAttribute("transform",`rotate(${e*s})`),t.appendChild(r)}const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("cx",0),s.setAttribute("cy",0),s.setAttribute("fill","gray"),s.setAttribute("stroke-width",0),s.setAttribute("r",this.env._agent_radius),t.appendChild(s)}render(){if(this.env._balls.forEach(((t,e)=>{this._ball_elms[e]||(this._ball_elms[e]=document.createElementNS("http://www.w3.org/2000/svg","circle"),this._ball_elms[e].setAttribute("r",this.env._ball_radius),this._ball_elms[e].setAttribute("stroke","gray"),this._ball_elms[e].setAttribute("stroke-width",1),this.svg.appendChild(this._ball_elms[e])),this._ball_elms[e].setAttribute("cx",t.c[0]),this._ball_elms[e].setAttribute("cy",t.c[1]),this._ball_elms[e].setAttribute("fill","apple"===t.type?"#ff6060":"#60ff60")})),this.env._balls.length<this._ball_elms.length){for(let t=this.env._balls.length;t<this._ball_elms.length;t++)this._ball_elms[t].remove();this._ball_elms.length=this.env._balls.length}this.svg.querySelector(".agent").setAttribute("transform",`translate(${this.env._agent_p.join(",")})`);const t=this.env.state();for(let e=0;e<this.env._sensor_count;e++){const s=t[2+4*e],r=t[2+4*e+1],i=this.svg.querySelector(`.sensor_${e}`);i.setAttribute("x2",s),i.setAttribute("stroke","apple"===r?"#ffa0a0":"poison"===r?"#a0ffa0":"black")}}}