var u=Object.defineProperty;var d=(c,t)=>u(c,"name",{value:t,configurable:!0});import n from"../../../lib/rl/gomoku.js";import{Game as w}from"../../platform/game/base.js";export default class g{static{d(this,"GomokuRenderer")}constructor(t){this.renderer=t,this._game=new v(t.platform),this._org_width=t.width,this._org_height=t.height}init(t){this.renderer.width=500,this.renderer.height=500,this._envrenderer=new b(this.renderer.env,{width:this.renderer.width,height:this.renderer.height,g:t}),this._envrenderer.init()}render(){this._envrenderer.render()}game(...t){return t[0]||(t[0]=new l(this._envrenderer)),t[1]||(t[1]=new l(this._envrenderer)),t[0].turn=n.BLACK,t[1].turn=n.WHITE,this._game.players=t,this._game}close(){this.renderer.width=this._org_width,this.renderer.height=this._org_height}}class b{static{d(this,"Renderer")}constructor(t,r={}){this.env=t,this._size=[r.width||200,r.height||200],this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this._size[0]),this.svg.setAttribute("height",this._size[1]),this.svg.setAttribute("viewbox","0 0 200 200"),r.g&&r.g.replaceChildren(this.svg)}init(){const t=this._size[0],r=this._size[1],o=t/this.env._size[1],h=r/this.env._size[0];this._cells=[];for(let i=0;i<this.env._size[0];i++){this._cells[i]=[];for(let s=0;s<this.env._size[1];s++){this._cells[i][s]=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svg.appendChild(this._cells[i][s]);const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",s*o),e.setAttribute("y",i*h),e.setAttribute("width",o),e.setAttribute("height",h),e.setAttribute("fill","#eeddcc"),e.setAttribute("stroke","#333333"),e.setAttribute("stroke-width","1"),this._cells[i][s].appendChild(e)}}}render(){const t=this._size[0],r=this._size[1],o=t/this.env._size[1],h=r/this.env._size[0];for(let i=0;i<this._cells.length;i++)for(let s=0;s<this._cells[i].length;s++){if(this._cells[i][s].querySelector("circle")?.remove(),this.env._board.at([i,s])===n.EMPTY)continue;const e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",o*(s+.5)),e.setAttribute("cy",h*(i+.5)),e.setAttribute("r",Math.min(o,h)*.4),e.setAttribute("stroke","black"),e.setAttribute("stroke-width","1"),this.env._board.at([i,s])===n.WHITE?e.setAttribute("fill","white"):this.env._board.at([i,s])===n.BLACK&&e.setAttribute("fill","black"),this._cells[i][s].appendChild(e)}}}class v extends w{static{d(this,"Gomoku")}constructor(t){super(t),this._board=t.env._board,this.turns=[n.BLACK,n.WHITE]}_showResult(t){const r=this._board.winner;t.innerHTML=r===n.BLACK?"BLACK WIN":r===n.WHITE?"WHITE WIN":"DRAW"}}class l{static{d(this,"ManualPlayer")}constructor(t){this._turn=null,this._renderer=t,this._obj=null}set turn(t){this._turn=t}action(t){const r=this._renderer._size[0],o=this._renderer._size[1];this._obj=document.createElementNS("http://www.w3.org/2000/svg","g"),this._renderer.svg.appendChild(this._obj);const h=document.createElementNS("http://www.w3.org/2000/svg","rect");return h.setAttribute("x",0),h.setAttribute("y",0),h.setAttribute("width",r),h.setAttribute("height",o),h.setAttribute("opacity",0),this._obj.appendChild(h),new Promise(i=>{h.onclick=s=>{const e=d3.pointer(s),_=[Math.floor(e[1]/r*t.size[0]),Math.floor(e[0]/o*t.size[1])];this._obj.remove(),this._obj=null,i(_)}})}close(){this._obj?.remove()}}
