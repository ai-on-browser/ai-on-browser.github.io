var _=Object.defineProperty;var u=(l,e)=>_(l,"name",{value:e,configurable:!0});export default class o{static{u(this,"BlackjackRenderer")}constructor(e){this.renderer=e,this._game=new m(this.renderer.platform)}init(e){this._envrenderer=new c(this.renderer.env,{width:800,height:500,g:e}),this._envrenderer.init(),this._manualButton=this._game._makeButton(10,500*3/4+50,80,40,"Start",async()=>{this._manualButton.setAttribute("opacity",0),await this._game.start(),this._manualButton.setAttribute("opacity",null)}),this._envrenderer.svg.appendChild(this._manualButton)}render(){this._manualButton.style.display=this.renderer.platform._manager._modelname?"none":"block",this._envrenderer.render()}}class c{static{u(this,"Renderer")}constructor(e,s={}){this.env=e,this._size=[s.width||200,s.height||200];const i=[63,89];this._card_size=[this._size[1]/3*(i[0]/i[1]),this._size[1]/3],this._cart_size=[50,30],this._move_scale=50,this._pendulum_scale=400,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this._size[0]),this.svg.setAttribute("height",this._size[1]),this.svg.setAttribute("viewbox","0 0 200 200"),s.g&&s.g.replaceChildren(this.svg),this._cards_render=[]}init(){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",10),e.setAttribute("y",this._size[1]/4),e.setAttribute("dominant-baseline","middle"),e.innerHTML="Dealer",this.svg.appendChild(e),this._dealerSum=document.createElementNS("http://www.w3.org/2000/svg","text"),this._dealerSum.setAttribute("x",10),this._dealerSum.setAttribute("y",this._size[1]/4+20),this._dealerSum.setAttribute("dominant-baseline","middle"),this._dealerSum.innerHTML="",this.svg.appendChild(this._dealerSum);const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",10),s.setAttribute("y",3*this._size[1]/4),s.setAttribute("dominant-baseline","middle"),s.innerHTML="Player",this.svg.appendChild(s),this._playerSum=document.createElementNS("http://www.w3.org/2000/svg","text"),this._playerSum.setAttribute("x",10),this._playerSum.setAttribute("y",3*this._size[1]/4+20),this._playerSum.setAttribute("dominant-baseline","middle"),this._playerSum.innerHTML="",this.svg.appendChild(this._playerSum),this._cards_render.forEach(i=>i.remove()),this._cards_render=[]}render(){this._cards_render.forEach(t=>t.remove()),this._cards_render=[];const e=this._size[0],s=this._size[1],i=100;this._playerSum.innerHTML=this.env._sumhands(this.env._player_hands)[0],this.env._done?this._dealerSum.innerHTML=this.env._sumhands(this.env._dealer_hands)[0]:this._dealerSum.innerHTML="";for(let t=0;t<this.env._dealer_hands.length;t++){const n=this._renderCard(i+t*(this._card_size[0]+10),(s/2-this._card_size[1])/2,this.env._dealer_hands[t],t===0||this.env._done);this.svg.appendChild(n),this._cards_render.push(n)}let a=10;i+(this.env._player_hands.length+1)*(this._card_size[0]+a)>e&&(a=-this._card_size[0]/3);for(let t=0;t<this.env._player_hands.length;t++){const n=this._renderCard(i+t*(this._card_size[0]+a),(3*s/2-this._card_size[1])/2,this.env._player_hands[t]);this.svg.appendChild(n),this._cards_render.push(n)}}_renderCard(e,s,i,a=!0){const t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","rect");if(n.setAttribute("x",e),n.setAttribute("y",s),n.setAttribute("width",this._card_size[0]),n.setAttribute("height",this._card_size[1]),n.setAttribute("fill","white"),n.setAttribute("stroke","black"),n.setAttribute("rx",15),n.setAttribute("ry",15),t.appendChild(n),!a)return n.setAttribute("fill","gray"),t;const h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",e+this._card_size[0]/2),h.setAttribute("y",s+this._card_size[1]/4),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.style.fontSize=this._card_size[1]/2-20,h.style.userSelect="none",i.value===1?h.innerHTML="A":i.value===11?h.innerHTML="J":i.value===12?h.innerHTML="Q":i.value===13?h.innerHTML="K":h.innerHTML=i.value,t.appendChild(h);const r=document.createElementNS("http://www.w3.org/2000/svg","text");switch(r.setAttribute("x",e+this._card_size[0]/2),r.setAttribute("y",s+this._card_size[1]*3/4),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","middle"),r.style.fontSize=this._card_size[1]/2-20,r.style.userSelect="none",i.suit){case 0:r.innerHTML="&spades;";break;case 1:r.innerHTML="&diams;",h.setAttribute("fill","red"),r.setAttribute("fill","red");break;case 2:r.innerHTML="&hearts;",h.setAttribute("fill","red"),r.setAttribute("fill","red");break;case 3:r.innerHTML="&clubs;";break}return t.appendChild(r),t}}class m{static{u(this,"BlackjackGame")}constructor(e){this._platform=e,this._env=e.env,this._resultElm=null}async start(){for(this._env.reset(),this._platform.render(),this._resultElm?.remove();;){const e=await this.waitAction(),{done:s}=this._env.step([e]);if(this._platform.render(),s){const i=this._platform._renderer[0]._subrender._envrenderer.svg;this._resultElm=document.createElementNS("http://www.w3.org/2000/svg","g"),i.appendChild(this._resultElm);const a=i.clientHeight,t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x",150),t.setAttribute("y",a/2),t.setAttribute("width",100),t.setAttribute("height",40),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","middle"),t.style.fontSize="30";const n=this._env._sumhands(this._env._player_hands)[0],h=this._env._sumhands(this._env._dealer_hands)[0];n>21?t.innerHTML="You bust!":n===h?t.innerHTML="Draw":h>21||n>h?t.innerHTML="You win!":t.innerHTML="You lose!",this._resultElm.appendChild(t);break}await new Promise(i=>setTimeout(i,10))}}async waitAction(){const e=this._platform._renderer[0]._subrender._envrenderer.svg,s=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(s);const i=e.clientHeight,a=40;return new Promise(t=>{s.appendChild(this._makeButton(10,i*3/4+50,a,40,"Hit",()=>{s.remove(),t(1)})),s.appendChild(this._makeButton(10+a,i*3/4+50,a,40,"Stick",()=>{s.remove(),t(0)}))})}_makeButton(e,s,i,a,t,n){const h=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",e+i/2),r.setAttribute("y",s+a/2),r.setAttribute("width",i),r.setAttribute("height",a),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","middle"),r.innerHTML=t,r.style.userSelect="none",h.appendChild(r);const d=document.createElementNS("http://www.w3.org/2000/svg","rect");return d.setAttribute("x",e),d.setAttribute("y",s),d.setAttribute("width",i),d.setAttribute("height",a),d.setAttribute("fill-opacity",0),d.setAttribute("stroke","black"),d.onclick=n,h.appendChild(d),h}terminate(){this._resultElm?.remove()}}
