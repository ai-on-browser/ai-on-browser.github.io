var u=Object.defineProperty;var _=(l,t)=>u(l,"name",{value:t,configurable:!0});export default class o{static{_(this,"BlackjackRenderer")}constructor(t){this.renderer=t,this._game=new m(this.renderer.platform)}init(t){this._envrenderer=new c(this.renderer.env,{width:this.renderer.width,height:this.renderer.height,g:t}),this._envrenderer.init(),this._manualButton=this._game._makeButton(10,this.renderer.height*3/4+50,80,40,"Start",async()=>{this._manualButton.setAttribute("opacity",0),await this._game.start(),this._manualButton.setAttribute("opacity",null)}),this._envrenderer.svg.appendChild(this._manualButton)}render(){this._manualButton.style.display=this.renderer.platform._manager._modelname?"none":"block",this._envrenderer.render()}}class c{static{_(this,"Renderer")}constructor(t,e={}){this.env=t,this._size=[e.width||200,e.height||200];const s=[63,89];this._card_size=[this._size[1]/3*(s[0]/s[1]),this._size[1]/3],this._cart_size=[50,30],this._move_scale=50,this._pendulum_scale=400,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this._size[0]),this.svg.setAttribute("height",this._size[1]),this.svg.setAttribute("viewbox","0 0 200 200"),e.g&&e.g.replaceChildren(this.svg),this._cards_render=[]}init(){const t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x",10),t.setAttribute("y",this._size[1]/4),t.setAttribute("dominant-baseline","middle"),t.innerHTML="Dealer",this.svg.appendChild(t),this._dealerSum=document.createElementNS("http://www.w3.org/2000/svg","text"),this._dealerSum.setAttribute("x",10),this._dealerSum.setAttribute("y",this._size[1]/4+20),this._dealerSum.setAttribute("dominant-baseline","middle"),this._dealerSum.innerHTML="",this.svg.appendChild(this._dealerSum);const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",10),e.setAttribute("y",3*this._size[1]/4),e.setAttribute("dominant-baseline","middle"),e.innerHTML="Player",this.svg.appendChild(e),this._playerSum=document.createElementNS("http://www.w3.org/2000/svg","text"),this._playerSum.setAttribute("x",10),this._playerSum.setAttribute("y",3*this._size[1]/4+20),this._playerSum.setAttribute("dominant-baseline","middle"),this._playerSum.innerHTML="",this.svg.appendChild(this._playerSum),this._cards_render.forEach(s=>s.remove()),this._cards_render=[]}render(){this._cards_render.forEach(r=>r.remove()),this._cards_render=[];const t=this._size[0],e=this._size[1],s=100;this._playerSum.innerHTML=this.env._sumhands(this.env._player_hands)[0],this.env._done?this._dealerSum.innerHTML=this.env._sumhands(this.env._dealer_hands)[0]:this._dealerSum.innerHTML="";for(let r=0;r<this.env._dealer_hands.length;r++){const h=this._renderCard(s+r*(this._card_size[0]+10),(e/2-this._card_size[1])/2,this.env._dealer_hands[r],r===0||this.env._done);this.svg.appendChild(h),this._cards_render.push(h)}let i=10;s+(this.env._player_hands.length+1)*(this._card_size[0]+i)>t&&(i=-this._card_size[0]/3);for(let r=0;r<this.env._player_hands.length;r++){const h=this._renderCard(s+r*(this._card_size[0]+i),(3*e/2-this._card_size[1])/2,this.env._player_hands[r]);this.svg.appendChild(h),this._cards_render.push(h)}}_renderCard(t,e,s,i=!0){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),h=document.createElementNS("http://www.w3.org/2000/svg","rect");if(h.setAttribute("x",t),h.setAttribute("y",e),h.setAttribute("width",this._card_size[0]),h.setAttribute("height",this._card_size[1]),h.setAttribute("fill","white"),h.setAttribute("stroke","black"),h.setAttribute("rx",15),h.setAttribute("ry",15),r.appendChild(h),!i)return h.setAttribute("fill","gray"),r;const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",t+this._card_size[0]/2),a.setAttribute("y",e+this._card_size[1]/4),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","middle"),a.style.fontSize=this._card_size[1]/2-20,a.style.userSelect="none",s.value===1?a.innerHTML="A":s.value===11?a.innerHTML="J":s.value===12?a.innerHTML="Q":s.value===13?a.innerHTML="K":a.innerHTML=s.value,r.appendChild(a);const n=document.createElementNS("http://www.w3.org/2000/svg","text");switch(n.setAttribute("x",t+this._card_size[0]/2),n.setAttribute("y",e+this._card_size[1]*3/4),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.style.fontSize=this._card_size[1]/2-20,n.style.userSelect="none",s.suit){case 0:n.innerHTML="&spades;";break;case 1:n.innerHTML="&diams;",a.setAttribute("fill","red"),n.setAttribute("fill","red");break;case 2:n.innerHTML="&hearts;",a.setAttribute("fill","red"),n.setAttribute("fill","red");break;case 3:n.innerHTML="&clubs;";break}return r.appendChild(n),r}}class m{static{_(this,"BlackjackGame")}constructor(t){this._platform=t,this._env=t.env,this._resultElm=null}async start(){for(this._env.reset(),this._platform.render(),this._resultElm?.remove();;){const t=await this.waitAction(),{done:e}=this._env.step([t]);if(this._platform.render(),e){const s=this._platform._renderer[0]._subrender._envrenderer.svg;this._resultElm=document.createElementNS("http://www.w3.org/2000/svg","g"),s.appendChild(this._resultElm);const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",150),i.setAttribute("y",this._platform._renderer[0].height/2),i.setAttribute("width",100),i.setAttribute("height",40),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","middle"),i.style.fontSize="30";const r=this._env._sumhands(this._env._player_hands)[0],h=this._env._sumhands(this._env._dealer_hands)[0];r>21?i.innerHTML="You bust!":r===h?i.innerHTML="Draw":h>21||r>h?i.innerHTML="You win!":i.innerHTML="You lose!",this._resultElm.appendChild(i);break}await new Promise(s=>setTimeout(s,10))}}async waitAction(){const t=this._platform._renderer[0]._subrender._envrenderer.svg,e=document.createElementNS("http://www.w3.org/2000/svg","g");t.appendChild(e);const s=40;return new Promise(i=>{e.appendChild(this._makeButton(10,this._platform._renderer[0].height*3/4+50,s,40,"Hit",()=>{e.remove(),i(1)})),e.appendChild(this._makeButton(10+s,this._platform._renderer[0].height*3/4+50,s,40,"Stick",()=>{e.remove(),i(0)}))})}_makeButton(t,e,s,i,r,h){const a=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",t+s/2),n.setAttribute("y",e+i/2),n.setAttribute("width",s),n.setAttribute("height",i),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.innerHTML=r,n.style.userSelect="none",a.appendChild(n);const d=document.createElementNS("http://www.w3.org/2000/svg","rect");return d.setAttribute("x",t),d.setAttribute("y",e),d.setAttribute("width",s),d.setAttribute("height",i),d.setAttribute("fill-opacity",0),d.setAttribute("stroke","black"),d.onclick=h,a.appendChild(d),a}terminate(){this._resultElm?.remove()}}
