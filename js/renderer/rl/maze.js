export default class SmoothMazeRenderer{constructor(t){this.renderer=t,this._width=t.width,this._height=t.height,this._render_blocks=[];for(let t=0;t<this.renderer.env._map_resolution[0];t++)this._render_blocks[t]=Array(this.renderer.env._map_resolution[1])}init(t){this._envrenderer=new Renderer(this.renderer.env,{g:t.node()}),this._envrenderer.init(),t.append("rect").attr("x",0).attr("y",0).attr("width",this._width).attr("height",this._height).attr("opacity",0).on("click",(t=>{const e=d3.pointer(t),i=this._width/this.renderer.env._map_resolution[0],s=this._height/this.renderer.env._map_resolution[1],r=Math.floor(e[0]/i),h=Math.floor(e[1]/s);this.renderer.env._points.push([r,h]),t.stopPropagation(),setTimeout((()=>{this.renderer.platform.render()}),0)}))}render(){this._envrenderer.render()}}class Renderer{constructor(t,e={}){this.env=t,this._render_blocks=[];for(let t=0;t<this.env._map_resolution[0];t++)this._render_blocks[t]=Array(this.env._map_resolution[1]);this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.env._width),this.svg.setAttribute("height",this.env._height),e.g&&e.g.replaceChildren(this.svg)}init(){const t=this.env._width/this.env._map_resolution[0],e=this.env._height/this.env._map_resolution[1],i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x",this.env._width-this.env._goal_size[0]),i.setAttribute("y",this.env._height-this.env._goal_size[1]),i.setAttribute("width",this.env._goal_size[0]),i.setAttribute("height",this.env._goal_size[1]),i.setAttribute("stroke-width",1),i.setAttribute("stroke","black"),i.setAttribute("fill","yellow"),this.svg.appendChild(i);const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.classList.add("agent"),s.setAttribute("cx",this.env._position[0]),s.setAttribute("cy",this.env._position[1]),s.setAttribute("fill","gray"),s.setAttribute("fill-opacity",.8),s.setAttribute("stroke-width",1),s.setAttribute("stroke","black"),s.setAttribute("r",2*Math.min(t,e)/3),this.svg.appendChild(s),this._blocks=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svg.appendChild(this._blocks)}render(){const t=this.env._width/this.env._map_resolution[0],e=this.env._height/this.env._map_resolution[1],i=this.env.map;for(let s=0;s<i.length;s++)for(let r=0;r<i[s].length;r++)i[s][r]&&!this._render_blocks[s][r]?(this._render_blocks[s][r]=document.createElementNS("http://www.w3.org/2000/svg","rect"),this._render_blocks[s][r].classList.add("grid"),this._render_blocks[s][r].setAttribute("x",t*s),this._render_blocks[s][r].setAttribute("y",e*r),this._render_blocks[s][r].setAttribute("width",t),this._render_blocks[s][r].setAttribute("height",e),this._render_blocks[s][r].setAttribute("fill","black"),this._blocks.appendChild(this._render_blocks[s][r])):!i[s][r]&&this._render_blocks[s][r]&&(this._render_blocks[s][r].remove(),this._render_blocks[s][r]=null);const s=this.svg.querySelector("circle.agent");s.setAttribute("cx",this.env._position[0]),s.setAttribute("cy",this.env._position[1])}}