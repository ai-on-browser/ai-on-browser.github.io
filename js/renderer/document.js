import BaseRenderer from"./base.js";export default class DocumentScatterRenderer extends BaseRenderer{constructor(t){super(t),this._size=[960,500];const e=this.setting.render.addItem("document-scatter"),s=document.createElement("div");if(s.id="plot-area",e.appendChild(s),this._root=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._root.style.border="1px solid #000000",this._root.setAttribute("width",`${this._size[0]}px`),this._root.setAttribute("height",`${this._size[1]}px`),s.appendChild(this._root),this._svg=document.createElementNS("http://www.w3.org/2000/svg","g"),this._root.appendChild(this._svg),this._r=this._svg.querySelector("g.points g.datas"),!this._r){const t=document.createElementNS("http://www.w3.org/2000/svg","g");t.classList.add("points"),this._svg.appendChild(t),this._r=document.createElementNS("http://www.w3.org/2000/svg","g"),this._r.classList.add("datas"),t.appendChild(this._r)}}get svg(){return this._svg}get width(){return this._size[0]}set width(t){this._size[0]=t,this._root.setAttribute("width",`${t}px`)}get height(){return this._size[1]}set height(t){this._size[1]=t,this._root.setAttribute("height",`${t}px`)}set trainResult(t){this._pred=t,this._displayResults(t,this.trainInput)}init(){this._lastpred=null,this._r_tile?.remove()}_render(){}testData(){const t=this.datas.x[0],[e,s]=this.datas.ordinal(t);return e}testResult(t){this._pred=t,this._displayResults(t,this.testData())}_displayResults(t,e){this._r.replaceChildren();let s=[],i=[];for(let e=0;e<t[0].length;e++){const r=t.map((t=>t[e]));s.push(Math.max(...r)),i.push(Math.min(...r))}const r=[this.width,this.height-20],h=r.map(((t,e)=>(t-10)/(s[e]-i[e]))),n=Math.min(...h),a=[5,20];for(let t=0;t<h.length;t++)h[t]>n&&(isFinite(h[t])?a[t]+=(h[t]-n)*(s[t]-i[t])/2:a[t]=r[t]/2-i[t]);for(let s=0;s<t.length;s++){const h=t[s].map(((t,e)=>{const s=(t-i[e])*n+a[e];return isFinite(s)?s:r[e]/2})),d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",h[0]),d.setAttribute("y",h[1]??r[1]/2),d.innerHTML=e[s];const o=document.createElementNS("http://www.w3.org/2000/svg","title");o.innerHTML=e[s],d.appendChild(o),this._r.appendChild(d)}}terminate(){this.setting.render.removeItem("document-scatter"),super.terminate()}}