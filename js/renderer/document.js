var v=Object.defineProperty;var m=(c,e)=>v(c,"name",{value:e,configurable:!0});import f from"./base.js";import y from"../data/loader/document.js";export default class C extends f{static{m(this,"DocumentScatterRenderer")}constructor(e){super(e),this._size=[960,500];const h=this.setting.render.addItem("document-scatter"),i=document.createElement("div");if(i.id="plot-area",h.appendChild(i),this._root=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._root.style.border="1px solid #000000",this._root.setAttribute("width",`${this._size[0]}px`),this._root.setAttribute("height",`${this._size[1]}px`),i.appendChild(this._root),this._svg=document.createElementNS("http://www.w3.org/2000/svg","g"),this._root.appendChild(this._svg),this._r=this._svg.querySelector("g.points g.datas"),!this._r){const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.classList.add("points"),this._svg.appendChild(s),this._r=document.createElementNS("http://www.w3.org/2000/svg","g"),this._r.classList.add("datas"),s.appendChild(this._r)}}get svg(){return this._svg}get width(){return this._size[0]}set width(e){this._size[0]=e,this._root.setAttribute("width",`${e}px`)}get height(){return this._size[1]}set height(e){this._size[1]=e,this._root.setAttribute("height",`${e}px`)}set trainResult(e){this._pred=e,this._displayResults(e,this.trainInput)}init(){this._lastpred=null,this._r_tile?.remove()}_render(){}testData(){const e=this.datas.x[0],[h,i]=y.ordinal(e);return h}testResult(e){this._pred=e,this._displayResults(e,this.testData())}_displayResults(e,h){this._r.replaceChildren();let i=[],s=[];for(let t=0;t<e[0].length;t++){const r=e.map(n=>n[t]);i.push(Math.max(...r)),s.push(Math.min(...r))}const u=this.width,w=this.height-20,d=[u,w],o=d.map((t,r)=>(t-10)/(i[r]-s[r])),a=Math.min(...o),p=[5,20];for(let t=0;t<o.length;t++)o[t]>a&&(isFinite(o[t])?p[t]+=(o[t]-a)*(i[t]-s[t])/2:p[t]=d[t]/2-s[t]);for(let t=0;t<e.length;t++){const r=e[t].map((x,l)=>{const _=(x-s[l])*a+p[l];return isFinite(_)?_:d[l]/2}),n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",r[0]),n.setAttribute("y",r[1]??d[1]/2),n.innerHTML=h[t];const g=document.createElementNS("http://www.w3.org/2000/svg","title");g.innerHTML=h[t],n.appendChild(g),this._r.appendChild(n)}}terminate(){this.setting.render.removeItem("document-scatter"),super.terminate()}}
