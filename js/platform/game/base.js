var c=Object.defineProperty;var m=(u,t)=>c(u,"name",{value:t,configurable:!0});const d=["manual","random","greedy","minmax","alphabeta"],h={};export default class p{static{m(this,"GameManager")}constructor(t){this._platform=t,this._game=null;const e=t.setting.task.configElement;this._r=document.createElement("div"),e.appendChild(this._r),this._r.appendChild(document.createTextNode("Play"));const i=[];for(let a=0;a<2;a++){const n=document.createElement("select");n.onchange=()=>{l.style.display=["minmax","alphabeta"].includes(n.value)?null:"none"};for(const _ of d){const o=document.createElement("option");o.value=_,o.innerText=_,n.appendChild(o)}n.value="greedy",this._r.appendChild(n);const l=document.createElement("input");l.type="number",l.min=1,l.max=10,l.value=5,l.style.display="none",this._r.appendChild(l),i.push({get name(){return n.value},get params(){return[l.value]}})}const s=document.createElement("input");s.type="button",s.value="Play",s.onclick=()=>{this._loadPlayer(i).then(a=>{this.start(a)})},this._r.appendChild(s);const r=document.createElement("input");r.type="button",r.value="Reset",r.onclick=()=>{this.reset()},this._r.appendChild(r)}_loadPlayer(t){return Promise.all(t.map(e=>e.name==="manual"?null:h[e.name]?new h[e.name](...e.params):import(`./${e.name}.js`).then(i=>(h[e.name]=i.default,new h[e.name](...e.params)))))}terminate(){this._r&&this._r.remove(),this._game&&this._game.close()}start(t){this._r.querySelectorAll("input[type=button]").forEach(e=>{e.disabled=!0}),this._game=this._platform._renderer[0]._subrender.game(...t),this._game.start().then(()=>{this._r.querySelectorAll("input[type=button]").forEach(e=>{e.disabled=!1})})}reset(){this._game&&(this._game.close(),this._game=null),this._platform.reset(),this._platform.render()}}export class Game{static{m(this,"Game")}constructor(t){this._players=[],this._platform=t,this._board=null,this._turn=null,this._active=!1,this._resultElm=null}get board(){return this._board}get active(){return this._active}set players(t){this._players=t}close(){this._players.forEach(t=>t.close()),this._resultElm&&(this._resultElm.remove(),this._resultElm=null)}_showResult(t){}async start(){for(this._resultElm&&(this._resultElm.remove(),this._resultElm=null),this._platform.render(),this._active=!0,this._turn=this.turns[0];!this._board.finish;){if(this._board.choices(this._turn).length>0){for(;;){const s=this.turns.indexOf(this._turn),r=await this._players[s].action(this._board);if(this._board.set(r,this._turn))break}this._platform.render(),await new Promise(s=>setTimeout(s,0))}this._turn=this._board.nextTurn(this._turn)}this._active=!1;const t=this._platform.svg.getBoundingClientRect().width,e=this._platform.svg.getBoundingClientRect().height;this._resultElm=document.createElement("div"),this._resultElm.onclick=()=>{this._resultElm.remove(),this._resultElm=null},this._resultElm.style.position="absolute",this._resultElm.style.margin="auto",this._resultElm.style.top="0",this._resultElm.style.left="0",this._resultElm.style.bottom="0",this._resultElm.style.right="0",this._resultElm.style.width=`${t/2}px`,this._resultElm.style.height=`${e/2}px`,this._resultElm.style.display="flex",this._resultElm.style.justifyContent="center",this._resultElm.style.alignItems="center",this._resultElm.style.opacity=.8,this._resultElm.style.background="white",this._resultElm.style.border="1px solid black",this._platform.svg.appendChild(this._resultElm);const i=document.createElement("div");this._resultElm.appendChild(i),this._showResult(i)}}
