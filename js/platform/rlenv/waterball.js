import WaterballRLEnvironment from"../../../lib/rl/waterball.js";export default class WaterballRenderer extends WaterballRLEnvironment{constructor(t){super(t.width,t.height),this.platform=t,this._ball_elms=[],this._init_menu()}_init_menu(){const t=this.platform.setting.rl.configElement;t.replaceChildren(),t.appendChild(document.createTextNode("Number of balls "));const e=document.createElement("input");e.type="number",e.min=1,e.max=100,e.value=this._max_size,e.onchange=()=>{this._max_size=+e.value},t.appendChild(e)}init(t){const e=t.append("g").classed("agent",!0).attr("transform",`translate(${this._agent_p.join(",")})`);let a=360/this._sensor_count;for(let t=0;t<this._sensor_count;t++)e.append("line").classed(`sensor_${t}`,!0).attr("x1",0).attr("x2",this._sensor_length).attr("y1",0).attr("y2",0).attr("stroke","black").attr("stroke-width",1).attr("transform",`rotate(${a*t})`);e.append("circle").attr("cx",0).attr("cy",0).attr("fill","gray").attr("stroke-width",0).attr("r",this._agent_radius)}render(t){if(this._balls.forEach(((e,a)=>{this._ball_elms[a]||(this._ball_elms[a]=t.append("circle").attr("r",this._ball_radius).attr("stroke","gray").attr("stroke-width",1)),this._ball_elms[a].attr("cx",e.c[0]).attr("cy",e.c[1]).attr("fill","apple"===e.type?"#ff6060":"#60ff60")})),this._balls.length<this._ball_elms.length){for(let t=this._balls.length;t<this._ball_elms.length;t++)this._ball_elms[t].remove();this._ball_elms.length=this._balls.length}t.select(".agent").attr("transform",`translate(${this._agent_p.join(",")})`);const e=this.state();for(let a=0;a<this._sensor_count;a++){const l=e[2+4*a],s=e[2+4*a+1];t.select(`.sensor_${a}`).attr("x2",l).attr("stroke","apple"===s?"#ffa0a0":"poison"===s?"#a0ffa0":"black")}}}