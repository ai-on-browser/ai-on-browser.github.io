import WaterballRLEnvironment from"../../../lib/rl/waterball.js";export default class WaterballRenderer extends WaterballRLEnvironment{constructor(t){super(t.width,t.height),this.platform=t,this._ball_elms=[],this._init_menu()}_init_menu(){const t=this.platform.setting.rl.configElement;t.selectAll("*").remove(),t.append("span").text("Number of balls "),t.append("input").attr("type","number").attr("name","max_size").attr("min",1).attr("max",100).attr("value",this._max_size).on("change",(()=>{this._max_size=+t.select("[name=max_size]").property("value")}))}init(t){const e=t.append("g").classed("agent",!0).attr("transform",`translate(${this._agent_p.join(",")})`);let a=360/this._sensor_count;for(let t=0;t<this._sensor_count;t++)e.append("line").classed(`sensor_${t}`,!0).attr("x1",0).attr("x2",this._sensor_length).attr("y1",0).attr("y2",0).attr("stroke","black").attr("stroke-width",1).attr("transform",`rotate(${a*t})`);e.append("circle").attr("cx",0).attr("cy",0).attr("fill",d3.rgb(128,128,128)).attr("stroke-width",0).attr("r",this._agent_radius)}render(t){if(this._balls.forEach(((e,a)=>{this._ball_elms[a]||(this._ball_elms[a]=t.append("circle").attr("r",this._ball_radius).attr("stroke","gray").attr("stroke-width",1)),this._ball_elms[a].attr("cx",e.c[0]).attr("cy",e.c[1]).attr("fill","apple"===e.type?d3.rgb(255,96,96):d3.rgb(96,255,96))})),this._balls.length<this._ball_elms.length){for(let t=this._balls.length;t<this._ball_elms.length;t++)this._ball_elms[t].remove();this._ball_elms.length=this._balls.length}t.select(".agent").attr("transform",`translate(${this._agent_p.join(",")})`);const e=this.state();for(let a=0;a<this._sensor_count;a++){const r=e[2+4*a],s=e[2+4*a+1];t.select(`.sensor_${a}`).attr("x2",r).attr("stroke","apple"===s?d3.rgb(255,160,160):"poison"===s?d3.rgb(160,255,160):"black")}}}