var o=Object.defineProperty;var r=(a,t)=>o(a,"name",{value:t,configurable:!0});import h from"../renderer/util/lineplot.js";import{DefaultPlatform as c}from"./base.js";export default class g extends c{static{r(this,"SemisupervisedPlatform")}constructor(t){super(t);const e=this.setting.task.configElement,i=document.createElement("div");i.innerText="Unlabeled data category is '0' (black).",e.appendChild(i),e.appendChild(document.createTextNode("Unlabeled Rate"));const s=document.createElement("input");s.type="number",s.min=0,s.max=1,s.step=.1,s.value=.9,s.name="unlabeled-rate",s.onchange=()=>{if(this.datas&&this._original_classes)for(let n=0;n<this._original_classes.length;n++)this.datas.y[n]=this._original_classes[n];this._original_classes=null,this.init()},e.appendChild(s)}get trainInput(){let t=this.datas.x;for(const e of this._manager.preprocesses)t=e.apply(t,{dofit:!0});return t}get trainOutput(){return this.datas.y.map(t=>[t])}set trainResult(t){this._renderer.forEach(e=>e.trainResult=t)}testInput(t=10){let e=this._renderer[0].testData(t);e.push(...this.datas.x);for(const i of this._manager.preprocesses)e=i.apply(e,{dofit:!1});return e}testResult(t){const e=t.slice(t.length-this.datas.length),i=this.datas.y;t=t.slice(0,t.length-this.datas.length);let s=0;for(let n=0;n<i.length;n++)i[n]===e[n]&&s++;this._getEvaluateElm().innerText=`Accuracy:${s/i.length}`,this._renderer[0].testResult(t)}init(){this.setting.footer.innerText="";const e=+this.setting.task.configElement.querySelector("[name=unlabeled-rate]").value;if(e>0&&!this._original_classes){this._original_classes=this.datas.y.concat();const i={};for(let s=0;s<this.datas.length;s++)i[this._original_classes[s]]||(i[this._original_classes[s]]=[]),i[this._original_classes[s]].push(s);for(const s of Object.keys(i)){let n=Math.floor(i[s].length*e);for(;n>0;){const l=Math.floor(Math.random()*i[s].length);this.datas.y[i[s][l]]=null,i[s].splice(l,1),n--}}}this._renderer.forEach(i=>i.init()),this.render(),this._loss&&(this._loss.terminate(),this._loss=null,this.setting.footer.replaceChildren())}_getEvaluateElm(){if(this._loss){const t=this.setting.footer.querySelector("div.evaluate_result");if(!t){const e=document.createElement("div");return e.classList.add("evaluate_result"),this.setting.footer.insertBefore(e,this.setting.footer.firstChild),e}return t}return this.setting.footer}plotLoss(t){if(!this._loss){const e=this.setting.footer.innerText;this.setting.footer.innerText="",this._loss=new h(this.setting.footer),this._getEvaluateElm().innerText=e}this._loss.add(t)}terminate(){if(this.datas&&this._original_classes)for(let t=0;t<this._original_classes.length;t++)this.datas.y[t]=this._original_classes[t];this.setting.task.configElement.replaceChildren(),this.setting.footer.innerText="",super.terminate()}}
