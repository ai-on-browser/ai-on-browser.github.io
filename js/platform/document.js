import{BasePlatform,LossPlotter}from"./base.js";export default class DocumentPlatform extends BasePlatform{constructor(t,s){super(t,s)}init(){0===this.svg.select("g.dc-render").size()&&this.svg.append("g").classed("dc-render",!0).style("transform","scale(1, -1) translate(0, -100%)"),this._r=this.svg.select("g.dc-render"),this._r.selectAll("*").remove(),this.render(),this._loss&&(this._loss.terminate(),this._loss=null)}get trainInput(){return this.datas.x[0].map((t=>t.toLowerCase()))}set trainResult(t){this._pred=t,this._displayResults(t,this.trainInput)}testInput(){const t=this.datas.x[0],[s,e]=this.datas.ordinal(t);return s}testResult(t){this._pred=t,this._displayResults(t,this.testInput())}render(){}_displayResults(t,s){this._r.selectAll("*").remove();let e=[],i=[];for(let s=0;s<t[0].length;s++){const r=t.map((t=>t[s]));e.push(Math.max(...r)),i.push(Math.min(...r))}const r=this.width,l=this.height-20,a=[r,l].map(((t,s)=>(t-10)/(e[s]-i[s]))),h=Math.min(...a),n=[5,20];for(let t=0;t<a.length;t++)a[t]>h&&(isFinite(a[t])?n[t]+=(a[t]-h)*(e[t]-i[t])/2:n[t]=[r,l][t]/2-i[t]);for(let e=0;e<t.length;e++){const r=t[e].map(((t,s)=>(t-i[s])*h+n[s]));this._r.append("text").attr("x",r[0]).attr("y",r[1]).text(s[e]).append("title").text(s[e])}}plotLoss(t){this._loss||(this._loss=new LossPlotter(this,this.setting.footer)),this._loss.add(t)}terminate(){this._r.remove(),this._loss&&this._loss.terminate(),super.terminate()}}