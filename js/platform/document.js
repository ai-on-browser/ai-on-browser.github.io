import{BasePlatform,LossPlotter}from"./base.js";export default class DocumentPlatform extends BasePlatform{constructor(t,s){super(t,s)}init(){0===this.svg.select("g.dc-render").size()&&this.svg.append("g").classed("dc-render",!0).style("transform","scale(1, -1) translate(0, -100%)"),this._r=this.svg.select("g.dc-render"),this._r.selectAll("*").remove();const t=this.svg.node();this.svg.selectAll("g:not(.dc-render)").filter((function(){return this.parentNode===t})).style("visibility","hidden"),this.render(),this._loss&&(this._loss.terminate(),this._loss=null)}get trainInput(){return this.datas.x[0].map((t=>t.toLowerCase()))}set trainResult(t){this._pred=t,this._displayResults(t,this.trainInput)}testInput(){const t=this.datas.x[0],[s,e]=this.datas.ordinal(t);return s}testResult(t){this._pred=t,this._displayResults(t,this.testInput())}render(){}_displayResults(t,s){this._r.selectAll("*").remove();let e=[],i=[];for(let s=0;s<t[0].length;s++){const l=t.map((t=>t[s]));e.push(Math.max(...l)),i.push(Math.min(...l))}const l=this.width,r=this.height-20,n=[l,r].map(((t,s)=>(t-10)/(e[s]-i[s]))),a=Math.min(...n),h=[5,20];for(let t=0;t<n.length;t++)n[t]>a&&(isFinite(n[t])?h[t]+=(n[t]-a)*(e[t]-i[t])/2:h[t]=[l,r][t]/2-i[t]);for(let e=0;e<t.length;e++){const l=t[e].map(((t,s)=>(t-i[s])*a+h[s]));this._r.append("text").attr("x",l[0]).attr("y",l[1]).text(s[e]).append("title").text(s[e])}}plotLoss(t){this._loss||(this._loss=new LossPlotter(this,this.setting.footer)),this._loss.add(t)}terminate(){this._r.remove(),this._loss&&this._loss.terminate(),this.svg.selectAll("g").style("visibility",null),super.terminate()}}