import{Matrix}from"../lib/util/math.js";const ct_fitting=function(t,i,e){e(i.x,i.y.map((t=>[t])),(t=>{t.forEach(((t,e)=>{i.at(e).y=t}))}))},d2_fitting=function(t,i,e){e(i.x,i.y.map((t=>[t])),(()=>{}))},ad_fitting=function(t,i,e){const n=i.x,o=i.y.map((t=>[t]));0===t.select(".tile").size()&&t.insert("g").classed("tile",!0).classed("anormal_point",!0);let a=t.select(".anormal_point");e(n,o,(e=>{t.selectAll(".tile *").remove(),e.forEach(((t,e)=>{if(t){new DataCircle(a,i.points[e]).color=getCategoryColor(specialCategory.error)}}))}))},dr_fitting=function(t,i,e){const n=i._manager.platform.width,o=i._manager.platform.height,a=i.x,s=i.y.map((t=>[t]));0===t.select(".tile").size()&&t.insert("g",":first-child").classed("tile",!0).attr("opacity",.5);let l=t.select(".tile");e(a,s,(t=>{l.selectAll("*").remove();const e=t[0].length;let a=t;1===e&&(a=a.map((t=>[t,0])));let s=[],r=[];for(let t=0;t<a[0].length;t++){const i=a.map((i=>i[t]));s.push(Math.max(...i)),r.push(Math.min(...i))}const g=1===i.dimension?[o,o]:[n,o],d=g.map(((t,i)=>(t-10)/(s[i]-r[i])));let c=Math.min(...d);const f=[5,5];for(let t=0;t<d.length;t++)(!isFinite(c)||d[t]>c)&&(isFinite(d[t])?f[t]+=(d[t]-c)*(s[t]-r[t])/2:f[t]=g[t]/2-r[t]);isFinite(c)||(c=0);let m=1/0,F=null;const M=Matrix.fromArray(i.points.map((t=>t.at)));for(let t=0;t<(1===i.dimension?1:2**e);t++){const i=t.toString(2).padStart(e,"0").split("").map((t=>!!+t)),n=a.map((t=>t.map(((t,e)=>((i[e]?s[e]-t+r[e]:t)-r[e])*c+f[e])))),o=Matrix.fromArray(n);o.sub(M);const l=o.norm();l<m&&(m=l,F=n)}F.forEach(((t,e)=>{const n=new DataPoint(l,1===i.dimension?[i.points[e].at[0],t[0]]:t,i.points[e].category);n.radius=2;new DataLine(l,i.points[e],n).setRemoveListener((()=>n.remove()))}))}))},gr_fitting=function(t,i,e){const n=i.x,o=i.y.map((t=>[t]));0===t.select(".tile").size()&&t.insert("g",":first-child").classed("tile",!0).classed("generated",!0).attr("opacity",.5);let a=t.select(".tile.generated");e(n,o,((t,e)=>{a.selectAll("*").remove(),t.forEach(((t,n)=>{new DataPoint(a,t.map((t=>t/i.scale)),e?e[n][0]:0).radius=2}))}))};export default class FittingMode{constructor(t,i){this.value=t,this.func=i}fit(t,i,e){this.func(t,i,e)}}FittingMode.CT=new FittingMode("CT",ct_fitting),FittingMode.D1=new FittingMode("D1",d2_fitting),FittingMode.D2=new FittingMode("D2",d2_fitting),FittingMode.CF=new FittingMode("CF",d2_fitting),FittingMode.DR=new FittingMode("DR",dr_fitting),FittingMode.FS=new FittingMode("FS",dr_fitting),FittingMode.TF=new FittingMode("TF",dr_fitting),FittingMode.AD=new FittingMode("AD",ad_fitting),FittingMode.RG=t=>1===t?FittingMode.D1:FittingMode.D2,FittingMode.GR=new FittingMode("GR",gr_fitting),FittingMode.DE=new FittingMode("DE",d2_fitting),FittingMode.IN=new FittingMode("IN",d2_fitting);