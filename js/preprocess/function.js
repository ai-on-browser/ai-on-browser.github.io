var E=Object.defineProperty;var f=(d,a)=>E(d,"name",{value:a,configurable:!0});import v from"../../lib/util/matrix.js";import b from"../expression.js";const $=f((d,a)=>{const c=[],e=Array(a).fill(0);for(;e[e.length-1]<d;){c.push(e.concat());for(let s=e.length-1;s>=0;s--)if(e[s]++,e[s]<d){for(let t=s+1;t<e.length;t++)e[t]=e[s];break}}return c},"combination_repetition");export default class k{static{f(this,"FunctionPreprocessor")}constructor(a){this._manager=a,this._f=[],this.init()}get functions(){return this._f.map(a=>b(a))}init(){if(this._r)this._r.replaceChildren();else{const n=this._manager.setting.preprocess.configElement;this._r=document.createElement("div"),n.append(this._r)}const a=f(()=>{const n=this._manager.datas.dimension,r=e.value;if(this._f.length=0,c.querySelectorAll(".ls_params").forEach(o=>{o.style.display="none"}),r==="default")for(let o=0;o<n;o++)this._f.push(`x[${o}]`);else if(r==="polynomial"){s.style.display=null,this._f.push("1");const o=+t.value;if(o>=0)for(let p=0;p<=o;p++){const _=$(n,p);for(const g of _){const l=Array(n).fill(0);for(const i of g)l[i]++;let y="",x="";for(let i=0;i<l.length;i++)l[i]===1?(y+=`${x}x[${i}]`,x="*"):l[i]>1&&(y+=`${x}x[${i}]^${l[i]}`,x="*");this._f.push(y)}}}u()},"createPreset"),c=document.createElement("div");c.onchange=a,this._r.append(c);const e=document.createElement("select");for(const n of["default","polynomial"]){const r=document.createElement("option");r.value=r.innerText=n,e.append(r)}c.append("preset",e);const s=document.createElement("span");c.append(s),s.classList.add("ls_params"),s.style.display="none";const t=document.createElement("input");t.type="number",t.min=0,t.max=10,t.value=2,t.onchange=a,s.append(" p ",t);const m=this._manager.datas.dimension;for(let n=0;n<m;n++)this._f.push(`x[${n}]`);const h=document.createElement("span");this._r.append(h),h.classList.add("expr-list");const u=f(()=>{h.replaceChildren("f(x) =");for(let r=0;r<this._f.length;r++){const o=document.createElement("input");o.type="text",o.value=this._f[r]||="x[0] ^ 2",o.size=8,o.onchange=()=>{this._f[r]=o.value};const p=document.createElement("span");p.classList.add("trash"),p.onclick=()=>{this._f.splice(r,1),u()};const _=document.createElement("span"),g=document.createElement("sub");g.innerText=r,_.append("a",g);const l=document.createElement("span");l.append(r===0?"":"+ ",_,"\u2217",o,p),l.classList.add("expr"),h.append(l)}const n=document.createElement("input");n.type="button",n.value="+",n.onclick=()=>{this._f.push(null),u()},h.append(" ",n)},"createTerms");u()}apply(a){const c=a.length,e=this.functions,s=new v(c,e.length);for(let t=0;t<c;t++)for(let m=0;m<e.length;m++)s.set(t,m,e[m]({x:a[t]}));return s.toArray()}terminate(){this._r?.remove()}}
