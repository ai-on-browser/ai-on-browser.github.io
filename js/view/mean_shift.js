import MeanShift from"../../lib/model/mean_shift.js";import Controller from"../controller.js";import{getCategoryColor}from"../utils.js";export default function(t){t.setting.ml.usage='Click and add data point. Finally, click "Step" button repeatedly.';const e=t.svg.insert("g",":first-child").attr("class","centroids").attr("opacity",.8),a=new Controller(t);let r=[];const o=t.width/(t.datas.domain[0][1]-t.datas.domain[0][0]);let n=new MeanShift(50,10);const i=()=>{const e=n.predict(s.value);t.trainResult=e.map((t=>t+1));for(let t=0;t<r.length;t++)r[t].attr("stroke",getCategoryColor(e[t]+1)).attr("cx",n._centroids[t][0]*o).attr("cy",n._centroids[t][1]*o)},l=a.input.number({min:0,max:10,step:.01,value:.1});a.stepLoopButtons().init((()=>{n=new MeanShift(l.value);let a=t.trainInput;"SG"===t.task&&(a=a.flat()),n.init(a),"SG"!==t.task&&(r.forEach((t=>t.remove())),r=t._renderer.points.map((t=>e.append("circle").attr("cx",t.at[0]*o).attr("cy",t.at[1]*o).attr("r",n.h*o).attr("stroke","black").attr("fill-opacity",0).attr("stroke-opacity",.5)))),i(),c.value=n.categories})).step((t=>{null!==n&&(n.fit(),i(),c.value=n.categories,t&&t())}));const s=a.input.number({min:0,max:10,step:.01,value:.01}).on("change",(()=>{i(),c.value=n.categories})),c=a.text({label:" clusters ",value:0});t.setting.terminate=()=>{e.remove()}}