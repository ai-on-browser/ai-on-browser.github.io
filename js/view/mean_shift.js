import MeanShift from"../../lib/model/mean_shift.js";import Controller from"../controller.js";import{getCategoryColor}from"../utils.js";export default function(t){t.setting.ml.usage='Click and add data point. Finally, click "Step" button repeatedly.',t.setting.ml.reference={title:"Mean shift (Wikipedia)",url:"https://en.wikipedia.org/wiki/Mean_shift"};const e=document.createElementNS("http://www.w3.org/2000/svg","g");t.svg.insertBefore(e,t.svg.firstChild),e.classList.add("centroids"),e.setAttribute("opacity",.8);const r=new Controller(t);let i=[],n=new MeanShift(50,10);const s=()=>{const e=t._renderer[0].scale?.[0]??0,r=n.predict(a.value);t.trainResult=r.map((t=>t+1));for(let t=0;t<i.length;t++)i[t].setAttribute("stroke",getCategoryColor(r[t]+1)),i[t].setAttribute("cx",n._centroids[t][0]*e),i[t].setAttribute("cy",n._centroids[t][1]*e)},o=r.input.number({min:0,max:10,step:.01,value:.1});r.stepLoopButtons().init((()=>{const r=t._renderer[0].scale?.[0]??0;n=new MeanShift(o.value);let a=t.trainInput;"SG"===t.task&&(a=a.flat()),n.init(a),"SG"!==t.task&&r>0&&(i.forEach((t=>t.remove())),i=t._renderer[0].points.map((t=>{const i=document.createElementNS("http://www.w3.org/2000/svg","circle");return i.setAttribute("cx",t.at[0]*r),i.setAttribute("cy",t.at[1]*r),i.setAttribute("r",n.h*r),i.setAttribute("stroke","black"),i.setAttribute("fill-opacity",0),i.setAttribute("stroke-opacity",.5),e.append(i),i}))),s(),l.value=n.categories})).step((t=>{null!==n&&(n.fit(),s(),l.value=n.categories,t&&t())}));const a=r.input.number({min:0,max:10,step:.01,value:.01}).on("change",(()=>{s(),l.value=n.categories})),l=r.text({label:" clusters ",value:0});t.setting.terminate=()=>{e.remove()}}