import MeanShift from"../../lib/model/mean_shift.js";import Controller from"../controller.js";var dispMeanShift=function(t,e){const a=e.svg.insert("g",":first-child").attr("class","centroids").attr("opacity",.8),r=new Controller(e);let n=[];const s=e.width/(e.datas.domain[0][1]-e.datas.domain[0][0]);let o=new MeanShift(50,10);const i=()=>{const t=o.predict();e.trainResult=t.map((t=>t+1));for(let e=0;e<n.length;e++)n[e].attr("stroke",getCategoryColor(t[e]+1)).attr("cx",o._centroids[e][0]*s).attr("cy",o._centroids[e][1]*s)};return t.append("input").attr("type","number").attr("name","h").attr("value",.1).attr("min",0).attr("max",10).attr("step",.01),r.stepLoopButtons().init((()=>{o.h=+t.select("[name=h]").property("value"),o.threshold=+t.select("[name=threshold]").property("value");let r=e.trainInput;"SG"===e.task&&(r=r.flat()),o.init(r),"SG"!==e.task&&(n.forEach((t=>t.remove())),n=e.datas.points.map((t=>a.append("circle").attr("cx",t.at[0]*s).attr("cy",t.at[1]*s).attr("r",o.h*s).attr("stroke","black").attr("fill-opacity",0).attr("stroke-opacity",.5)))),i(),t.select("[name=clusternumber]").text(o.categories)})).step((e=>{null!==o&&(o.fit(),i(),t.select("[name=clusternumber]").text(o.categories),e&&e())})),t.append("input").attr("type","number").attr("name","threshold").attr("value",.01).attr("min",0).attr("max",10).attr("step",.01).on("change",(function(){o.threshold=d3.select(this).property("value"),i(),t.select("[name=clusternumber]").text(o.categories)})),t.append("span").attr("name","clusternumber").text("0"),t.append("span").text(" clusters "),()=>{a.remove()}};export default function(t){t.setting.ml.usage='Click and add data point. Finally, click "Step" button repeatedly.',t.setting.terminate=dispMeanShift(t.setting.ml.configElement,t)}