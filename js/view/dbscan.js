import DBSCAN from"../../lib/model/dbscan.js";import Controller from"../controller.js";import{getCategoryColor}from"../utils.js";export default function(t){t.setting.ml.usage='Click and add data point. Then, click "Fit" button.',t.setting.ml.reference={title:"DBSCAN (Wikipedia)",url:"https://en.wikipedia.org/wiki/DBSCAN"};const e=new Controller(t),r=t.svg,i=document.createElementNS("http://www.w3.org/2000/svg","g");r.insertBefore(i,r.firstChild),i.classList.add("range"),i.setAttribute("opacity",.4);const l=()=>{i.replaceChildren();const e=new DBSCAN(o.value,a.value,n.value).predict(t.trainInput);t.trainResult=e.map((t=>t+1)),s.value=new Set(e).size;const r=t._renderer[0].scale[0],l=t.trainInput;if("euclid"===n.value)for(let t=0;t<l.length;t++){const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",l[t][0]*r),n.setAttribute("cy",l[t][1]*r),n.setAttribute("r",o.value*r),n.setAttribute("fill-opacity",0),n.setAttribute("stroke",getCategoryColor(e[t]+1)),i.append(n)}else if("manhattan"===n.value)for(let t=0;t<l.length;t++){const n=document.createElementNS("http://www.w3.org/2000/svg","polygon"),a=l[t][0]*r,s=l[t][1]*r,u=o.value*r;n.setAttribute("points",`${a-u},${s} ${a},${s-u} ${a+u},${s} ${a},${s+u}`),n.setAttribute("fill-opacity",0),n.setAttribute("stroke",getCategoryColor(e[t]+1)),i.append(n)}else if("chebyshev"===n.value)for(let t=0;t<l.length;t++){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x",(l[t][0]-o.value)*r),n.setAttribute("y",(l[t][1]-o.value)*r),n.setAttribute("width",2*o.value*r),n.setAttribute("height",2*o.value*r),n.setAttribute("fill-opacity",0),n.setAttribute("stroke",getCategoryColor(e[t]+1)),i.append(n)}},n=e.select(["euclid","manhattan","chebyshev"]).on("change",l),o=e.input.number({label:"eps",min:.01,max:10,step:.01,value:.05}).on("change",l),a=e.input.number({label:"min pts",min:2,max:1e3,value:5}).on("change",l);e.input.button("Fit").on("click",l);const s=e.text({label:" Clusters: "});t.setting.terminate=()=>{i.remove()}}