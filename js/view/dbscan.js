import DBSCAN from"../../lib/model/dbscan.js";import Controller from"../controller.js";import{getCategoryColor}from"../utils.js";export default function(t){t.setting.ml.usage='Click and add data point. Then, click "Fit" button.';const e=new Controller(t),a=t.svg;a.insert("g",":first-child").attr("class","range").attr("opacity",.4);const l=()=>{a.selectAll(".range *").remove();const e=new DBSCAN(n.value,o.value,r.value).predict(t.trainInput);t.trainResult=e.map((t=>t+1)),c.value=new Set(e).size;const l=1e3;"euclid"===r.value?a.select(".range").selectAll("circle").data(t.trainInput).enter().append("circle").attr("cx",(t=>t[0]*l)).attr("cy",(t=>t[1]*l)).attr("r",n.value*l).attr("fill-opacity",0).attr("stroke",((t,a)=>getCategoryColor(e[a]+1))):"manhattan"===r.value?a.select(".range").selectAll("polygon").data(t.trainInput).enter().append("polygon").attr("points",(t=>{const e=t[0]*l,a=t[1]*l,r=n.value*l;return`${e-r},${a} ${e},${a-r} ${e+r},${a} ${e},${a+r}`})).attr("fill-opacity",0).attr("stroke",((t,a)=>getCategoryColor(e[a]+1))):"chebyshev"===r.value&&a.select(".range").selectAll("rect").data(t.trainInput).enter().append("rect").attr("x",(t=>(t[0]-n.value)*l)).attr("y",(t=>(t[1]-n.value)*l)).attr("width",2*n.value*l).attr("height",2*n.value*l).attr("fill-opacity",0).attr("stroke",((t,a)=>getCategoryColor(e[a]+1)))},r=e.select(["euclid","manhattan","chebyshev"]).on("change",l),n=e.input.number({label:"eps",min:.01,max:10,step:.01,value:.05}).on("change",l),o=e.input.number({label:"min pts",min:2,max:1e3,value:5}).on("change",l);e.input.button("Fit").on("click",l);const c=e.text({label:" Clusters: "});t.setting.terminate=()=>{a.select(".range").remove()}}