var B=Object.defineProperty;var u=(e,i)=>B(e,"name",{value:i,configurable:!0});import f from"../../lib/model/dqn.js";import Q from"../controller.js";import T from"../neuralnetwork_builder.js";class x{static{u(this,"DQNCBAgent")}constructor(i,l,t,n){this._agent=new f(i,l,t,n)}set method(i){this._agent.method=i}terminate(){}get_score(){return this._agent.get_score()}get_action(i,l=.002){return this._agent.get_action(i,l)}update(i,l,t,n,r,o,h){return this._agent.update(i,l,t,n,r,o,h)}}export default function C(e){e.setting.ml.usage='Click "step" to update.';let i=20;e.type==="grid"&&(e.env._reward={step:-1,wall:-1,goal:1,fail:-1},e.env._max_step=3e3,i=Math.max(...e.env.size));const l=new T,t=new Q(e);let n=null;e.reset(n);const r=u((a,m=!0)=>{const g=e.state(),p=n.get_action(g,Math.max(y.value,v.value*w.value)),{state:b,reward:R,done:_,invalid:S}=e.step(p);if(S){a&&a();return}const k=n.update(p,g,b,R,_,D.value,N.value);k!=null&&e.plotLoss(k);const z=u(()=>{(_||e.epoch%1e3===999)&&(v.value=v.value*w.value),a&&a(_)},"end_proc");m&&e.render(()=>n.get_score()),z()},"step"),o=u(a=>{e.reset(n),e.render(()=>n.get_score()),a&&a()},"reset");t.text(" Hidden Layers "),l.makeHtml(t,{optimizer:!0}),n=new x(e,i,l.layers,l.optimizer),setTimeout(()=>{e.render(()=>n.get_score()),c.element.disabled=!1,d.element.disabled=!1},0),t.input.button("New agent").on("click",()=>{n.terminate(),n=new x(e,i,l.layers,l.optimizer),o(),v.value=1}),t.input.button("Reset").on("click",()=>o());const h=t.select(["DQN","DDQN"]).on("change",()=>{n.method=h.value}),y=t.input.number({label:"greedy rate = max(",min:0,max:1,step:.01,value:.01}),v=t.input.number({label:", ",min:0,max:1,step:.01,value:1}),w=t.input.number({label:" * ",min:0,max:1,step:.01,value:.995});t.text(") ");const D=t.input.number({label:" Learning rate ",min:0,max:100,step:.01,value:.001}),N=t.input.number({label:" Batch size ",min:1,max:100,value:10});t.input.button("Step").on("click",()=>r());let s=!1;const c=t.input.button("Epoch").on("click",()=>{s=!s,c.element.value=s?"Stop":"Epoch",d.element.disabled=s,s&&u((function a(){s?r(m=>{setTimeout(()=>m?o(a):a())}):setTimeout(()=>{e.render(()=>n.get_score()),c.element.value="Epoch"},0)}),"loop")()});c.element.disabled=!0;const d=t.input.button("Skip").on("click",()=>{if(s=!s,d.element.value=s?"Stop":"Skip",c.element.disabled=s,s){let a=Date.now();u((function m(){for(;s;){let g=!1;r(b=>{g=b},!0);const p=Date.now();if(g&&o(),p-a>200){a=p,setTimeout(m,0);return}}e.render(()=>n.get_score()),d.element.value="Skip"}),"loop")()}});return d.element.disabled=!0,e.plotRewards(t.element),()=>{s=!1,n.terminate()}}u(C,"default");
