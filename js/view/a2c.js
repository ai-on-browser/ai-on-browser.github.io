var x=Object.defineProperty;var r=(e,t)=>x(e,"name",{value:t,configurable:!0});import A from"../neuralnetwork_builder.js";import T from"../../lib/model/a2c.js";import z from"../controller.js";class f{static{r(this,"A2CCBAgent")}constructor(t,u,o,c,a,i){this._agent=new T(t.env,u,50,o,c),i&&i()}set method(t){this._agent.method=t}terminate(){}get_score(){return this._agent.get_score()}get_action(t){return this._agent.get_action(t)}update(t,u,o){return this._agent.update(t,u,o)}}export default function B(e){e.setting.ml.usage='Click "step" to update.';const t=new z(e);let u=20;e.type==="grid"&&(e.env._max_step=1e3,u=Math.max(...e.env.size));const o=new A,c=!1;let a=!1,i=null,_=e.reset(i);const h=r((n,l=!0)=>{if(!a){n&&n();return}const p=i.get_action(_),{state:m,done:g}=e.step(p),S=i.update(g,v.value,b.value);e.plotLoss(S);const y=r(()=>{_=m,n&&n(g)},"end_proc");l&&e.render(()=>i.get_score()),y()},"step"),d=r(n=>{if(!a){n&&n();return}_=e.reset(i),e.render(()=>i.get_score()),n&&n()},"reset");t.text(" Hidden Layers "),o.makeHtml(e.setting.ml.configElement,{optimizer:!0}),i=new f(e,u,o.layers,o.optimizer,c,()=>{a=!0,setTimeout(()=>{e.render(()=>i.get_score());for(const n of t.element.querySelectorAll("input"))n.disabled=!1},0)}),t.input.button("New agent").on("click",()=>{i.terminate(),i=new f(e,u,o.layers,o.optimizer,c,()=>{a=!0,d()})}),t.input.button("Reset").on("click",()=>d());const v=t.input.number({label:" Learning rate ",min:0,max:100,step:.001,value:.001}),b=t.input.number({label:" Batch size ",min:1,max:100,value:10});t.input.button("Step").on("click",()=>h());let s=!1;const k=t.input.button("Epoch").on("click",()=>{s=!s,k.value=s?"Stop":"Epoch",w.element.disabled=s,s&&r(function n(){s?h(l=>{setTimeout(()=>l?d(n):n())}):setTimeout(()=>{e.render(()=>i.get_score()),k.value="Epoch"},0)},"loop")()}),w=t.input.button("Skip").on("click",()=>{if(s=!s,w.value=s?"Stop":"Skip",k.element.disabled=s,s){let n=new Date().getTime();r(function l(){for(;s;){let p=!1;if(h(g=>{p=g,c&&(g?d(l):l())},!0),c)return;const m=new Date().getTime();if(p&&d(),m-n>200){n=m,setTimeout(l,0);return}}e.render(()=>i.get_score()),w.value="Skip"},"loop")()}});e.plotRewards(t.element);for(const n of t.element.querySelectorAll("input"))n.disabled=!0;return()=>{s=!1,i.terminate()}}r(B,"default");
