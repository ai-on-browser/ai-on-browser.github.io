var f=Object.defineProperty;var r=(t,e)=>f(t,"name",{value:e,configurable:!0});import x from"../../lib/model/a2c.js";import y from"../controller.js";import A from"../neuralnetwork_builder.js";class b{static{r(this,"A2CCBAgent")}constructor(e,u,s,n){this._agent=new x(e.env,u,50,s,n)}set method(e){this._agent.method=e}terminate(){}get_score(){return this._agent.get_score()}get_action(e){return this._agent.get_action(e)}update(e,u,s){return this._agent.update(e,u,s)}}export default function z(t){t.setting.ml.usage='Click "step" to update.';const e=new y(t);let u=20;t.type==="grid"&&(t.env._max_step=1e3,u=Math.max(...t.env.size));const s=new A;let n=null,g=t.reset(n);const m=r((o,l=!0)=>{const a=n.get_action(g),{state:d,done:p}=t.step(a),w=n.update(p,k.value,v.value);t.plotLoss(w);const S=r(()=>{g=d,o&&o(p)},"end_proc");l&&t.render(()=>n.get_score()),S()},"step"),c=r(o=>{g=t.reset(n),t.render(()=>n.get_score()),o&&o()},"reset");e.text(" Hidden Layers "),s.makeHtml(e,{optimizer:!0}),n=new b(t,u,s.layers,s.optimizer),setTimeout(()=>{t.render(()=>n.get_score());for(const o of e.element.querySelectorAll("input"))o.disabled=!1},0),e.input.button("New agent").on("click",()=>{n.terminate(),n=new b(t,u,s.layers,s.optimizer),c()}),e.input.button("Reset").on("click",()=>c());const k=e.input.number({label:" Learning rate ",min:0,max:100,step:.001,value:.001}),v=e.input.number({label:" Batch size ",min:1,max:100,value:10});e.input.button("Step").on("click",()=>m());let i=!1;const _=e.input.button("Epoch").on("click",()=>{i=!i,_.value=i?"Stop":"Epoch",h.element.disabled=i,i&&r((function o(){i?m(l=>{setTimeout(()=>l?c(o):o())}):setTimeout(()=>{t.render(()=>n.get_score()),_.value="Epoch"},0)}),"loop")()}),h=e.input.button("Skip").on("click",()=>{if(i=!i,h.value=i?"Stop":"Skip",_.element.disabled=i,i){let o=Date.now();r((function l(){for(;i;){let a=!1;m(p=>{a=p},!0);const d=Date.now();if(a&&c(),d-o>200){o=d,setTimeout(l,0);return}}t.render(()=>n.get_score()),h.value="Skip"}),"loop")()}});t.plotRewards(e.element);for(const o of e.element.querySelectorAll("input"))o.disabled=!0;return()=>{i=!1,n.terminate()}}r(z,"default");
