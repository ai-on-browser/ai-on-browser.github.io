var x=Object.defineProperty;var r=(t,e)=>x(t,"name",{value:e,configurable:!0});import A from"../../lib/model/a2c.js";import z from"../controller.js";import B from"../neuralnetwork_builder.js";class f{static{r(this,"A2CCBAgent")}constructor(e,u,s,c,a,i){this._agent=new A(e.env,u,50,s,c),i&&i()}set method(e){this._agent.method=e}terminate(){}get_score(){return this._agent.get_score()}get_action(e){return this._agent.get_action(e)}update(e,u,s){return this._agent.update(e,u,s)}}export default function C(t){t.setting.ml.usage='Click "step" to update.';const e=new z(t);let u=20;t.type==="grid"&&(t.env._max_step=1e3,u=Math.max(...t.env.size));const s=new B,c=!1;let a=!1,i=null,m=t.reset(i);const h=r((n,l=!0)=>{if(!a){n&&n();return}const g=i.get_action(m),{state:_,done:p}=t.step(g),S=i.update(p,v.value,b.value);t.plotLoss(S);const y=r(()=>{m=_,n&&n(p)},"end_proc");l&&t.render(()=>i.get_score()),y()},"step"),d=r(n=>{if(!a){n&&n();return}m=t.reset(i),t.render(()=>i.get_score()),n&&n()},"reset");e.text(" Hidden Layers "),s.makeHtml(e,{optimizer:!0}),i=new f(t,u,s.layers,s.optimizer,c,()=>{a=!0,setTimeout(()=>{t.render(()=>i.get_score());for(const n of e.element.querySelectorAll("input"))n.disabled=!1},0)}),e.input.button("New agent").on("click",()=>{i.terminate(),i=new f(t,u,s.layers,s.optimizer,c,()=>{a=!0,d()})}),e.input.button("Reset").on("click",()=>d());const v=e.input.number({label:" Learning rate ",min:0,max:100,step:.001,value:.001}),b=e.input.number({label:" Batch size ",min:1,max:100,value:10});e.input.button("Step").on("click",()=>h());let o=!1;const k=e.input.button("Epoch").on("click",()=>{o=!o,k.value=o?"Stop":"Epoch",w.element.disabled=o,o&&r((function n(){o?h(l=>{setTimeout(()=>l?d(n):n())}):setTimeout(()=>{t.render(()=>i.get_score()),k.value="Epoch"},0)}),"loop")()}),w=e.input.button("Skip").on("click",()=>{if(o=!o,w.value=o?"Stop":"Skip",k.element.disabled=o,o){let n=Date.now();r((function l(){for(;o;){let g=!1;if(h(p=>{g=p,c&&(p?d(l):l())},!0),c)return;const _=Date.now();if(g&&d(),_-n>200){n=_,setTimeout(l,0);return}}t.render(()=>i.get_score()),w.value="Skip"}),"loop")()}});t.plotRewards(e.element);for(const n of e.element.querySelectorAll("input"))n.disabled=!0;return()=>{o=!1,i.terminate()}}r(C,"default");
