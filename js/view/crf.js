import Matrix from"../../lib/util/matrix.js";import CRF from"../../lib/model/crf.js";var dispCRF=function(t,e){let a=null,n=0;t.append("span").text(" discrete = "),t.append("input").attr("type","number").attr("name","discrete").attr("value",10).attr("min",2).attr("max",100);const r=e.setting.ml.controller.stepLoopButtons().init((()=>{a=null,e.init()}));t.append("span").text(" iteration "),t.append("input").attr("type","number").attr("name","iteration").attr("value",1).attr("min",1).attr("max",1e3),r.step((function(r){e.fit(((i,p,l)=>{const o=+t.select("[name=discrete]").property("value"),m=+t.select("[name=iteration]").property("value");a||(a=new CRF);const c=Matrix.fromArray(i),s=c.max(),u=c.min();i=i.map((t=>t.map((t=>Math.floor((t-u)/(s-u)*o)))));for(let t=0;t<m;t++)a.fit(i,p.map((t=>Array(c.cols).fill(t[0]))));n+=m,e.predict(((t,e)=>{t=t.map((t=>t.map((t=>Math.floor((t-u)/(s-u)*o)))));e(a.predict(t).map((t=>t[0]??-1))),r&&r()}),10)}))})).epoch((()=>n))};export default function(t){t.setting.ml.usage='Click and add data point. Then, click "Calculate".',dispCRF(t.setting.ml.configElement,t)}