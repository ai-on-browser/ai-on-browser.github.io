import{RBM,GBRBM}from"../../lib/model/rbm.js";import Controller from"../controller.js";var dispRBM=function(t,e){const n=new Controller(e);let a=null,p=null,r=null,l=1;"GR"===e.task?t.append("input").attr("type","hidden").attr("name","type").attr("value","GBRBM"):t.append("select").attr("name","type").selectAll("option").data(["RBM","GBRBM"]).enter().append("option").property("value",(t=>t)).text((t=>t)),t.append("span").text(" hidden nodes "),t.append("input").attr("type","number").attr("name","hiddens").attr("min",1).attr("max",100).attr("value",10),t.append("span").text(" learning rate "),t.append("input").attr("type","number").attr("name","lr").attr("min",.01).attr("max",10).attr("step",.01).attr("value",.01),n.stepLoopButtons().init((()=>{a=null,e.init()})).step((n=>{const s=e._step;e._step=8;let i=e.trainInput;if("DN"===e.task&&(i=[i.flat(2)]),!a){const n=t.select("[name=type]").property("value"),p=+t.select("[name=hiddens]").property("value"),r=+t.select("[name=lr]").property("value");"RBM"===n?(a=new RBM(p,r),l=255):(a=new GBRBM(p,r,"DN"===e.task),l=1)}a.fit(i),"GR"===e.task?(e.trainResult=a.predict(i),n&&n()):(p=[e.testInput(8).flat(2)],p=a.predict(p),r=t=>e.testResult(t[0].map((t=>t*l))),r(p),n&&n()),e._step=s})).epoch(),"GR"!==e.task&&(t.append("epan").text(" Estimate"),n.stepLoopButtons().init((()=>{a&&(p=[e.testInput(8).flat(2)],r=t=>e.testResult(t[0].map((t=>t*l))),r(p))})).step((t=>{a&&(p=a.predict(p),r(p),t&&t())})))};export default function(t){t.setting.ml.usage='Click "Fit" button. Then, click "estimate" button.',dispRBM(t.setting.ml.configElement,t)}