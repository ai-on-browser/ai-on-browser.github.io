import Matrix from"../../lib/util/matrix.js";import{BasisFunctions}from"./least_square.js";import{Ridge,KernelRidge}from"../../lib/model/ridge.js";import EnsembleBinaryModel from"../../lib/model/ensemble_binary.js";var dispRidge=function(e,t){const n=t.task,a=new BasisFunctions(t);"CF"===n&&e.append("select").attr("name","method").selectAll("option").data(["oneone","onerest"]).enter().append("option").property("value",(e=>e)).text((e=>e)),"FS"!==n?(a.makeHtml(e),e.append("select").attr("name","kernel").selectAll("option").data(["no kernel","gaussian"]).enter().append("option").property("value",(e=>e)).text((e=>e))):e.append("input").attr("type","hidden").attr("name","kernel").property("value",""),e.append("span").text("lambda = "),e.append("select").attr("name","lambda").selectAll("option").data([0,1e-4,.001,.01,.1,1,10,100]).enter().append("option").property("value",(e=>e)).text((e=>e)),e.append("input").attr("type","button").attr("value","Fit").on("click",(()=>(r=>{const i=t.datas.dimension,l=e.select("[name=kernel]").property("value"),o="no kernel"===l?null:l;let p;const s=+e.select("[name=lambda]").property("value");if("CF"===n){const t=e.select("[name=method]").property("value");p=new EnsembleBinaryModel(o?function(){return new KernelRidge(s,o)}:function(){return new Ridge(s)},t)}else p=o?new KernelRidge(s,o):new Ridge(s);if("FS"===n){p.fit(t.trainInput,t.trainOutput);const e=p.importance().map(((e,t)=>[e,t]));e.sort(((e,t)=>t[0]-e[0]));const n=t.dimension,a=e.map((e=>e[1])).slice(0,n),r=Matrix.fromArray(t.trainInput);t.trainResult=r.col(a).toArray()}else{p.fit(a.apply(t.trainInput).toArray(),t.trainOutput);let e=p.predict(a.apply(t.testInput(o?1===i?1:10:1===i?100:4)));t.testResult(e)}})()))};export default function(e){e.setting.ml.usage='Click and add data point. Next, click "Fit" button.',dispRidge(e.setting.ml.configElement,e),e.setting.ml.detail="\nThe model form is\n$$\nf(X) = X W + \\epsilon\n$$\n\nThe loss function can be written as\n$$\nL(W) = \\| X W - y \\|^2 + \\lambda \\| W \\|^2\n$$\nwhere $ y $ is the observed value corresponding to $ X $.\nTherefore, the optimum parameter $ \\hat{W} $ is estimated as\n$$\n\\hat{W} = \\left( X^T X + \\lambda I \\right)^{-1} X^T y\n$$\n"}