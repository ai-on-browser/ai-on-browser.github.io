import Controller from"../controller.js";import{BaseWorker}from"../utils.js";class W2VWorker extends BaseWorker{constructor(){super("js/view/worker/word2vec_worker.js",{type:"module"})}initialize(e,t,i,a,r,s){this._postMessage({mode:"init",method:e,n:t,wordsOrNumber:i,reduce_size:a,optimizer:r},s)}fit(e,t,i,a,r){this._postMessage({mode:"fit",words:e,iteration:t,rate:i,batch:a},r)}predict(e,t){this._postMessage({mode:"predict",x:e},t)}reduce(e,t){this._postMessage({mode:"reduce",x:e},(e=>t(e.data)))}}export default function(e){e.setting.ml.usage='Click and add data point. Next, click "Initialize". Finally, click "Fit" button repeatedly.';const t=new Controller(e),i=new W2VWorker;let a=0;const r=t.select(["CBOW","skip-gram"]),s=t.input.number({label:" n ",min:1,max:10,value:1}),n=t.stepLoopButtons().init((()=>{if(e.init(),0===e.datas.length)return;i.initialize(r.value,s.value,e.trainInput,2,"adam")})),o=t.select({label:" Iteration ",values:[1,10,100,1e3,1e4]}),l=t.input.number({label:" Learning rate ",min:0,max:100,step:.01,value:.001}),u=t.input.number({label:" Batch size ",min:1,max:100,value:10});n.step((t=>{i.fit(e.trainInput,+o.value,l.value,u.value,(r=>{a=r.data.epoch,e.plotLoss(r.data.loss),i.reduce(e.testInput(),(i=>{e.testResult(i),t&&t()}))}))})).epoch((()=>a)),e.setting.terminate=()=>{i.terminate()}}