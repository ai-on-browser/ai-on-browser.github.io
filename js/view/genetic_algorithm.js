var R=Object.defineProperty;var o=(e,s)=>R(e,"name",{value:s,configurable:!0});import _ from"../../lib/model/genetic_algorithm.js";import z from"../controller.js";export default function G(e){e.setting.ml.usage='Click "step" to update.';const s=new z(e),u=e.type==="grid"?Math.max(...e.env.size):10;e.type==="grid"||e.type==="maze"?e.env.rewardReviver=t=>t._reward!==-1?0:Math.sqrt(t.state[0]**2+t.state[1]**2):e.type==="mountaincar"&&(e.env.rewardReviver=t=>t.done?-Math.abs(t.state[0]-t._env._goal_position)+Math.abs(t.state[1]-t._env._goal_velocity):0);let n=new _(e,100,u),r=0,a=[];e.reset(n),e.render(()=>n.get_score());const d=o(()=>{n.run(),a.push(n.top_agent().total_reward),n.next(p.value),e.reset(n),e.render(()=>n.get_score()),l.value=++r,v.value=` [${a.slice(-10).reverse().join(",")}]`},"step"),b=s.input.number({label:"Generation size",min:5,max:200,value:100}),x=s.input.number({label:"Resolution",min:2,max:100,value:u}),h=s.stepLoopButtons().init(()=>{n=new _(e,b.value,x.value),a=[],e.reset(n),e.render(()=>n.get_score()),l.value=r=0,v.value=""}),p=s.input.number({label:"Mutation rate",min:0,max:1,step:1e-4,value:.001});h.step(d);const l=s.text({label:" Generation: ",value:r});let i=!1;const c=s.input.button("Test").on("click",()=>{if(i=!i,c.element.value=i?"Stop":"Test",i){const t=n.top_agent();let g=e.reset(t);o((function w(){const y=t.get_action(g),{state:T,done:M}=e.step(y,t);g=T,e.render(),i&&!M?setTimeout(()=>w(),0):(i=!1,c.element.value="Test")}),"loop")()}}),v=s.text();return()=>{i=!1}}o(G,"default");
